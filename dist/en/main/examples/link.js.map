{"version":3,"file":"link.js","mappings":"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","sources":["webpack:///../src/ol/interaction/Link.js","webpack:///./link.js"],"sourcesContent":["/**\n * @module ol/interaction/Link\n */\nimport EventType from '../events/EventType.js';\nimport Interaction from './Interaction.js';\nimport MapEventType from '../MapEventType.js';\nimport {listen, unlistenByKey} from '../events.js';\nimport {toFixed} from '../math.js';\n\n/**\n * @param {number} number A number.\n * @return {number} A number with at most 5 decimal places.\n */\nfunction to5(number) {\n  return toFixed(number, 5);\n}\n\n/**\n * @param {string} string A string.\n * @return {number} A number representing the string.\n */\nfunction readNumber(string) {\n  return parseFloat(string);\n}\n\n/**\n * @param {number} number A number.\n * @return {string} A string representing the number.\n */\nfunction writeNumber(number) {\n  return to5(number).toString();\n}\n\n/**\n * @param {number} a A number.\n * @param {number} b A number.\n * @return {boolean} The numbers are different.\n */\nfunction differentNumber(a, b) {\n  if (isNaN(a)) {\n    return false;\n  }\n  return a !== readNumber(writeNumber(b));\n}\n\n/**\n * @param {Array<number>} a An array of two numbers.\n * @param {Array<number>} b An array of two numbers.\n * @return {boolean} The arrays are different.\n */\nfunction differentArray(a, b) {\n  return differentNumber(a[0], b[0]) || differentNumber(a[1], b[1]);\n}\n\n/** @typedef {'x'|'y'|'z'|'r'|'l'} Params */\n\n/**\n * @typedef {Object} Options\n * @property {boolean|import('../View.js').AnimationOptions} [animate=true] Animate view transitions.\n * @property {Array<Params>} [params=['x', 'y', 'z', 'r', 'l']] Properties to track. Default is to track\n * `x` (center x), `y` (center y), `z` (zoom), `r` (rotation) and `l` (layers).\n * @property {boolean} [replace=false] Replace the current URL without creating the new entry in browser history.\n * By default, changes in the map state result in a new entry being added to the browser history.\n * @property {string} [prefix=''] By default, the URL will be updated with search parameters x, y, z, and r.  To\n * avoid collisions with existing search parameters that your application uses, you can supply a custom prefix for\n * the ones used by this interaction (e.g. 'ol:').\n */\n\n/**\n * @classdesc\n * An interaction that synchronizes the map state with the URL.\n *\n * @api\n */\nclass Link extends Interaction {\n  /**\n   * @param {Options} [options] Link options.\n   */\n  constructor(options) {\n    super();\n\n    options = Object.assign(\n      {\n        animate: true,\n        params: ['x', 'y', 'z', 'r', 'l'],\n        replace: false,\n        prefix: '',\n      },\n      options || {}\n    );\n\n    let animationOptions;\n    if (options.animate === true) {\n      animationOptions = {duration: 250};\n    } else if (!options.animate) {\n      animationOptions = null;\n    } else {\n      animationOptions = options.animate;\n    }\n\n    /**\n     * @type {import('../View.js').AnimationOptions|null}\n     * @private\n     */\n    this.animationOptions_ = animationOptions;\n\n    /**\n     * @type {Object<Params, boolean>}\n     * @private\n     */\n    this.params_ = options.params.reduce((acc, value) => {\n      acc[value] = true;\n      return acc;\n    }, {});\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.replace_ = options.replace;\n\n    /**\n     * @private\n     * @type {string}\n     */\n    this.prefix_ = options.prefix;\n\n    /**\n     * @private\n     * @type {!Array<import(\"../events.js\").EventsKey>}\n     */\n    this.listenerKeys_ = [];\n\n    /**\n     * @private\n     * @type {boolean}\n     */\n    this.initial_ = true;\n\n    this.updateState_ = this.updateState_.bind(this);\n  }\n\n  /**\n   * @private\n   * @param {string} name A parameter name.\n   * @return {string} A name with the prefix applied.\n   */\n  getParamName_(name) {\n    if (!this.prefix_) {\n      return name;\n    }\n    return this.prefix_ + name;\n  }\n\n  /**\n   * @private\n   * @param {URLSearchParams} params The search params.\n   * @param {string} name The unprefixed parameter name.\n   * @return {string|null} The parameter value.\n   */\n  get_(params, name) {\n    return params.get(this.getParamName_(name));\n  }\n\n  /**\n   * @private\n   * @param {URLSearchParams} params The search params.\n   * @param {string} name The unprefixed parameter name.\n   * @param {string} value The param value.\n   */\n  set_(params, name, value) {\n    if (!(name in this.params_)) {\n      return;\n    }\n    params.set(this.getParamName_(name), value);\n  }\n\n  /**\n   * @private\n   * @param {URLSearchParams} params The search params.\n   * @param {string} name The unprefixed parameter name.\n   */\n  delete_(params, name) {\n    if (!(name in this.params_)) {\n      return;\n    }\n    params.delete(this.getParamName_(name));\n  }\n\n  /**\n   * @param {import(\"../Map.js\").default|null} map Map.\n   */\n  setMap(map) {\n    const oldMap = this.getMap();\n    super.setMap(map);\n    if (map === oldMap) {\n      return;\n    }\n    if (oldMap) {\n      this.unregisterListeners_(oldMap);\n    }\n    if (map) {\n      this.initial_ = true;\n      this.updateState_();\n      this.registerListeners_(map);\n    }\n  }\n\n  /**\n   * @param {import(\"../Map.js\").default} map Map.\n   * @private\n   */\n  registerListeners_(map) {\n    this.listenerKeys_.push(\n      listen(map, MapEventType.MOVEEND, this.updateUrl_, this),\n      listen(map.getLayerGroup(), EventType.CHANGE, this.updateUrl_, this),\n      listen(map, 'change:layergroup', this.handleChangeLayerGroup_, this)\n    );\n\n    if (!this.replace_) {\n      addEventListener('popstate', this.updateState_);\n    }\n  }\n\n  /**\n   * @param {import(\"../Map.js\").default} map Map.\n   * @private\n   */\n  unregisterListeners_(map) {\n    for (let i = 0, ii = this.listenerKeys_.length; i < ii; ++i) {\n      unlistenByKey(this.listenerKeys_[i]);\n    }\n    this.listenerKeys_.length = 0;\n\n    if (!this.replace_) {\n      removeEventListener('popstate', this.updateState_);\n    }\n\n    const url = new URL(window.location.href);\n    const params = url.searchParams;\n    this.delete_(params, 'x');\n    this.delete_(params, 'y');\n    this.delete_(params, 'z');\n    this.delete_(params, 'r');\n    this.delete_(params, 'l');\n    window.history.replaceState(null, '', url);\n  }\n\n  /**\n   * @private\n   */\n  handleChangeLayerGroup_() {\n    const map = this.getMap();\n    if (!map) {\n      return;\n    }\n    this.unregisterListeners_(map);\n    this.registerListeners_(map);\n    this.initial_ = true;\n    this.updateUrl_();\n  }\n\n  /**\n   * @private\n   */\n  updateState_() {\n    const map = this.getMap();\n    if (!map) {\n      return;\n    }\n    const view = map.getView();\n    if (!view) {\n      return;\n    }\n    const url = new URL(window.location.href);\n    const params = url.searchParams;\n\n    let updateView = false;\n\n    /**\n     * @type {import('../View.js').AnimationOptions}\n     */\n    const viewProperties = {};\n\n    const zoom = readNumber(this.get_(params, 'z'));\n    if ('z' in this.params_ && differentNumber(zoom, view.getZoom())) {\n      updateView = true;\n      viewProperties.zoom = zoom;\n    }\n\n    const rotation = readNumber(this.get_(params, 'r'));\n    if ('r' in this.params_ && differentNumber(rotation, view.getRotation())) {\n      updateView = true;\n      viewProperties.rotation = rotation;\n    }\n\n    const center = [\n      readNumber(this.get_(params, 'x')),\n      readNumber(this.get_(params, 'y')),\n    ];\n    if (\n      ('x' in this.params_ || 'y' in this.params_) &&\n      differentArray(center, view.getCenter())\n    ) {\n      updateView = true;\n      viewProperties.center = center;\n    }\n\n    if (updateView) {\n      if (!this.initial_ && this.animationOptions_) {\n        view.animate(Object.assign(viewProperties, this.animationOptions_));\n      } else {\n        if (viewProperties.center) {\n          view.setCenter(viewProperties.center);\n        }\n        if ('zoom' in viewProperties) {\n          view.setZoom(viewProperties.zoom);\n        }\n        if ('rotation' in viewProperties) {\n          view.setRotation(viewProperties.rotation);\n        }\n      }\n    }\n\n    const layers = map.getAllLayers();\n    const layersParam = this.get_(params, 'l');\n    if (\n      'l' in this.params_ &&\n      layersParam &&\n      layersParam.length === layers.length\n    ) {\n      for (let i = 0, ii = layers.length; i < ii; ++i) {\n        const value = parseInt(layersParam[i]);\n        if (!isNaN(value)) {\n          const visible = Boolean(value);\n          const layer = layers[i];\n          if (layer.getVisible() !== visible) {\n            layer.setVisible(visible);\n          }\n        }\n      }\n    }\n  }\n\n  /**\n   * @private\n   */\n  updateUrl_() {\n    const map = this.getMap();\n    if (!map) {\n      return;\n    }\n    const view = map.getView();\n    if (!view) {\n      return;\n    }\n    const initial = this.initial_;\n    this.initial_ = false;\n\n    const center = view.getCenter();\n    const zoom = view.getZoom();\n    const rotation = view.getRotation();\n\n    const layers = map.getAllLayers();\n    const visibilities = new Array(layers.length);\n    for (let i = 0, ii = layers.length; i < ii; ++i) {\n      visibilities[i] = layers[i].getVisible() ? '1' : '0';\n    }\n\n    const url = new URL(window.location.href);\n    const params = url.searchParams;\n\n    this.set_(params, 'x', writeNumber(center[0]));\n    this.set_(params, 'y', writeNumber(center[1]));\n    this.set_(params, 'z', writeNumber(zoom));\n    this.set_(params, 'r', writeNumber(rotation));\n    this.set_(params, 'l', visibilities.join(''));\n\n    if (url.href !== window.location.href) {\n      if (initial || this.replace_) {\n        window.history.replaceState(history.state, '', url);\n      } else {\n        window.history.pushState(null, '', url);\n      }\n    }\n  }\n}\n\nexport default Link;\n","import Link from '../src/ol/interaction/Link.js';\nimport Map from '../src/ol/Map.js';\nimport OSM from '../src/ol/source/OSM.js';\nimport TileLayer from '../src/ol/layer/Tile.js';\nimport View from '../src/ol/View.js';\n\nconst map = new Map({\n  layers: [\n    new TileLayer({\n      source: new OSM(),\n    }),\n  ],\n  target: 'map',\n  view: new View({\n    center: [0, 0],\n    zoom: 2,\n  }),\n});\n\nmap.addInteraction(new Link());\n"],"names":["readNumber","string","parseFloat","writeNumber","number","to5","toString","differentNumber","a","b","isNaN","Link","Interaction","constructor","options","animationOptions","super","Object","assign","animate","params","replace","prefix","duration","this","animationOptions_","params_","reduce","acc","value","replace_","prefix_","listenerKeys_","initial_","updateState_","bind","getParamName_","name","get_","get","set_","set","delete_","delete","setMap","map","oldMap","getMap","unregisterListeners_","registerListeners_","push","MapEventType","updateUrl_","getLayerGroup","EventType","handleChangeLayerGroup_","addEventListener","i","ii","length","removeEventListener","url","URL","window","location","href","searchParams","history","replaceState","view","getView","updateView","viewProperties","zoom","getZoom","rotation","getRotation","center","getCenter","setCenter","setZoom","setRotation","layers","getAllLayers","layersParam","parseInt","visible","Boolean","layer","getVisible","setVisible","initial","visibilities","Array","join","state","pushState","Map","Tile","source","OSM","target","View","addInteraction"],"sourceRoot":""}