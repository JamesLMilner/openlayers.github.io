"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5898],{48012:function(e,t,r){var s=r(54805),a=r(91462),n=r(1055),i=r(55117),o=r(50463),h=r(4711),c=r(40824),l=r(51097),u=r(53214),_=r(70487),p=r(29346),d=r(87334),f=r(29295),m=r(30439),y=r(36117),R=r(94704),g=r(44669),E=r(41507);const F={...m.ZC,RENDER_EXTENT:"u_renderExtent",GLOBAL_ALPHA:"u_globalAlpha"};class T extends f.Z{constructor(e,t){super(e,{uniforms:{[F.RENDER_EXTENT]:[0,0,0,0],[F.GLOBAL_ALPHA]:1},postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.previousExtent_=(0,y.lJ)(),this.currentTransform_=(0,g.Ue)(),this.tmpTransform_=(0,g.Ue)(),this.tmpMat4_=(0,R.U)(),this.currentFrameStateTransform_=(0,g.Ue)(),this.styles_=[],this.styleRenderers_=[],this.buffers_=[],this.applyOptions_(t),this.batch_=new u.Z;const r=this.getLayer().getSource();this.batch_.addFeatures(r.getFeatures()),this.sourceListenKeys_=[(0,E.oL)(r,_.Z.ADDFEATURE,this.handleSourceFeatureAdded_,this),(0,E.oL)(r,_.Z.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,E.oL)(r,_.Z.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,E.oL)(r,_.Z.CLEAR,this.handleSourceFeatureClear_,this)]}applyOptions_(e){this.styles_=Array.isArray(e.style)?e.style:[e.style]}createRenderers_(){this.buffers_=[],this.styleRenderers_=this.styles_.map((e=>new p.Z(e,this.helper)))}reset(e){this.applyOptions_(e),this.helper&&this.createRenderers_(),super.reset(e)}afterHelperCreated(){this.createRenderers_()}handleSourceFeatureAdded_(e){const t=e.feature;this.batch_.addFeature(t)}handleSourceFeatureChanged_(e){const t=e.feature;this.batch_.changeFeature(t)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}applyUniforms_(e){(0,g.lk)(this.tmpTransform_,this.currentFrameStateTransform_),(0,g.Jp)(this.tmpTransform_,e),this.helper.setUniformMatrixValue(F.PROJECTION_MATRIX,(0,R.u)(this.tmpMat4_,this.tmpTransform_))}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e),this.helper.prepareDraw(e),this.currentFrameStateTransform_=this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);const r=this.getLayer().getSource(),s=e.viewState.projection,a=r.getWrapX()&&s.canWrapX(),n=s.getExtent(),i=e.extent,o=a?(0,y.dz)(n):null,h=a?Math.ceil((i[2]-n[2])/o)+1:1;let c=a?Math.floor((i[0]-n[0])/o):0;(0,g.Iu)(this.currentFrameStateTransform_,c*o,0);do{for(let t=0,r=this.styleRenderers_.length;t<r;t++){const r=this.styleRenderers_[t],s=this.buffers_[t];s&&r.render(s,e,(()=>{this.applyUniforms_(s.invertVerticesTransform)}))}(0,g.Iu)(this.currentFrameStateTransform_,o,0)}while(++c<h);this.helper.finalizeDraw(e);const l=this.helper.getCanvas(),u=e.layerStatesArray[e.layerIndex].opacity;return u!==parseFloat(l.style.opacity)&&(l.style.opacity=String(u)),this.postRender(t,e),l}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),s=e.viewState,a=!e.viewHints[d.Z.ANIMATING]&&!e.viewHints[d.Z.INTERACTING],n=!(0,y.fS)(this.previousExtent_,e.extent),i=this.sourceRevision_<r.getRevision();if(i&&(this.sourceRevision_=r.getRevision()),a&&(n||i)){const a=s.projection,n=s.resolution,i=t instanceof l.Z?t.getRenderBuffer():0,o=(0,y.f3)(e.extent,i*n);r.loadFeatures(o,n,a),this.ready=!1;const h=this.helper.makeProjectionTransform(e,(0,g.Ue)()),c=this.styleRenderers_.map(((e,t)=>e.generateBuffers(this.batch_,h).then((e=>{this.buffers_[t]=e}))));Promise.all(c).then((()=>{this.ready=!0,this.getLayer().changed()})),this.previousExtent_=e.extent.slice()}return!0}forEachFeatureAtCoordinate(e,t,r,s,a){}disposeInternal(){this.sourceListenKeys_.forEach((function(e){(0,E.bN)(e)})),this.sourceListenKeys_=null,super.disposeInternal()}}var A=T;const S={"stroke-color":["*",["get","COLOR"],[220,220,220]],"stroke-width":1.5,"fill-color":["*",["get","COLOR"],[255,255,255,.6]]};class w extends a.Z{createRenderer(){return new A(this,{style:S})}}const L=new o.Z({source:new i.Z}),v=new w({source:new h.Z({url:"https://openlayers.org/data/vector/ecoregions.json",format:new s.Z})});new n.Z({layers:[L,v],target:"map",view:new c.ZP({center:[0,0],zoom:1})})}},function(e){var t;t=48012,e(e.s=t)}]);
//# sourceMappingURL=webgl-vector-layer.js.map