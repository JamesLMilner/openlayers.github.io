"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[5898],{8012:function(e,t,r){var n=r(4805),i=r(1462),s=r(1055),o=r(5117),a=r(463),h=r(4711),c=r(824),u=r(3778),l=r(1316),_=r(3214),d=r(2925),p=r(3497),f=r(487),g=r(7334),S=r(9295),m=r(439),b=r(6725),R=r(6117),y=r(4669),k=r(1275),w=r(1507);const F={...m.ZC,RENDER_EXTENT:"u_renderExtent",GLOBAL_ALPHA:"u_globalAlpha"};function E(e){return Object.keys(e).map((t=>({name:t,callback:e[t]})))}class A extends S.Z{constructor(e,t){const r=t.uniforms||{},n=(0,y.Ue)();r[F.PROJECTION_MATRIX]=n,r[F.RENDER_EXTENT]=[0,0,0,0],r[F.GLOBAL_ALPHA]=1,super(e,{uniforms:r,postProcesses:t.postProcesses}),this.sourceRevision_=-1,this.previousExtent_=(0,R.lJ)(),this.currentTransform_=n,this.currentFrameStateTransform_=(0,y.Ue)();const i={color:function(){return(0,b.zO)("#ddd")},opacity:function(){return 1},...t.fill&&t.fill.attributes},s={color:function(){return(0,b.zO)("#eee")},opacity:function(){return 1},width:function(){return 1.5},...t.stroke&&t.stroke.attributes},o={color:function(){return(0,b.zO)("#eee")},opacity:function(){return 1},...t.point&&t.point.attributes};this.fillVertexShader_=t.fill&&t.fill.vertexShader||b.W7,this.fillFragmentShader_=t.fill&&t.fill.fragmentShader||b.sH,this.fillAttributes_=E(i),this.strokeVertexShader_=t.stroke&&t.stroke.vertexShader||b.mC,this.strokeFragmentShader_=t.stroke&&t.stroke.fragmentShader||b.dr,this.strokeAttributes_=E(s),this.pointVertexShader_=t.point&&t.point.vertexShader||b.br,this.pointFragmentShader_=t.point&&t.point.fragmentShader||b.mz,this.pointAttributes_=E(o),this.worker_=(0,k.U)(),this.batch_=new _.Z;const a=this.getLayer().getSource();this.batch_.addFeatures(a.getFeatures()),this.sourceListenKeys_=[(0,w.oL)(a,f.Z.ADDFEATURE,this.handleSourceFeatureAdded_,this),(0,w.oL)(a,f.Z.CHANGEFEATURE,this.handleSourceFeatureChanged_,this),(0,w.oL)(a,f.Z.REMOVEFEATURE,this.handleSourceFeatureDelete_,this),(0,w.oL)(a,f.Z.CLEAR,this.handleSourceFeatureClear_,this)]}afterHelperCreated(){this.polygonRenderer_=new p.Z(this.helper,this.worker_,this.fillVertexShader_,this.fillFragmentShader_,this.fillAttributes_),this.pointRenderer_=new d.Z(this.helper,this.worker_,this.pointVertexShader_,this.pointFragmentShader_,this.pointAttributes_),this.lineStringRenderer_=new l.Z(this.helper,this.worker_,this.strokeVertexShader_,this.strokeFragmentShader_,this.strokeAttributes_)}handleSourceFeatureAdded_(e){const t=e.feature;this.batch_.addFeature(t)}handleSourceFeatureChanged_(e){const t=e.feature;this.batch_.changeFeature(t)}handleSourceFeatureDelete_(e){const t=e.feature;this.batch_.removeFeature(t)}handleSourceFeatureClear_(){this.batch_.clear()}renderFrame(e){const t=this.helper.getGL();this.preRender(t,e);const r=this.getLayer().getSource(),n=e.viewState.projection,i=r.getWrapX()&&n.canWrapX(),s=n.getExtent(),o=e.extent,a=i?(0,R.dz)(s):null,h=i?Math.ceil((o[2]-s[2])/a)+1:1;let c=i?Math.floor((o[0]-s[0])/a):0;const u=this.helper.makeProjectionTransform(e,this.currentFrameStateTransform_);(0,y.Iu)(u,c*a,0);do{(0,y.lk)(this.currentTransform_,u),(0,y.Jp)(this.currentTransform_,this.batch_.polygonBatch.invertVerticesBufferTransform),this.polygonRenderer_.preRender(this.batch_.polygonBatch,e),this.polygonRenderer_.render(this.batch_.polygonBatch),(0,y.lk)(this.currentTransform_,u),(0,y.Jp)(this.currentTransform_,this.batch_.lineStringBatch.invertVerticesBufferTransform),this.lineStringRenderer_.preRender(this.batch_.lineStringBatch,e),this.lineStringRenderer_.render(this.batch_.lineStringBatch),(0,y.lk)(this.currentTransform_,u),(0,y.Jp)(this.currentTransform_,this.batch_.lineStringBatch.invertVerticesBufferTransform),this.pointRenderer_.preRender(this.batch_.pointBatch,e),this.pointRenderer_.render(this.batch_.pointBatch),(0,y.Iu)(u,a,0)}while(++c<h);this.helper.finalizeDraw(e);const l=this.helper.getCanvas(),_=e.layerStatesArray[e.layerIndex].opacity;return _!==parseFloat(l.style.opacity)&&(l.style.opacity=String(_)),this.postRender(t,e),l}prepareFrameInternal(e){const t=this.getLayer(),r=t.getSource(),n=e.viewState,i=!e.viewHints[g.Z.ANIMATING]&&!e.viewHints[g.Z.INTERACTING],s=!(0,R.fS)(this.previousExtent_,e.extent),o=this.sourceRevision_<r.getRevision();if(o&&(this.sourceRevision_=r.getRevision()),i&&(s||o)){const i=n.projection,s=n.resolution,o=t instanceof u.Z?t.getRenderBuffer():0,a=(0,R.f3)(e.extent,o*s);r.loadFeatures(a,s,i),this.ready=!1;let h=3;const c=()=>{h--,this.ready=h<=0,this.getLayer().changed()},l=this.helper.makeProjectionTransform(e,(0,y.Ue)());this.polygonRenderer_.rebuild(this.batch_.polygonBatch,l,"Polygon",c),this.lineStringRenderer_.rebuild(this.batch_.lineStringBatch,l,"LineString",c),this.pointRenderer_.rebuild(this.batch_.pointBatch,l,"Point",c),this.previousExtent_=e.extent.slice()}return this.helper.prepareDraw(e),!0}forEachFeatureAtCoordinate(e,t,r,n,i){}disposeInternal(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(e){(0,w.bN)(e)})),this.sourceListenKeys_=null,super.disposeInternal()}}var T=A,v=r(1439);class L extends i.Z{createRenderer(){return new T(this,{fill:{attributes:{color:function(e){const t=(0,v._2)(e.get("COLOR")||"#eee");return t[3]=.85,(0,b.zO)(t)},opacity:function(){return.6}}},stroke:{attributes:{color:function(e){const t=[...(0,v._2)(e.get("COLOR")||"#eee")];return t.forEach(((e,r)=>t[r]=Math.round(.75*t[r]))),(0,b.zO)(t)},width:function(){return 1.5},opacity:function(){return 1}}}})}}const x=new a.Z({source:new o.Z}),Z=new L({source:new h.Z({url:"https://openlayers.org/data/vector/ecoregions.json",format:new n.Z})});new s.Z({layers:[x,Z],target:"map",view:new c.ZP({center:[0,0],zoom:1})})}},function(e){var t;t=8012,e(e.s=t)}]);
//# sourceMappingURL=webgl-vector-layer.js.map