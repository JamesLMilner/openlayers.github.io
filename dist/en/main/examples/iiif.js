"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[8487],{2247:function(e,i,t){var o=t(1931),n=t(8053),r=t(9366),s=t(6913),a=t(3422);const l={VERSION1:"version1",VERSION2:"version2",VERSION3:"version3"},f={};f[l.VERSION1]={level0:{supports:[],formats:[],qualities:["native"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["native"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["native","color","grey","bitonal"]}},f[l.VERSION2]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","sizeByW","sizeByH","sizeByPct"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByDistortedWh","sizeByWh"],formats:["jpg","png"],qualities:["default","bitonal"]}},f[l.VERSION3]={level0:{supports:[],formats:["jpg"],qualities:["default"]},level1:{supports:["regionByPx","regionSquare","sizeByW","sizeByH","sizeByWh"],formats:["jpg"],qualities:["default"]},level2:{supports:["regionByPx","regionSquare","regionByPct","sizeByW","sizeByH","sizeByPct","sizeByConfinedWh","sizeByWh"],formats:["jpg","png"],qualities:["default"]}},f.none={none:{supports:[],formats:[],qualities:[]}};const u=/^https?:\/\/library\.stanford\.edu\/iiif\/image-api\/(?:1\.1\/)?compliance\.html#level[0-2]$/,g=/^https?:\/\/iiif\.io\/api\/image\/2\/level[0-2](?:\.json)?$/,m=/(^https?:\/\/iiif\.io\/api\/image\/3\/level[0-2](?:\.json)?$)|(^level[0-2]$)/;const c={};c[l.VERSION1]=function(e){let i=e.getComplianceLevelSupportedFeatures();return void 0===i&&(i=f[l.VERSION1].level0),{url:void 0===e.imageInfo["@id"]?void 0:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),supports:i.supports,formats:[...i.formats,void 0===e.imageInfo.formats?[]:e.imageInfo.formats],qualities:[...i.qualities,void 0===e.imageInfo.qualities?[]:e.imageInfo.qualities],resolutions:e.imageInfo.scale_factors,tileSize:void 0!==e.imageInfo.tile_width?void 0!==e.imageInfo.tile_height?[e.imageInfo.tile_width,e.imageInfo.tile_height]:[e.imageInfo.tile_width,e.imageInfo.tile_width]:null!=e.imageInfo.tile_height?[e.imageInfo.tile_height,e.imageInfo.tile_height]:void 0}},c[l.VERSION2]=function(e){const i=e.getComplianceLevelSupportedFeatures(),t=Array.isArray(e.imageInfo.profile)&&e.imageInfo.profile.length>1,o=t&&e.imageInfo.profile[1].supports?e.imageInfo.profile[1].supports:[],n=t&&e.imageInfo.profile[1].formats?e.imageInfo.profile[1].formats:[],r=t&&e.imageInfo.profile[1].qualities?e.imageInfo.profile[1].qualities:[];return{url:e.imageInfo["@id"].replace(/\/?(?:info\.json)?$/g,""),sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map((function(e){return[e.width,e.height]})),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map((function(e){return e.width}))[0],e.imageInfo.tiles.map((function(e){return void 0===e.height?e.width:e.height}))[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map((function(e){return e.scaleFactors}))[0],supports:[...i.supports,...o],formats:[...i.formats,...n],qualities:[...i.qualities,...r]}},c[l.VERSION3]=function(e){const i=e.getComplianceLevelSupportedFeatures(),t=void 0===e.imageInfo.extraFormats?i.formats:[...i.formats,...e.imageInfo.extraFormats],o=void 0!==e.imageInfo.preferredFormats&&Array.isArray(e.imageInfo.preferredFormats)&&e.imageInfo.preferredFormats.length>0?e.imageInfo.preferredFormats.filter((function(e){return["jpg","png","gif"].includes(e)})).reduce((function(e,i){return void 0===e&&t.includes(i)?i:e}),void 0):void 0;return{url:e.imageInfo.id,sizes:void 0===e.imageInfo.sizes?void 0:e.imageInfo.sizes.map((function(e){return[e.width,e.height]})),tileSize:void 0===e.imageInfo.tiles?void 0:[e.imageInfo.tiles.map((function(e){return e.width}))[0],e.imageInfo.tiles.map((function(e){return e.height}))[0]],resolutions:void 0===e.imageInfo.tiles?void 0:e.imageInfo.tiles.map((function(e){return e.scaleFactors}))[0],supports:void 0===e.imageInfo.extraFeatures?i.supports:[...i.supports,...e.imageInfo.extraFeatures],formats:t,qualities:void 0===e.imageInfo.extraQualities?i.qualities:[...i.qualities,...e.imageInfo.extraQualities],preferredFormat:o}};var p=class{constructor(e){this.setImageInfo(e)}setImageInfo(e){this.imageInfo="string"==typeof e?JSON.parse(e):e}getImageApiVersion(){if(void 0===this.imageInfo)return;let e=this.imageInfo["@context"]||"ol-no-context";"string"==typeof e&&(e=[e]);for(let i=0;i<e.length;i++)switch(e[i]){case"http://library.stanford.edu/iiif/image-api/1.1/context.json":case"http://iiif.io/api/image/1/context.json":return l.VERSION1;case"http://iiif.io/api/image/2/context.json":return l.VERSION2;case"http://iiif.io/api/image/3/context.json":return l.VERSION3;case"ol-no-context":if(this.getComplianceLevelEntryFromProfile(l.VERSION1)&&this.imageInfo.identifier)return l.VERSION1}(0,a.h)(!1,61)}getComplianceLevelEntryFromProfile(e){if(void 0!==this.imageInfo&&void 0!==this.imageInfo.profile)switch(void 0===e&&(e=this.getImageApiVersion()),e){case l.VERSION1:if(u.test(this.imageInfo.profile))return this.imageInfo.profile;break;case l.VERSION3:if(m.test(this.imageInfo.profile))return this.imageInfo.profile;break;case l.VERSION2:if("string"==typeof this.imageInfo.profile&&g.test(this.imageInfo.profile))return this.imageInfo.profile;if(Array.isArray(this.imageInfo.profile)&&this.imageInfo.profile.length>0&&"string"==typeof this.imageInfo.profile[0]&&g.test(this.imageInfo.profile[0]))return this.imageInfo.profile[0]}}getComplianceLevelFromProfile(e){const i=this.getComplianceLevelEntryFromProfile(e);if(void 0===i)return;const t=i.match(/level[0-2](?:\.json)?$/g);return Array.isArray(t)?t[0].replace(".json",""):void 0}getComplianceLevelSupportedFeatures(){if(void 0===this.imageInfo)return;const e=this.getImageApiVersion(),i=this.getComplianceLevelFromProfile(e);return void 0===i?f.none.none:f[e][i]}getTileSourceOptions(e){const i=e||{},t=this.getImageApiVersion();if(void 0===t)return;const o=void 0===t?void 0:c[t](this);return void 0!==o?{url:o.url,version:t,size:[this.imageInfo.width,this.imageInfo.height],sizes:o.sizes,format:void 0!==i.format&&o.formats.includes(i.format)?i.format:void 0!==o.preferredFormat?o.preferredFormat:"jpg",supports:o.supports,quality:i.quality&&o.qualities.includes(i.quality)?i.quality:o.qualities.includes("native")?"native":"default",resolutions:Array.isArray(o.resolutions)?o.resolutions.sort((function(e,i){return i-e})):void 0,tileSize:o.tileSize}:void 0}},d=t(6117),h=t(1898);function I(e){return e.toLocaleString("en",{maximumFractionDigits:10})}class v extends n.Z{constructor(e){const i=e||{};let t=i.url||"";t+=t.lastIndexOf("/")===t.length-1||""===t?"":"/";const n=i.version||l.VERSION2,f=i.sizes||[],u=i.size;(0,a.h)(null!=u&&Array.isArray(u)&&2==u.length&&!isNaN(u[0])&&u[0]>0&&!isNaN(u[1])&&u[1]>0,60);const g=u[0],m=u[1],c=i.tileSize,p=i.tilePixelRatio||1,v=i.format||"jpg",y=i.quality||(i.version==l.VERSION1?"native":"default");let z=i.resolutions||[];const B=i.supports||[],S=i.extent||[0,-m,g,0],x=null!=f&&Array.isArray(f)&&f.length>0,N=void 0!==c&&("number"==typeof c&&Number.isInteger(c)&&c>0||Array.isArray(c)&&c.length>0),E=null!=B&&Array.isArray(B)&&(B.includes("regionByPx")||B.includes("regionByPct"))&&(B.includes("sizeByWh")||B.includes("sizeByH")||B.includes("sizeByW")||B.includes("sizeByPct"));let q,O,P;if(z.sort((function(e,i){return i-e})),N||E)if(null!=c&&("number"==typeof c&&Number.isInteger(c)&&c>0?(q=c,O=c):Array.isArray(c)&&c.length>0&&((1==c.length||null==c[1]&&Number.isInteger(c[0]))&&(q=c[0],O=c[0]),2==c.length&&(Number.isInteger(c[0])&&Number.isInteger(c[1])?(q=c[0],O=c[1]):null==c[0]&&Number.isInteger(c[1])&&(q=c[1],O=c[1])))),void 0!==q&&void 0!==O||(q=s.S,O=s.S),0==z.length){P=Math.max(Math.ceil(Math.log(g/q)/Math.LN2),Math.ceil(Math.log(m/O)/Math.LN2));for(let e=P;e>=0;e--)z.push(Math.pow(2,e))}else{const e=Math.max(...z);P=Math.round(Math.log(e)/Math.LN2)}else if(q=g,O=m,z=[],x){f.sort((function(e,i){return e[0]-i[0]})),P=-1;const e=[];for(let i=0;i<f.length;i++){const t=g/f[i][0];z.length>0&&z[z.length-1]==t?e.push(i):(z.push(t),P++)}if(e.length>0)for(let i=0;i<e.length;i++)f.splice(e[i]-i,1)}else z.push(1),f.push([g,m]),P=0;const V=new o.Z({tileSize:[q,O],extent:S,origin:(0,d.rL)(S),resolutions:z}),R=r.z.bind(null,(0,h.Pq)(c||256).map((function(e){return e*p})));super({attributions:i.attributions,attributionsCollapsible:i.attributionsCollapsible,cacheSize:i.cacheSize,crossOrigin:i.crossOrigin,interpolate:i.interpolate,projection:i.projection,reprojectionErrorThreshold:i.reprojectionErrorThreshold,state:i.state,tileClass:R,tileGrid:V,tilePixelRatio:i.tilePixelRatio,tileUrlFunction:function(e,i,o){let r,s;const a=e[0];if(a>P)return;const u=e[1],c=e[2],p=z[a];if(!(void 0===u||void 0===c||void 0===p||u<0||Math.ceil(g/p/q)<=u||c<0||Math.ceil(m/p/O)<=c)){if(E||N){const e=u*q*p,i=c*O*p;let t=q*p,o=O*p,a=q,f=O;if(e+t>g&&(t=g-e),i+o>m&&(o=m-i),e+q*p>g&&(a=Math.floor((g-e+p-1)/p)),i+O*p>m&&(f=Math.floor((m-i+p-1)/p)),0==e&&t==g&&0==i&&o==m)r="full";else if(!E||B.includes("regionByPx"))r=e+","+i+","+t+","+o;else if(B.includes("regionByPct")){r="pct:"+I(e/g*100)+","+I(i/m*100)+","+I(t/g*100)+","+I(o/m*100)}n!=l.VERSION3||E&&!B.includes("sizeByWh")?!E||B.includes("sizeByW")?s=a+",":B.includes("sizeByH")?s=","+f:B.includes("sizeByWh")?s=a+","+f:B.includes("sizeByPct")&&(s="pct:"+I(100/p)):s=a+","+f}else if(r="full",x){const e=f[a][0],i=f[a][1];s=n==l.VERSION3?e==g&&i==m?"max":e+","+i:e==g?"full":e+","}else s=n==l.VERSION3?"max":"full";return t+r+"/"+s+"/0/"+y+"."+v}},transition:i.transition}),this.zDirection=i.zDirection}}var y=v,z=t(1055),B=t(2893),S=t(824);const x=new B.Z,N=new z.Z({layers:[x],target:"map"}),E=document.getElementById("iiif-notification"),q=document.getElementById("imageInfoUrl");function O(e){fetch(e).then((function(e){e.json().then((function(e){const i=new p(e).getTileSourceOptions();if(void 0===i||void 0===i.version)return void(E.textContent="Data seems to be no valid IIIF image information.");i.zDirection=-1;const t=new y(i);x.setSource(t),N.setView(new S.ZP({resolutions:t.getTileGrid().getResolutions(),extent:t.getTileGrid().getExtent(),constrainOnlyCenter:!0})),N.getView().fit(t.getTileGrid().getExtent()),E.textContent=""})).catch((function(e){E.textContent="Could not read image info json. "+e}))})).catch((function(){E.textContent="Could not read data from URL."}))}document.getElementById("display").addEventListener("click",(function(){O(q.value)})),O(q.value)}},function(e){var i;i=2247,e(e.s=i)}]);
//# sourceMappingURL=iiif.js.map