"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4824],{67832:function(e,t,n){var o=n(46960),a=n(83880),i=n(68444),c=n(96480),s=n(920),r=n(80372),d=n(86728),g=n(88470);const u=new d.cp({center:(0,g.QH)([5.8713,45.6452]),zoom:19}),l=new r.c({source:new c.c}),h=new i.c({layers:[l],target:"map",view:u}),m=document.getElementById("geolocation_marker"),p=new s.c({positioning:"center-center",element:m,stopEvent:!1});h.addOverlay(p);const f=new a.c([],"XYZM"),M=new o.c({projection:u.getProjection(),trackingOptions:{maximumAge:1e4,enableHighAccuracy:!0,timeout:6e5}});let w=500;M.on("change",(function(){const e=M.getPosition(),t=M.getAccuracy(),n=M.getHeading()||0,o=M.getSpeed()||0;!function(e,t,n,o){const a=e[0],i=e[1],c=f.getCoordinates(),s=c[c.length-1],r=s&&s[2];if(r){let e=t-(r%(2*Math.PI)+2*Math.PI)%(2*Math.PI);if(Math.abs(e)>Math.PI){e=-(e>=0?1:-1)*(2*Math.PI-Math.abs(e))}t=r+e}f.appendCoordinate([a,i,t,n]),f.setCoordinates(f.getCoordinates().slice(-20)),m.src=t&&o?"data/geolocation_marker_heading.png":"data/geolocation_marker.png"}(e,n,Date.now(),o);const a=f.getCoordinates(),i=a.length;i>=2&&(w=(a[i-1][3]-a[0][3])/(i-1));const c=["Position: "+e[0].toFixed(2)+", "+e[1].toFixed(2),"Accuracy: "+t,"Heading: "+Math.round((s=n,360*s/(2*Math.PI)))+"&deg;","Speed: "+(3.6*o).toFixed(1)+" km/h","Delta: "+Math.round(w)+"ms"].join("<br />");var s;document.getElementById("info").innerHTML=c})),M.on("error",(function(){alert("geolocation error")}));let k=0;function y(){let e=Date.now()-1.5*w;e=Math.max(e,k),k=e;const t=f.getCoordinateAtM(e,!0);t&&(u.setCenter(function(e,t,n){const o=h.getSize()[1];return[e[0]-Math.sin(t)*o*n*1/4,e[1]+Math.cos(t)*o*n*1/4]}(t,-t[2],u.getResolution())),u.setRotation(-t[2]),p.setPosition(t),h.render())}const I=document.getElementById("geolocate");let P;I.addEventListener("click",(function(){M.setTracking(!0),l.on("postrender",y),h.render(),E()}),!1);const b=new XMLHttpRequest;b.open("GET","data/geolocation-orientation.json"),b.onload=function(){P=JSON.parse(b.responseText).data},b.send();const C=document.getElementById("simulate");function v(e){const t=e.coords;M.set("accuracy",t.accuracy),M.set("heading",t.heading*Math.PI*2/360);const n=(0,g.QH)([t.longitude,t.latitude]);M.set("position",n),M.set("speed",t.speed),M.changed()}function E(){I.disabled="disabled",C.disabled="disabled"}C.addEventListener("click",(function(){const e=P,t=e.shift();v(t);let n=t.timestamp;!function t(){const o=e.shift();if(!o)return;const a=o.timestamp;v(o),window.setTimeout((function(){n=a,t()}),(a-n)/.5)}(),l.on("postrender",y),h.render(),E()}),!1)}},function(e){var t;t=67832,e(e.s=t)}]);
//# sourceMappingURL=geolocation-orientation.js.map