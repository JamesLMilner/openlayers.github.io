!function(){var t={303:function(t,e){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
e.read=function(t,e,r,n,i){var o,a,s=8*i-n-1,u=(1<<s)-1,l=u>>1,c=-7,f=r?i-1:0,h=r?-1:1,p=t[e+f];for(f+=h,o=p&(1<<-c)-1,p>>=-c,c+=s;c>0;o=256*o+t[e+f],f+=h,c-=8);for(a=o&(1<<-c)-1,o>>=-c,c+=n;c>0;a=256*a+t[e+f],f+=h,c-=8);if(0===o)o=1-l;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,n),o-=l}return(p?-1:1)*a*Math.pow(2,o-n)},e.write=function(t,e,r,n,i,o){var a,s,u,l=8*o-i-1,c=(1<<l)-1,f=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=n?0:o-1,y=n?1:-1,d=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=c):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+f>=1?h/u:h*Math.pow(2,1-f))*u>=2&&(a++,u/=2),a+f>=c?(s=0,a=c):a+f>=1?(s=(e*u-1)*Math.pow(2,i),a+=f):(s=e*Math.pow(2,f-1)*Math.pow(2,i),a=0));i>=8;t[r+p]=255&s,p+=y,s/=256,i-=8);for(a=a<<i|s,l+=i;l>0;t[r+p]=255&a,p+=y,a/=256,l-=8);t[r+p-y]|=128*d}},20:function(t,e){function r(t,e){var r=[],n=[];return null==e&&(e=function(t,e){return r[0]===e?"[Circular ~]":"[Circular ~."+n.slice(0,r.indexOf(e)).join(".")+"]"}),function(i,o){if(r.length>0){var a=r.indexOf(this);~a?r.splice(a+1):r.push(this),~a?n.splice(a,1/0,i):n.push(i),~r.indexOf(o)&&(o=e.call(this,i,o))}else r.push(o);return null==t?o:t.call(this,i,o)}}(t.exports=function(t,e,n,i){return JSON.stringify(t,r(e,i),n)}).getSerialize=r},443:function(t,e,r){"use strict";t.exports=i;var n=r(303);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o,s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function u(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function l(t,e,r){return r?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function c(t,e,r){var n=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));r.realloc(n);for(var i=r.pos-1;i>=t;i--)r.buf[i+n]=r.buf[i]}function f(t,e){for(var r=0;r<t.length;r++)e.writeVarint(t[r])}function h(t,e){for(var r=0;r<t.length;r++)e.writeSVarint(t[r])}function p(t,e){for(var r=0;r<t.length;r++)e.writeFloat(t[r])}function y(t,e){for(var r=0;r<t.length;r++)e.writeDouble(t[r])}function d(t,e){for(var r=0;r<t.length;r++)e.writeBoolean(t[r])}function v(t,e){for(var r=0;r<t.length;r++)e.writeFixed32(t[r])}function g(t,e){for(var r=0;r<t.length;r++)e.writeSFixed32(t[r])}function m(t,e){for(var r=0;r<t.length;r++)e.writeFixed64(t[r])}function b(t,e){for(var r=0;r<t.length;r++)e.writeSFixed64(t[r])}function _(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function x(t,e,r){t[r]=e,t[r+1]=e>>>8,t[r+2]=e>>>16,t[r+3]=e>>>24}function w(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,r){for(r=r||this.length;this.pos<r;){var n=this.readVarint(),i=n>>3,o=this.pos;this.type=7&n,t(i,e,this),this.pos===o&&this.skip(n)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=_(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=w(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=_(this.buf,this.pos)+_(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=_(this.buf,this.pos)+w(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=n.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=n.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,r,n=this.buf;return e=127&(r=n[this.pos++]),r<128?e:(e|=(127&(r=n[this.pos++]))<<7,r<128?e:(e|=(127&(r=n[this.pos++]))<<14,r<128?e:(e|=(127&(r=n[this.pos++]))<<21,r<128?e:function(t,e,r){var n,i,o=r.buf;if(i=o[r.pos++],n=(112&i)>>4,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(127&i)<<3,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(127&i)<<10,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(127&i)<<17,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(127&i)<<24,i<128)return l(t,n,e);if(i=o[r.pos++],n|=(1&i)<<31,i<128)return l(t,n,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(r=n[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&s?function(t,e,r){return s.decode(t.subarray(e,r))}(this.buf,e,t):function(t,e,r){var n="",i=e;for(;i<r;){var o,a,s,u=t[i],l=null,c=u>239?4:u>223?3:u>191?2:1;if(i+c>r)break;1===c?u<128&&(l=u):2===c?128==(192&(o=t[i+1]))&&(l=(31&u)<<6|63&o)<=127&&(l=null):3===c?(o=t[i+1],a=t[i+2],128==(192&o)&&128==(192&a)&&((l=(15&u)<<12|(63&o)<<6|63&a)<=2047||l>=55296&&l<=57343)&&(l=null)):4===c&&(o=t[i+1],a=t[i+2],s=t[i+3],128==(192&o)&&128==(192&a)&&128==(192&s)&&((l=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,c=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=c}return n}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var r=u(this);for(t=t||[];this.pos<r;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=u(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)for(;this.buf[this.pos++]>127;);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var r=new Uint8Array(e);r.set(this.buf),this.buf=r,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),x(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),x(this.buf,-1&t,this.pos),x(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var r,n;t>=0?(r=t%4294967296|0,n=t/4294967296|0):(n=~(-t/4294967296),4294967295^(r=~(-t%4294967296))?r=r+1|0:(r=0,n=n+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,r){r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos++]=127&t|128,t>>>=7,r.buf[r.pos]=127&t}(r,0,e),function(t,e){var r=(7&t)<<4;if(e.buf[e.pos++]|=r|((t>>>=3)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),!t)return;e.buf[e.pos++]=127&t}(n,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,r){for(var n,i,o=0;o<e.length;o++){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){n>56319||o+1===e.length?(t[r++]=239,t[r++]=191,t[r++]=189):i=n;continue}if(n<56320){t[r++]=239,t[r++]=191,t[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(t[r++]=239,t[r++]=191,t[r++]=189,i=null);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:(n<65536?t[r++]=n>>12|224:(t[r++]=n>>18|240,t[r++]=n>>12&63|128),t[r++]=n>>6&63|128),t[r++]=63&n|128)}return r}(this.buf,t,this.pos);var r=this.pos-e;r>=128&&c(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeFloat:function(t){this.realloc(4),n.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),n.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var r=0;r<e;r++)this.buf[this.pos++]=t[r]},writeRawMessage:function(t,e){this.pos++;var r=this.pos;t(e,this);var n=this.pos-r;n>=128&&c(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n},writeMessage:function(t,e,r){this.writeTag(t,i.Bytes),this.writeRawMessage(e,r)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,f,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,h,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,d,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,p,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,v,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,b,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},925:function(t,e,r){var n,i,o;function a(t){return(a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}o=function(){"use strict";function t(t,n,i,o,a){!function t(r,n,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=n-i+1,l=Math.log(s),c=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*c*(s-c)/s)*(u-s/2<0?-1:1);t(r,n,Math.max(i,Math.floor(n-u*c/s+f)),Math.min(o,Math.floor(n+(s-u)*c/s+f)),a)}var h=r[n],p=i,y=o;for(e(r,i,n),a(r[o],h)>0&&e(r,i,o);p<y;){for(e(r,p,y),p++,y--;a(r[p],h)<0;)p++;for(;a(r[y],h)>0;)y--}0===a(r[i],h)?e(r,i,y):e(r,++y,o),y<=n&&(i=y+1),n<=y&&(o=y-1)}}(t,n,i||0,o||t.length-1,a||r)}function e(t,e,r){var n=t[e];t[e]=t[r],t[r]=n}function r(t,e){return t<e?-1:t>e?1:0}var n=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function i(t,e,r){if(!r)return e.indexOf(t);for(var n=0;n<e.length;n++)if(r(t,e[n]))return n;return-1}function o(t,e){a(t,0,t.children.length,e,t)}function a(t,e,r,n,i){i||(i=y(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=e;o<r;o++){var a=t.children[o];s(i,t.leaf?n(a):a)}return i}function s(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function u(t,e){return t.minX-e.minX}function l(t,e){return t.minY-e.minY}function c(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function f(t){return t.maxX-t.minX+(t.maxY-t.minY)}function h(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function p(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function y(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(e,r,n,i,o){for(var a=[r,n];a.length;)if(!((n=a.pop())-(r=a.pop())<=i)){var s=r+Math.ceil((n-r)/i/2)*i;t(e,s,r,n,o),a.push(r,s,s,n)}}return n.prototype.all=function(){return this._all(this.data,[])},n.prototype.search=function(t){var e=this.data,r=[];if(!p(t,e))return r;for(var n=this.toBBox,i=[];e;){for(var o=0;o<e.children.length;o++){var a=e.children[o],s=e.leaf?n(a):a;p(t,s)&&(e.leaf?r.push(a):h(t,s)?this._all(a,r):i.push(a))}e=i.pop()}return r},n.prototype.collides=function(t){var e=this.data;if(!p(t,e))return!1;for(var r=[];e;){for(var n=0;n<e.children.length;n++){var i=e.children[n],o=e.leaf?this.toBBox(i):i;if(p(t,o)){if(e.leaf||h(t,o))return!0;r.push(i)}}e=r.pop()}return!1},n.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var e=0;e<t.length;e++)this.insert(t[e]);return this}var r=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===r.height)this._splitRoot(this.data,r);else{if(this.data.height<r.height){var n=this.data;this.data=r,r=n}this._insert(r,this.data.height-r.height-1,!0)}else this.data=r;return this},n.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},n.prototype.clear=function(){return this.data=y([]),this},n.prototype.remove=function(t,e){if(!t)return this;for(var r,n,o,a=this.data,s=this.toBBox(t),u=[],l=[];a||u.length;){if(a||(a=u.pop(),n=u[u.length-1],r=l.pop(),o=!0),a.leaf){var c=i(t,a.children,e);if(-1!==c)return a.children.splice(c,1),u.push(a),this._condense(u),this}o||a.leaf||!h(a,s)?n?(r++,a=n.children[r],o=!1):a=null:(u.push(a),l.push(r),r=0,n=a,a=a.children[0])}return this},n.prototype.toBBox=function(t){return t},n.prototype.compareMinX=function(t,e){return t.minX-e.minX},n.prototype.compareMinY=function(t,e){return t.minY-e.minY},n.prototype.toJSON=function(){return this.data},n.prototype.fromJSON=function(t){return this.data=t,this},n.prototype._all=function(t,e){for(var r=[];t;)t.leaf?e.push.apply(e,t.children):r.push.apply(r,t.children),t=r.pop();return e},n.prototype._build=function(t,e,r,n){var i,a=r-e+1,s=this._maxEntries;if(a<=s)return o(i=y(t.slice(e,r+1)),this.toBBox),i;n||(n=Math.ceil(Math.log(a)/Math.log(s)),s=Math.ceil(a/Math.pow(s,n-1))),(i=y([])).leaf=!1,i.height=n;var u=Math.ceil(a/s),l=u*Math.ceil(Math.sqrt(s));d(t,e,r,l,this.compareMinX);for(var c=e;c<=r;c+=l){var f=Math.min(c+l-1,r);d(t,c,f,u,this.compareMinY);for(var h=c;h<=f;h+=u){var p=Math.min(h+u-1,f);i.children.push(this._build(t,h,p,n-1))}}return o(i,this.toBBox),i},n.prototype._chooseSubtree=function(t,e,r,n){for(;n.push(e),!e.leaf&&n.length-1!==r;){for(var i=1/0,o=1/0,a=void 0,s=0;s<e.children.length;s++){var u=e.children[s],l=c(u),f=(h=t,p=u,(Math.max(p.maxX,h.maxX)-Math.min(p.minX,h.minX))*(Math.max(p.maxY,h.maxY)-Math.min(p.minY,h.minY))-l);f<o?(o=f,i=l<i?l:i,a=u):f===o&&l<i&&(i=l,a=u)}e=a||e.children[0]}var h,p;return e},n.prototype._insert=function(t,e,r){var n=r?t:this.toBBox(t),i=[],o=this._chooseSubtree(n,this.data,e,i);for(o.children.push(t),s(o,n);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(n,i,e)},n.prototype._split=function(t,e){var r=t[e],n=r.children.length,i=this._minEntries;this._chooseSplitAxis(r,i,n);var a=this._chooseSplitIndex(r,i,n),s=y(r.children.splice(a,r.children.length-a));s.height=r.height,s.leaf=r.leaf,o(r,this.toBBox),o(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(r,s)},n.prototype._splitRoot=function(t,e){this.data=y([t,e]),this.data.height=t.height+1,this.data.leaf=!1,o(this.data,this.toBBox)},n.prototype._chooseSplitIndex=function(t,e,r){for(var n,i,o,s,u,l,f,h=1/0,p=1/0,y=e;y<=r-e;y++){var d=a(t,0,y,this.toBBox),v=a(t,y,r,this.toBBox),g=(i=d,o=v,s=Math.max(i.minX,o.minX),u=Math.max(i.minY,o.minY),l=Math.min(i.maxX,o.maxX),f=Math.min(i.maxY,o.maxY),Math.max(0,l-s)*Math.max(0,f-u)),m=c(d)+c(v);g<h?(h=g,n=y,p=m<p?m:p):g===h&&m<p&&(p=m,n=y)}return n||r-e},n.prototype._chooseSplitAxis=function(t,e,r){var n=t.leaf?this.compareMinX:u,i=t.leaf?this.compareMinY:l;this._allDistMargin(t,e,r,n)<this._allDistMargin(t,e,r,i)&&t.children.sort(n)},n.prototype._allDistMargin=function(t,e,r,n){t.children.sort(n);for(var i=this.toBBox,o=a(t,0,e,i),u=a(t,r-e,r,i),l=f(o)+f(u),c=e;c<r-e;c++){var h=t.children[c];s(o,t.leaf?i(h):h),l+=f(o)}for(var p=r-e-1;p>=e;p--){var y=t.children[p];s(u,t.leaf?i(y):y),l+=f(u)}return l},n.prototype._adjustParentBBoxes=function(t,e,r){for(var n=r;n>=0;n--)s(e[n],t)},n.prototype._condense=function(t){for(var e=t.length-1,r=void 0;e>=0;e--)0===t[e].children.length?e>0?(r=t[e-1].children).splice(r.indexOf(t[e]),1):this.clear():o(t[e],this.toBBox)},n},"object"==a(e)?t.exports=o():void 0===(i="function"==typeof(n=o)?n.call(e,r,e,t):n)||(t.exports=i)}},e={};function r(n){var i=e[n];if(void 0!==i)return i.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,r),o.exports}!function(){"use strict";var t={RADIANS:"radians",DEGREES:"degrees",FEET:"ft",METERS:"m",PIXELS:"pixels",TILE_PIXELS:"tile-pixels",USFEET:"us-ft"};var e={};e[t.RADIANS]=6370997/(2*Math.PI),e[t.DEGREES]=2*Math.PI*6370997/360,e[t.FEET]=.3048,e[t.METERS]=1,e[t.USFEET]=1200/3937;var n=t;function i(){return function(){throw new Error("Unimplemented abstract method.")}()}var o=0;function a(t){return t.ol_uid||(t.ol_uid=String(++o))}var s="function"==typeof Object.assign?Object.assign:function(t,e){if(null==t)throw new TypeError("Cannot convert undefined or null to object");for(var r=Object(t),n=1,i=arguments.length;n<i;++n){var o=arguments[n];if(null!=o)for(var a in o)o.hasOwnProperty(a)&&(r[a]=o[a])}return r};function u(t){for(var e in t)delete t[e]}"function"==typeof Object.values&&Object.values;function l(t){var e;for(e in t)return!1;return!e}function c(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var f=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.code_=e.code,this.units_=e.units,this.extent_=void 0!==e.extent?e.extent:null,this.worldExtent_=void 0!==e.worldExtent?e.worldExtent:null,this.axisOrientation_=void 0!==e.axisOrientation?e.axisOrientation:"enu",this.global_=void 0!==e.global&&e.global,this.canWrapX_=!(!this.global_||!this.extent_),this.getPointResolutionFunc_=e.getPointResolution,this.defaultTileGrid_=null,this.metersPerUnit_=e.metersPerUnit}var r,n,i;return r=t,(n=[{key:"canWrapX",value:function(){return this.canWrapX_}},{key:"getCode",value:function(){return this.code_}},{key:"getExtent",value:function(){return this.extent_}},{key:"getUnits",value:function(){return this.units_}},{key:"getMetersPerUnit",value:function(){return this.metersPerUnit_||e[this.units_]}},{key:"getWorldExtent",value:function(){return this.worldExtent_}},{key:"getAxisOrientation",value:function(){return this.axisOrientation_}},{key:"isGlobal",value:function(){return this.global_}},{key:"setGlobal",value:function(t){this.global_=t,this.canWrapX_=!(!t||!this.extent_)}},{key:"getDefaultTileGrid",value:function(){return this.defaultTileGrid_}},{key:"setDefaultTileGrid",value:function(t){this.defaultTileGrid_=t}},{key:"setExtent",value:function(t){this.extent_=t,this.canWrapX_=!(!this.global_||!t)}},{key:"setWorldExtent",value:function(t){this.worldExtent_=t}},{key:"setGetPointResolution",value:function(t){this.getPointResolutionFunc_=t}},{key:"getPointResolutionFunc",value:function(){return this.getPointResolutionFunc_}}])&&c(r.prototype,n),i&&c(r,i),Object.defineProperty(r,"prototype",{writable:!1}),t}();function h(t,e,r){return Math.min(Math.max(t,e),r)}var p="cosh"in Math?Math.cosh:function(t){var e=Math.exp(t);return(e+1/e)/2},y="log2"in Math?Math.log2:function(t){return Math.log(t)*Math.LOG2E};function d(t,e,r,n,i,o){var a=i-r,s=o-n;if(0!==a||0!==s){var u=((t-r)*a+(e-n)*s)/(a*a+s*s);u>1?(r=i,n=o):u>0&&(r+=a*u,n+=s*u)}return v(t,e,r,n)}function v(t,e,r,n){var i=r-t,o=n-e;return i*i+o*o}function g(t){return t*Math.PI/180}function m(t,e){var r=t%e;return r*e<0?r+e:r}function b(t,e,r){return t+r*(e-t)}function _(t,e){var r=Math.pow(10,e);return Math.round(t*r)/r}function x(t,e){return Math.floor(_(t,e))}function w(t,e){return Math.ceil(_(t,e))}function k(t){return(k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function O(t,e){return(O=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=P(t);if(e){var i=P(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return C(this,r)}}function C(t,e){if(e&&("object"===k(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function P(t){return(P=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var R=6378137,j=Math.PI*R,E=[-j,-j,j,j],M=[-180,-85,180,85],F=R*Math.log(Math.tan(Math.PI/2)),I=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&O(t,e)}(a,t);var e,r,i,o=T(a);function a(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,{code:t,units:n.METERS,extent:E,global:!0,worldExtent:M,getPointResolution:function(t,e){return t/p(e[1]/R)}})}return e=a,r&&S(e.prototype,r),i&&S(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(f),D=[new I("EPSG:3857"),new I("EPSG:102100"),new I("EPSG:102113"),new I("EPSG:900913"),new I("http://www.opengis.net/def/crs/EPSG/0/3857"),new I("http://www.opengis.net/gml/srs/epsg.xml#3857")];function z(t,e,r){var n=t.length,i=r>1?r:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(n));for(var a=0;a<n;a+=i){o[a]=j*t[a]/180;var s=R*Math.log(Math.tan(Math.PI*(+t[a+1]+90)/360));s>F?s=F:s<-F&&(s=-F),o[a+1]=s}return o}function A(t,e,r){var n=t.length,i=r>1?r:2,o=e;void 0===o&&(o=i>2?t.slice():new Array(n));for(var a=0;a<n;a+=i)o[a]=180*t[a]/j,o[a+1]=360*Math.atan(Math.exp(t[a+1]/R))/Math.PI-90;return o}function L(t){return(L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function G(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function B(t,e){return(B=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function W(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Y(t);if(e){var i=Y(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return X(this,r)}}function X(t,e){if(e&&("object"===L(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Y(t){return(Y=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var q=[-180,-90,180,90],N=6378137*Math.PI/180,V=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&B(t,e)}(a,t);var e,r,i,o=W(a);function a(t,e){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this,{code:t,units:n.DEGREES,extent:q,axisOrientation:e,global:!0,metersPerUnit:N,worldExtent:q})}return e=a,r&&G(e.prototype,r),i&&G(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}(f),Z=[new V("CRS:84"),new V("EPSG:4326","neu"),new V("urn:ogc:def:crs:OGC:1.3:CRS84"),new V("urn:ogc:def:crs:OGC:2:84"),new V("http://www.opengis.net/def/crs/OGC/1.3/CRS84"),new V("http://www.opengis.net/gml/srs/epsg.xml#4326","neu"),new V("http://www.opengis.net/def/crs/EPSG/0/4326","neu")],U={};var K={};function H(t,e,r){var n=t.getCode(),i=e.getCode();n in K||(K[n]={}),K[n][i]=r}var J="bottom-left",$="bottom-right",Q="top-left",tt="top-right",et=0,rt=1,nt=2,it=4,ot=8,at=16;function st(t){return(st="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ut(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lt(t,e){if(e&&("object"===st(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ct(t){var e="function"==typeof Map?new Map:void 0;return(ct=function(t){if(null===t||(r=t,-1===Function.toString.call(r).indexOf("[native code]")))return t;var r;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return ft(t,arguments,yt(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),pt(n,t)})(t)}function ft(t,e,r){return(ft=ht()?Reflect.construct.bind():function(t,e,r){var n=[null];n.push.apply(n,e);var i=new(Function.bind.apply(t,n));return r&&pt(i,r.prototype),i}).apply(null,arguments)}function ht(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function pt(t,e){return(pt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function yt(t){return(yt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var dt=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pt(t,e)}(s,t);var e,r,n,i,o,a=(e=s,r=ht(),function(){var t,n=yt(e);if(r){var i=yt(this).constructor;t=Reflect.construct(n,arguments,i)}else t=n.apply(this,arguments);return lt(this,t)});function s(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s);var r="Assertion failed. See https://openlayers.org/en/latest/doc/errors/#"+t+" for details.";return(e=a.call(this,r)).code=t,e.name="AssertionError",e.message=r,e}return n=s,i&&ut(n.prototype,i),o&&ut(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n}(ct(Error));function vt(t,e){if(!t)throw new dt(e)}function gt(t){for(var e=St(),r=0,n=t.length;r<n;++r)Et(e,t[r]);return e}function mt(t,e,r){return r?(r[0]=t[0]-e,r[1]=t[1]-e,r[2]=t[2]+e,r[3]=t[3]+e,r):[t[0]-e,t[1]-e,t[2]+e,t[3]+e]}function bt(t,e,r){var n,i;return(n=e<t[0]?t[0]-e:t[2]<e?e-t[2]:0)*n+(i=r<t[1]?t[1]-r:t[3]<r?r-t[3]:0)*i}function _t(t,e){return wt(t,e[0],e[1])}function xt(t,e){return t[0]<=e[0]&&e[2]<=t[2]&&t[1]<=e[1]&&e[3]<=t[3]}function wt(t,e,r){return t[0]<=e&&e<=t[2]&&t[1]<=r&&r<=t[3]}function kt(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=e[0],s=e[1],u=et;return a<r?u|=at:a>i&&(u|=it),s<n?u|=ot:s>o&&(u|=nt),u===et&&(u=rt),u}function St(){return[1/0,1/0,-1/0,-1/0]}function Ot(t,e,r,n,i){return i?(i[0]=t,i[1]=e,i[2]=r,i[3]=n,i):[t,e,r,n]}function Tt(t){return Ot(1/0,1/0,-1/0,-1/0,t)}function Ct(t,e){var r=t[0],n=t[1];return Ot(r,n,r,n,e)}function Pt(t,e,r,n,i){return Mt(Tt(i),t,e,r,n)}function Rt(t,e){return t[0]==e[0]&&t[2]==e[2]&&t[1]==e[1]&&t[3]==e[3]}function jt(t,e){return e[0]<t[0]&&(t[0]=e[0]),e[2]>t[2]&&(t[2]=e[2]),e[1]<t[1]&&(t[1]=e[1]),e[3]>t[3]&&(t[3]=e[3]),t}function Et(t,e){e[0]<t[0]&&(t[0]=e[0]),e[0]>t[2]&&(t[2]=e[0]),e[1]<t[1]&&(t[1]=e[1]),e[1]>t[3]&&(t[3]=e[1])}function Mt(t,e,r,n,i){for(;r<n;r+=i)Ft(t,e[r],e[r+1]);return t}function Ft(t,e,r){t[0]=Math.min(t[0],e),t[1]=Math.min(t[1],r),t[2]=Math.max(t[2],e),t[3]=Math.max(t[3],r)}function It(t,e){var r;return(r=e(zt(t)))||(r=e(At(t)))||(r=e(Yt(t)))?r:(r=e(Xt(t)))||!1}function Dt(t){var e=0;return function(t){return t[2]<t[0]||t[3]<t[1]}(t)||(e=qt(t)*Bt(t)),e}function zt(t){return[t[0],t[1]]}function At(t){return[t[2],t[1]]}function Lt(t){return[(t[0]+t[2])/2,(t[1]+t[3])/2]}function Gt(t,e){var r;return e===J?r=zt(t):e===$?r=At(t):e===Q?r=Xt(t):e===tt?r=Yt(t):vt(!1,13),r}function Bt(t){return t[3]-t[1]}function Wt(t,e,r){var n=r||[1/0,1/0,-1/0,-1/0];return Nt(t,e)?(t[0]>e[0]?n[0]=t[0]:n[0]=e[0],t[1]>e[1]?n[1]=t[1]:n[1]=e[1],t[2]<e[2]?n[2]=t[2]:n[2]=e[2],t[3]<e[3]?n[3]=t[3]:n[3]=e[3]):Tt(n),n}function Xt(t){return[t[0],t[3]]}function Yt(t){return[t[2],t[3]]}function qt(t){return t[2]-t[0]}function Nt(t,e){return t[0]<=e[2]&&t[2]>=e[0]&&t[1]<=e[3]&&t[3]>=e[1]}function Vt(t,e,r,n){var i=[];if(n>1)for(var o=t[2]-t[0],a=t[3]-t[1],s=0;s<n;++s)i.push(t[0]+o*s/n,t[1],t[2],t[1]+a*s/n,t[2]-o*s/n,t[3],t[0],t[3]-a*s/n);else i=[t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]];e(i,i,2);for(var u=[],l=[],c=0,f=i.length;c<f;c+=2)u.push(i[c]),l.push(i[c+1]);return function(t,e,r){return Ot(Math.min.apply(null,t),Math.min.apply(null,e),Math.max.apply(null,t),Math.max.apply(null,e),r)}(u,l,r)}var Zt=6371008.8;function Ut(t,e,r){var n=r||Zt,i=g(t[1]),o=g(e[1]),a=(o-i)/2,s=g(e[0]-t[0])/2,u=Math.sin(a)*Math.sin(a)+Math.sin(s)*Math.sin(s)*Math.cos(i)*Math.cos(o);return 2*n*Math.atan2(Math.sqrt(u),Math.sqrt(1-u))}function Kt(t,e,r){var n;if(void 0!==e){for(var i=0,o=t.length;i<o;++i)e[i]=t[i];n=e}else n=t.slice();return n}function Ht(t,e,r){if(void 0!==e&&t!==e){for(var n=0,i=t.length;n<i;++n)e[n]=t[n];t=e}return t}function Jt(t){!function(t,e){U[t]=e}(t.getCode(),t),H(t,t,Kt)}function $t(t){return"string"==typeof t?U[e=t]||U[e.replace(/urn:(x-)?ogc:def:crs:EPSG:(.*:)?(\w+)$/,"EPSG:$3")]||null:t||null;var e}function Qt(t,r,i,o){var a,s=(t=$t(t)).getPointResolutionFunc();if(s){if(a=s(r,i),o&&o!==t.getUnits()){var u=t.getMetersPerUnit();u&&(a=a*u/e[o])}}else{var l=t.getUnits();if(l==n.DEGREES&&!o||o==n.DEGREES)a=r;else{var c=re(t,$t("EPSG:4326"));if(c===Ht&&l!==n.DEGREES)a=r*t.getMetersPerUnit();else{var f=[i[0]-r/2,i[1],i[0]+r/2,i[1],i[0],i[1]-r/2,i[0],i[1]+r/2];a=(Ut((f=c(f,f,2)).slice(0,2),f.slice(2,4))+Ut(f.slice(4,6),f.slice(6,8)))/2}var h=o?e[o]:t.getMetersPerUnit();void 0!==h&&(a/=h)}}return a}function te(t){!function(t){t.forEach(Jt)}(t),t.forEach((function(e){t.forEach((function(t){e!==t&&H(e,t,Kt)}))}))}function ee(t,e){if(t===e)return!0;var r=t.getUnits()===e.getUnits();return(t.getCode()===e.getCode()||re(t,e)===Kt)&&r}function re(t,e){var r=function(t,e){var r;return t in K&&e in K[t]&&(r=K[t][e]),r}(t.getCode(),e.getCode());return r||(r=Ht),r}function ne(t,e){return re($t(t),$t(e))}function ie(t,e,r){return ne(e,r)(t,void 0,t.length)}function oe(t,e,r,n){return Vt(t,ne(e,r),void 0,n)}var ae,se,ue,le=null;function ce(t,e){return le?oe(t,le,e):t}function fe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}te(D),te(Z),ae=D,se=z,ue=A,Z.forEach((function(t){ae.forEach((function(e){H(t,e,se),H(e,t,ue)}))}));var he=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.dataProjection=void 0,this.defaultFeatureProjection=void 0,this.supportedMediaTypes=null}var e,r,o;return e=t,(r=[{key:"getReadOptions",value:function(t,e){var r;if(e){var i=e.dataProjection?$t(e.dataProjection):this.readProjection(t);e.extent&&i&&i.getUnits()===n.TILE_PIXELS&&(i=$t(i)).setWorldExtent(e.extent),r={dataProjection:i,featureProjection:e.featureProjection}}return this.adaptOptions(r)}},{key:"adaptOptions",value:function(t){return s({dataProjection:this.dataProjection,featureProjection:this.defaultFeatureProjection},t)}},{key:"getType",value:function(){return i()}},{key:"readFeature",value:function(t,e){return i()}},{key:"readFeatures",value:function(t,e){return i()}},{key:"readGeometry",value:function(t,e){return i()}},{key:"readProjection",value:function(t){return i()}},{key:"writeFeature",value:function(t,e){return i()}},{key:"writeFeatures",value:function(t,e){return i()}},{key:"writeGeometry",value:function(t,e){return i()}}])&&fe(e.prototype,r),o&&fe(e,o),Object.defineProperty(e,"prototype",{writable:!1}),t}();function pe(t,e,r){var n,i=r?$t(r.featureProjection):null,o=r?$t(r.dataProjection):null;if(n=i&&o&&!ee(i,o)?(e?t.clone():t).transform(e?i:o,e?o:i):t,e&&r&&void 0!==r.decimals){var a=Math.pow(10,r.decimals);n===t&&(n=t.clone()),n.applyTransform((function(t){for(var e=0,r=t.length;e<r;++e)t[e]=Math.round(t[e]*a)/a;return t}))}return n}var ye="arraybuffer",de="json",ve="text",ge="xml",me="XY",be="XYZ",_e="XYM",xe="XYZM",we="Point",ke="LineString",Se="LinearRing",Oe="Polygon",Te="MultiPoint",Ce="MultiLineString",Pe="MultiPolygon",Re="GeometryCollection",je="Circle";function Ee(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Me=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.propagationStopped,this.defaultPrevented,this.type=e,this.target=null}var e,r,n;return e=t,(r=[{key:"preventDefault",value:function(){this.defaultPrevented=!0}},{key:"stopPropagation",value:function(){this.propagationStopped=!0}}])&&Ee(e.prototype,r),n&&Ee(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Fe="propertychange";function Ie(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function De(t,e){return t>e?1:t<e?-1:0}function ze(t,e,r){for(;e<r;){var n=t[e];t[e]=t[r],t[r]=n,++e,--r}}function Ae(t,e){for(var r=Array.isArray(e)?e:[e],n=r.length,i=0;i<n;i++)t[t.length]=r[i]}function Le(t,e){var r=t.length;if(r!==e.length)return!1;for(var n=0;n<r;n++)if(t[n]!==e[n])return!1;return!0}function Ge(){}function Be(t){return(Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function We(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xe(t,e){return(Xe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ye(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ne(t);if(e){var i=Ne(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return qe(this,r)}}function qe(t,e){if(e&&("object"===Be(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ne(t){return(Ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ve=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xe(t,e)}(o,t);var e,r,n,i=Ye(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).eventTarget_=t,e.pendingRemovals_=null,e.dispatching_=null,e.listeners_=null,e}return e=o,(r=[{key:"addEventListener",value:function(t,e){if(t&&e){var r=this.listeners_||(this.listeners_={}),n=r[t]||(r[t]=[]);-1===n.indexOf(e)&&n.push(e)}}},{key:"dispatchEvent",value:function(t){var e="string"==typeof t,r=e?t:t.type,n=this.listeners_&&this.listeners_[r];if(n){var i=e?new Me(t):t;i.target||(i.target=this.eventTarget_||this);var o,a=this.dispatching_||(this.dispatching_={}),s=this.pendingRemovals_||(this.pendingRemovals_={});r in a||(a[r]=0,s[r]=0),++a[r];for(var u=0,l=n.length;u<l;++u)if(!1===(o="handleEvent"in n[u]?n[u].handleEvent(i):n[u].call(this,i))||i.propagationStopped){o=!1;break}if(0==--a[r]){var c=s[r];for(delete s[r];c--;)this.removeEventListener(r,Ge);delete a[r]}return o}}},{key:"disposeInternal",value:function(){this.listeners_&&u(this.listeners_)}},{key:"getListeners",value:function(t){return this.listeners_&&this.listeners_[t]||void 0}},{key:"hasListener",value:function(t){return!!this.listeners_&&(t?t in this.listeners_:Object.keys(this.listeners_).length>0)}},{key:"removeEventListener",value:function(t,e){var r=this.listeners_&&this.listeners_[t];if(r){var n=r.indexOf(e);-1!==n&&(this.pendingRemovals_&&t in this.pendingRemovals_?(r[n]=Ge,++this.pendingRemovals_[t]):(r.splice(n,1),0===r.length&&delete this.listeners_[t]))}}}])&&We(e.prototype,r),n&&We(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.disposed=!1}var e,r,n;return e=t,(r=[{key:"dispose",value:function(){this.disposed||(this.disposed=!0,this.disposeInternal())}},{key:"disposeInternal",value:function(){}}])&&Ie(e.prototype,r),n&&Ie(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()),Ze="change",Ue="error",Ke="load";function He(t,e,r,n,i){if(n&&n!==t&&(r=r.bind(n)),i){var o=r;r=function(){t.removeEventListener(e,r),o.apply(this,arguments)}}var a={target:t,type:e,listener:r};return t.addEventListener(e,r),a}function Je(t,e,r,n){return He(t,e,r,n,!0)}function $e(t){t&&t.target&&(t.target.removeEventListener(t.type,t.listener),u(t))}function Qe(t){return(Qe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function tr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function er(t,e){return(er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function rr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ir(t);if(e){var i=ir(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return nr(this,r)}}function nr(t,e){if(e&&("object"===Qe(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ir(t){return(ir=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var or=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&er(t,e)}(o,t);var e,r,n,i=rr(o);function o(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(t=i.call(this)).on=t.onInternal,t.once=t.onceInternal,t.un=t.unInternal,t.revision_=0,t}return e=o,(r=[{key:"changed",value:function(){++this.revision_,this.dispatchEvent(Ze)}},{key:"getRevision",value:function(){return this.revision_}},{key:"onInternal",value:function(t,e){if(Array.isArray(t)){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=He(this,t[i],e);return n}return He(this,t,e)}},{key:"onceInternal",value:function(t,e){var r;if(Array.isArray(t)){var n=t.length;r=new Array(n);for(var i=0;i<n;++i)r[i]=Je(this,t[i],e)}else r=Je(this,t,e);return e.ol_key=r,r}},{key:"unInternal",value:function(t,e){var r=e.ol_key;if(r)!function(t){if(Array.isArray(t))for(var e=0,r=t.length;e<r;++e)$e(t[e]);else $e(t)}(r);else if(Array.isArray(t))for(var n=0,i=t.length;n<i;++n)this.removeEventListener(t[n],e);else this.removeEventListener(t,e)}}])&&tr(e.prototype,r),n&&tr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Ve);or.prototype.on,or.prototype.once,or.prototype.un;var ar=or;function sr(t){return(sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ur(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function lr(t,e,r){return e&&ur(t.prototype,e),r&&ur(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function cr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function fr(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&hr(t,e)}function hr(t,e){return(hr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function pr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=vr(t);if(e){var i=vr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return yr(this,r)}}function yr(t,e){if(e&&("object"===sr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return dr(t)}function dr(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function vr(t){return(vr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var gr,mr=function(t){fr(r,t);var e=pr(r);function r(t,n,i){var o;return cr(this,r),(o=e.call(this,t)).key=n,o.oldValue=i,o}return lr(r)}(Me),br=function(t){fr(r,t);var e=pr(r);function r(t){var n;return cr(this,r),(n=e.call(this)).on,n.once,n.un,a(dr(n)),n.values_=null,void 0!==t&&n.setProperties(t),n}return lr(r,[{key:"get",value:function(t){var e;return this.values_&&this.values_.hasOwnProperty(t)&&(e=this.values_[t]),e}},{key:"getKeys",value:function(){return this.values_&&Object.keys(this.values_)||[]}},{key:"getProperties",value:function(){return this.values_&&s({},this.values_)||{}}},{key:"hasProperties",value:function(){return!!this.values_}},{key:"notify",value:function(t,e){var r;r="change:".concat(t),this.hasListener(r)&&this.dispatchEvent(new mr(r,t,e)),r=Fe,this.hasListener(r)&&this.dispatchEvent(new mr(r,t,e))}},{key:"addChangeListener",value:function(t,e){this.addEventListener("change:".concat(t),e)}},{key:"removeChangeListener",value:function(t,e){this.removeEventListener("change:".concat(t),e)}},{key:"set",value:function(t,e,r){var n=this.values_||(this.values_={});if(r)n[t]=e;else{var i=n[t];n[t]=e,i!==e&&this.notify(t,i)}}},{key:"setProperties",value:function(t,e){for(var r in t)this.set(r,t[r],e)}},{key:"applyProperties",value:function(t){t.values_&&s(this.values_||(this.values_={}),t.values_)}},{key:"unset",value:function(t,e){if(this.values_&&t in this.values_){var r=this.values_[t];delete this.values_[t],l(this.values_)&&(this.values_=null),e||this.notify(t,r)}}}]),r}(ar),_r="undefined"!=typeof navigator&&void 0!==navigator.userAgent?navigator.userAgent.toLowerCase():"",xr=(_r.indexOf("firefox"),-1!==_r.indexOf("safari")&&-1==_r.indexOf("chrom")&&(_r.indexOf("version/15.4")>=0||_r.match(/cpu (os|iphone os) 15_4 like mac os x/)),-1!==_r.indexOf("webkit")&&_r.indexOf("edge"),_r.indexOf("macintosh"),"undefined"!=typeof devicePixelRatio&&devicePixelRatio,"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas&&self instanceof WorkerGlobalScope),wr="undefined"!=typeof Image&&Image.prototype.decode,kr=(function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("_",null,e),window.removeEventListener("_",null,e)}catch(t){}}(),new Array(6));function Sr(t){return Tr(t,1,0,0,1,0,0)}function Or(t,e){var r=t[0],n=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=e[0],l=e[1],c=e[2],f=e[3],h=e[4],p=e[5];return t[0]=r*u+i*l,t[1]=n*u+o*l,t[2]=r*c+i*f,t[3]=n*c+o*f,t[4]=r*h+i*p+a,t[5]=n*h+o*p+s,t}function Tr(t,e,r,n,i,o,a){return t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=o,t[5]=a,t}function Cr(t,e){var r=e[0],n=e[1];return e[0]=t[0]*r+t[2]*n+t[4],e[1]=t[1]*r+t[3]*n+t[5],e}function Pr(t,e,r){return Or(t,Tr(kr,e,0,0,r,0,0))}function Rr(t,e,r,n,i,o,a,s){var u=Math.sin(o),l=Math.cos(o);return t[0]=n*l,t[1]=i*u,t[2]=-n*u,t[3]=i*l,t[4]=a*n*l-s*n*u+e,t[5]=a*i*u+s*i*l+r,t}function jr(t,e){var r,n=(r=e)[0]*r[3]-r[1]*r[2];vt(0!==n,32);var i=e[0],o=e[1],a=e[2],s=e[3],u=e[4],l=e[5];return t[0]=s/n,t[1]=-o/n,t[2]=-a/n,t[3]=i/n,t[4]=(a*l-s*u)/n,t[5]=-(i*l-o*u)/n,t}function Er(t){var e="matrix("+t.join(", ")+")";if(xr)return e;var r=gr||(gr=document.createElement("div"));return r.style.transform=e,r.style.transform}function Mr(t,e,r,n,i,o){for(var a=o||[],s=0,u=e;u<r;u+=n){var l=t[u],c=t[u+1];a[s++]=i[0]*l+i[2]*c+i[4],a[s++]=i[1]*l+i[3]*c+i[5]}return o&&a.length!=s&&(a.length=s),a}function Fr(t,e,r,n,i,o,a){for(var s=a||[],u=Math.cos(i),l=Math.sin(i),c=o[0],f=o[1],h=0,p=e;p<r;p+=n){var y=t[p]-c,d=t[p+1]-f;s[h++]=c+y*u-d*l,s[h++]=f+y*l+d*u;for(var v=p+2;v<p+n;++v)s[h++]=t[v]}return a&&s.length!=h&&(s.length=h),s}function Ir(t){return(Ir="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Dr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function zr(t,e){return(zr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ar(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Gr(t);if(e){var i=Gr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Lr(this,r)}}function Lr(t,e){if(e&&("object"===Ir(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Gr(t){return(Gr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Br=[1,0,0,1,0,0],Wr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zr(t,e)}(s,t);var e,r,o,a=Ar(s);function s(){var t,e,r,n,i,o;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,s),(t=a.call(this)).extent_=[1/0,1/0,-1/0,-1/0],t.extentRevision_=-1,t.simplifiedGeometryMaxMinSquaredTolerance=0,t.simplifiedGeometryRevision=0,t.simplifyTransformedInternal=(e=function(t,e,r){if(!r)return this.getSimplifiedGeometry(e);var n=this.clone();return n.applyTransform(r),n.getSimplifiedGeometry(e)},o=!1,function(){var t=Array.prototype.slice.call(arguments);return o&&this===i&&Le(t,n)||(o=!0,i=this,n=t,r=e.apply(this,arguments)),r}),t}return e=s,(r=[{key:"simplifyTransformed",value:function(t,e){return this.simplifyTransformedInternal(this.getRevision(),t,e)}},{key:"clone",value:function(){return i()}},{key:"closestPointXY",value:function(t,e,r,n){return i()}},{key:"containsXY",value:function(t,e){var r=this.getClosestPoint([t,e]);return r[0]===t&&r[1]===e}},{key:"getClosestPoint",value:function(t,e){var r=e||[NaN,NaN];return this.closestPointXY(t[0],t[1],r,1/0),r}},{key:"intersectsCoordinate",value:function(t){return this.containsXY(t[0],t[1])}},{key:"computeExtent",value:function(t){return i()}},{key:"getExtent",value:function(t){if(this.extentRevision_!=this.getRevision()){var e=this.computeExtent(this.extent_);(isNaN(e[0])||isNaN(e[1]))&&Tt(e),this.extentRevision_=this.getRevision()}return function(t,e){return e?(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e):t}(this.extent_,t)}},{key:"rotate",value:function(t,e){i()}},{key:"scale",value:function(t,e,r){i()}},{key:"simplify",value:function(t){return this.getSimplifiedGeometry(t*t)}},{key:"getSimplifiedGeometry",value:function(t){return i()}},{key:"getType",value:function(){return i()}},{key:"applyTransform",value:function(t){i()}},{key:"intersectsExtent",value:function(t){return i()}},{key:"translate",value:function(t,e){i()}},{key:"transform",value:function(t,e){var r=$t(t),i=r.getUnits()==n.TILE_PIXELS?function(t,n,i){var o=r.getExtent(),a=r.getWorldExtent(),s=Bt(a)/Bt(o);return Rr(Br,a[0],a[3],s,-s,0,0,0),Mr(t,0,t.length,i,Br,n),ne(r,e)(t,n,i)}:ne(r,e);return this.applyTransform(i),this}}])&&Dr(e.prototype,r),o&&Dr(e,o),Object.defineProperty(e,"prototype",{writable:!1}),s}(br);function Xr(t){return(Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qr(t,e){return(qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Nr(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Zr(t);if(e){var i=Zr(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Vr(this,r)}}function Vr(t,e){if(e&&("object"===Xr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Zr(t){return(Zr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Ur(t){var e;return t==me?e=2:t==be||t==_e?e=3:t==xe&&(e=4),e}var Kr=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qr(t,e)}(a,t);var e,r,n,o=Nr(a);function a(){var t;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(t=o.call(this)).layout=me,t.stride=2,t.flatCoordinates=null,t}return e=a,(r=[{key:"computeExtent",value:function(t){return Pt(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}},{key:"getCoordinates",value:function(){return i()}},{key:"getFirstCoordinate",value:function(){return this.flatCoordinates.slice(0,this.stride)}},{key:"getFlatCoordinates",value:function(){return this.flatCoordinates}},{key:"getLastCoordinate",value:function(){return this.flatCoordinates.slice(this.flatCoordinates.length-this.stride)}},{key:"getLayout",value:function(){return this.layout}},{key:"getSimplifiedGeometry",value:function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<=this.simplifiedGeometryMaxMinSquaredTolerance)return this;var e=this.getSimplifiedGeometryInternal(t);return e.getFlatCoordinates().length<this.flatCoordinates.length?e:(this.simplifiedGeometryMaxMinSquaredTolerance=t,this)}},{key:"getSimplifiedGeometryInternal",value:function(t){return this}},{key:"getStride",value:function(){return this.stride}},{key:"setFlatCoordinates",value:function(t,e){this.stride=Ur(t),this.layout=t,this.flatCoordinates=e}},{key:"setCoordinates",value:function(t,e){i()}},{key:"setLayout",value:function(t,e,r){var n;if(t)n=Ur(t);else{for(var i=0;i<r;++i){if(0===e.length)return this.layout=me,void(this.stride=2);e=e[0]}t=function(t){var e;return 2==t?e=me:3==t?e=be:4==t&&(e=xe),e}(n=e.length)}this.layout=t,this.stride=n}},{key:"applyTransform",value:function(t){this.flatCoordinates&&(t(this.flatCoordinates,this.flatCoordinates,this.stride),this.changed())}},{key:"rotate",value:function(t,e){var r=this.getFlatCoordinates();if(r){var n=this.getStride();Fr(r,0,r.length,n,t,e,r),this.changed()}}},{key:"scale",value:function(t,e,r){var n=e;void 0===n&&(n=t);var i=r;i||(i=Lt(this.getExtent()));var o=this.getFlatCoordinates();if(o){var a=this.getStride();!function(t,e,r,n,i,o,a,s){for(var u=s||[],l=a[0],c=a[1],f=0,h=e;h<r;h+=n){var p=t[h]-l,y=t[h+1]-c;u[f++]=l+i*p,u[f++]=c+o*y;for(var d=h+2;d<h+n;++d)u[f++]=t[d]}s&&u.length!=f&&(u.length=f)}(o,0,o.length,a,t,n,i,o),this.changed()}}},{key:"translate",value:function(t,e){var r=this.getFlatCoordinates();if(r){var n=this.getStride();!function(t,e,r,n,i,o,a){for(var s=a||[],u=0,l=e;l<r;l+=n){s[u++]=t[l]+i,s[u++]=t[l+1]+o;for(var c=l+2;c<l+n;++c)s[u++]=t[c]}a&&s.length!=u&&(s.length=u)}(r,0,r.length,n,t,e,r),this.changed()}}}])&&Yr(e.prototype,r),n&&Yr(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Wr);function Hr(t,e,r,n,i,o,a){var s,u=t[e],l=t[e+1],c=t[r]-u,f=t[r+1]-l;if(0===c&&0===f)s=e;else{var h=((i-u)*c+(o-l)*f)/(c*c+f*f);if(h>1)s=r;else{if(h>0){for(var p=0;p<n;++p)a[p]=b(t[e+p],t[r+p],h);return void(a.length=n)}s=e}}for(var y=0;y<n;++y)a[y]=t[s+y];a.length=n}function Jr(t,e,r,n,i){var o=t[e],a=t[e+1];for(e+=n;e<r;e+=n){var s=t[e],u=t[e+1],l=v(o,a,s,u);l>i&&(i=l),o=s,a=u}return i}function $r(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=Jr(t,e,s,n,i),e=s}return i}function Qr(t,e,r,n,i,o,a,s,u,l,c){if(e==r)return l;var f,h;if(0===i){if((h=v(a,s,t[e],t[e+1]))<l){for(f=0;f<n;++f)u[f]=t[e+f];return u.length=n,h}return l}for(var p=c||[NaN,NaN],y=e+n;y<r;)if(Hr(t,y-n,y,n,a,s,p),(h=v(a,s,p[0],p[1]))<l){for(l=h,f=0;f<n;++f)u[f]=p[f];u.length=n,y+=n}else y+=n*Math.max((Math.sqrt(h)-Math.sqrt(l))/i|0,1);if(o&&(Hr(t,r-n,e,n,a,s,p),(h=v(a,s,p[0],p[1]))<l)){for(l=h,f=0;f<n;++f)u[f]=p[f];u.length=n}return l}function tn(t,e,r,n,i,o,a,s,u,l,c){for(var f=c||[NaN,NaN],h=0,p=r.length;h<p;++h){var y=r[h];l=Qr(t,e,y,n,i,o,a,s,u,l,f),e=y}return l}function en(t,e,r,n){for(var i=0,o=r.length;i<o;++i)for(var a=r[i],s=0;s<n;++s)t[e++]=a[s];return e}function rn(t,e,r,n,i){for(var o=i||[],a=0,s=0,u=r.length;s<u;++s){var l=en(t,e,r[s],n);o[a++]=l,e=l}return o.length=a,o}function nn(t,e,r,n,i,o,a){var s=(r-e)/n;if(s<3){for(;e<r;e+=n)o[a++]=t[e],o[a++]=t[e+1];return a}var u=new Array(s);u[0]=1,u[s-1]=1;for(var l=[e,r-n],c=0;l.length>0;){for(var f=l.pop(),h=l.pop(),p=0,y=t[h],v=t[h+1],g=t[f],m=t[f+1],b=h+n;b<f;b+=n){var _=d(t[b],t[b+1],y,v,g,m);_>p&&(c=b,p=_)}p>i&&(u[(c-e)/n]=1,h+n<c&&l.push(h,c),c+n<f&&l.push(c,f))}for(var x=0;x<s;++x)u[x]&&(o[a++]=t[e+x*n],o[a++]=t[e+x*n+1]);return a}function on(t,e,r,n,i,o,a,s){for(var u=0,l=r.length;u<l;++u){var c=r[u];a=nn(t,e,c,n,i,o,a),s.push(a),e=c}return a}function an(t,e){return e*Math.round(t/e)}function sn(t,e,r,n,i,o,a){if(e==r)return a;var s,u,l=an(t[e],i),c=an(t[e+1],i);e+=n,o[a++]=l,o[a++]=c;do{if(s=an(t[e],i),u=an(t[e+1],i),(e+=n)==r)return o[a++]=s,o[a++]=u,a}while(s==l&&u==c);for(;e<r;){var f=an(t[e],i),h=an(t[e+1],i);if(e+=n,f!=s||h!=u){var p=s-l,y=u-c,d=f-l,v=h-c;p*v==y*d&&(p<0&&d<p||p==d||p>0&&d>p)&&(y<0&&v<y||y==v||y>0&&v>y)?(s=f,u=h):(o[a++]=s,o[a++]=u,l=s,c=u,s=f,u=h)}}return o[a++]=s,o[a++]=u,a}function un(t,e,r,n,i,o,a,s){for(var u=0,l=r.length;u<l;++u){var c=r[u];a=sn(t,e,c,n,i,o,a),s.push(a),e=c}return a}function ln(t,e,r,n,i){var o;for(e+=n;e<r;e+=n)if(o=i(t.slice(e-n,e),t.slice(e,e+n)))return o;return!1}function cn(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=e;s<r;s+=n)o[a++]=t.slice(s,s+n);return o.length=a,o}function fn(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,u=r.length;s<u;++s){var l=r[s];o[a++]=cn(t,e,l,n,o[a]),e=l}return o.length=a,o}function hn(t,e,r,n,i){for(var o=void 0!==i?i:[],a=0,s=0,u=r.length;s<u;++s){var l=r[s];o[a++]=fn(t,e,l,n,o[a]),e=l[l.length-1]}return o.length=a,o}function pn(t,e,r,n,i,o,a){var s,u,l=(r-e)/n;if(1===l)s=e;else if(2===l)s=e,u=i;else if(0!==l){for(var c=t[e],f=t[e+1],h=0,p=[0],y=e+n;y<r;y+=n){var d=t[y],v=t[y+1];h+=Math.sqrt((d-c)*(d-c)+(v-f)*(v-f)),p.push(h),c=d,f=v}var g=i*h,m=function(t,e,r){for(var n,i,o=r||De,a=0,s=t.length,u=!1;a<s;)(i=+o(t[n=a+(s-a>>1)],e))<0?a=n+1:(s=n,u=!i);return u?a:~a}(p,g);m<0?(u=(g-p[-m-2])/(p[-m-1]-p[-m-2]),s=e+(-m-2)*n):s=e+m*n}for(var _=a>1?a:2,x=o||new Array(_),w=0;w<_;++w)x[w]=void 0===s?NaN:void 0===u?t[s+w]:b(t[s+w],t[s+n+w],u);return x}function yn(t,e,r,n,i,o){if(r==e)return null;var a;if(i<t[e+n-1])return o?((a=t.slice(e,e+n))[n-1]=i,a):null;if(t[r-1]<i)return o?((a=t.slice(r-n,r))[n-1]=i,a):null;if(i==t[e+n-1])return t.slice(e,e+n);for(var s=e/n,u=r/n;s<u;){var l=s+u>>1;i<t[(l+1)*n-1]?u=l:s=l+1}var c=t[s*n-1];if(i==c)return t.slice((s-1)*n,(s-1)*n+n);var f=(i-c)/(t[(s+1)*n-1]-c);a=[];for(var h=0;h<n-1;++h)a.push(b(t[(s-1)*n+h],t[s*n+h],f));return a.push(i),a}function dn(t,e,r,n,i){return!It(i,(function(i){return!vn(t,e,r,n,i[0],i[1])}))}function vn(t,e,r,n,i,o){for(var a=0,s=t[r-n],u=t[r-n+1];e<r;e+=n){var l=t[e],c=t[e+1];u<=o?c>o&&(l-s)*(o-u)-(i-s)*(c-u)>0&&a++:c<=o&&(l-s)*(o-u)-(i-s)*(c-u)<0&&a--,s=l,u=c}return 0!==a}function gn(t,e,r,n,i,o){if(0===r.length)return!1;if(!vn(t,e,r[0],n,i,o))return!1;for(var a=1,s=r.length;a<s;++a)if(vn(t,r[a-1],r[a],n,i,o))return!1;return!0}function mn(t,e,r,n,i){var o=Mt([1/0,1/0,-1/0,-1/0],t,e,r,n);return!!Nt(i,o)&&(!!xt(i,o)||(o[0]>=i[0]&&o[2]<=i[2]||(o[1]>=i[1]&&o[3]<=i[3]||ln(t,e,r,n,(function(t,e){return function(t,e,r){var n=!1,i=kt(t,e),o=kt(t,r);if(i===rt||o===rt)n=!0;else{var a,s,u=t[0],l=t[1],c=t[2],f=t[3],h=e[0],p=e[1],y=r[0],d=r[1],v=(d-p)/(y-h);o&nt&&!(i&nt)&&(n=(a=y-(d-f)/v)>=u&&a<=c),n||!(o&it)||i&it||(n=(s=d-(y-c)*v)>=l&&s<=f),n||!(o&ot)||i&ot||(n=(a=y-(d-l)/v)>=u&&a<=c),n||!(o&at)||i&at||(n=(s=d-(y-u)*v)>=l&&s<=f)}return n}(i,t,e)})))))}function bn(t,e,r,n,i){if(!function(t,e,r,n,i){return!!(mn(t,e,r,n,i)||vn(t,e,r,n,i[0],i[1])||vn(t,e,r,n,i[0],i[3])||vn(t,e,r,n,i[2],i[1])||vn(t,e,r,n,i[2],i[3]))}(t,e,r[0],n,i))return!1;if(1===r.length)return!0;for(var o=1,a=r.length;o<a;++o)if(dn(t,r[o-1],r[o],n,i)&&!mn(t,r[o-1],r[o],n,i))return!1;return!0}function _n(t,e,r,n){for(var i=t[e],o=t[e+1],a=0,s=e+n;s<r;s+=n){var u=t[s],l=t[s+1];a+=Math.sqrt((u-i)*(u-i)+(l-o)*(l-o)),i=u,o=l}return a}function xn(t){return(xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kn(t,e){return(kn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Sn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Tn(t);if(e){var i=Tn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return On(this,r)}}function On(t,e){if(e&&("object"===xn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Tn(t){return(Tn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Cn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kn(t,e)}(o,t);var e,r,n,i=Sn(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).flatMidpoint_=null,r.flatMidpointRevision_=-1,r.maxDelta_=-1,r.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?r.setCoordinates(t,e):r.setFlatCoordinates(e,t),r}return e=o,(r=[{key:"appendCoordinate",value:function(t){this.flatCoordinates?Ae(this.flatCoordinates,t):this.flatCoordinates=t.slice(),this.changed()}},{key:"clone",value:function(){var t=new o(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,e,r,n){return n<bt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Jr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!1,t,e,r,n))}},{key:"forEachSegment",value:function(t){return ln(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}},{key:"getCoordinateAtM",value:function(t,e){if(this.layout!=_e&&this.layout!=xe)return null;var r=void 0!==e&&e;return yn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,r)}},{key:"getCoordinates",value:function(){return cn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getCoordinateAt",value:function(t,e){return pn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,this.stride)}},{key:"getLength",value:function(){return _n(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getFlatMidpoint",value:function(){return this.flatMidpointRevision_!=this.getRevision()&&(this.flatMidpoint_=this.getCoordinateAt(.5,this.flatMidpoint_),this.flatMidpointRevision_=this.getRevision()),this.flatMidpoint_}},{key:"getSimplifiedGeometryInternal",value:function(t){var e=[];return e.length=nn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new o(e,me)}},{key:"getType",value:function(){return ke}},{key:"intersectsExtent",value:function(t){return mn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t)}},{key:"setCoordinates",value:function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=en(this.flatCoordinates,0,t,this.stride),this.changed()}}])&&wn(e.prototype,r),n&&wn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Kr);function Pn(t){return(Pn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Rn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function jn(t,e){return(jn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function En(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Fn(t);if(e){var i=Fn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Mn(this,r)}}function Mn(t,e){if(e&&("object"===Pn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Fn(t){return(Fn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var In=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&jn(t,e)}(o,t);var e,r,n,i=En(o);function o(t,e,r){var n;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).ends_=[],n.maxDelta_=-1,n.maxDeltaRevision_=-1,Array.isArray(t[0]))n.setCoordinates(t,e);else if(void 0!==e&&r)n.setFlatCoordinates(e,t),n.ends_=r;else{for(var a=n.getLayout(),s=t,u=[],l=[],c=0,f=s.length;c<f;++c){var h=s[c];0===c&&(a=h.getLayout()),Ae(u,h.getFlatCoordinates()),l.push(u.length)}n.setFlatCoordinates(a,u),n.ends_=l}return n}return e=o,(r=[{key:"appendLineString",value:function(t){this.flatCoordinates?Ae(this.flatCoordinates,t.getFlatCoordinates().slice()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}},{key:"clone",value:function(){var t=new o(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,e,r,n){return n<bt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($r(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),tn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!1,t,e,r,n))}},{key:"getCoordinateAtM",value:function(t,e,r){if(this.layout!=_e&&this.layout!=xe||0===this.flatCoordinates.length)return null;var n=void 0!==e&&e,i=void 0!==r&&r;return function(t,e,r,n,i,o,a){if(a)return yn(t,e,r[r.length-1],n,i,o);var s;if(i<t[n-1])return o?((s=t.slice(0,n))[n-1]=i,s):null;if(t[t.length-1]<i)return o?((s=t.slice(t.length-n))[n-1]=i,s):null;for(var u=0,l=r.length;u<l;++u){var c=r[u];if(e!=c){if(i<t[e+n-1])return null;if(i<=t[c-1])return yn(t,e,c,n,i,!1);e=c}}return null}(this.flatCoordinates,0,this.ends_,this.stride,t,n,i)}},{key:"getCoordinates",value:function(){return fn(this.flatCoordinates,0,this.ends_,this.stride)}},{key:"getEnds",value:function(){return this.ends_}},{key:"getLineString",value:function(t){return t<0||this.ends_.length<=t?null:new Cn(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}},{key:"getLineStrings",value:function(){for(var t=this.flatCoordinates,e=this.ends_,r=this.layout,n=[],i=0,o=0,a=e.length;o<a;++o){var s=e[o],u=new Cn(t.slice(i,s),r);n.push(u),i=s}return n}},{key:"getFlatMidpoints",value:function(){for(var t=[],e=this.flatCoordinates,r=0,n=this.ends_,i=this.stride,o=0,a=n.length;o<a;++o){var s=n[o];Ae(t,pn(e,r,s,i,.5)),r=s}return t}},{key:"getSimplifiedGeometryInternal",value:function(t){var e=[],r=[];return e.length=on(this.flatCoordinates,0,this.ends_,this.stride,t,e,0,r),new o(e,me,r)}},{key:"getType",value:function(){return Ce}},{key:"intersectsExtent",value:function(t){return function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){if(mn(t,e,r[o],n,i))return!0;e=r[o]}return!1}(this.flatCoordinates,0,this.ends_,this.stride,t)}},{key:"setCoordinates",value:function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=rn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()}}])&&Rn(e.prototype,r),n&&Rn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Kr);function Dn(t){return(Dn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function An(t,e){return(An=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ln(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Bn(t);if(e){var i=Bn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Gn(this,r)}}function Gn(t,e){if(e&&("object"===Dn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Bn(t){return(Bn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Wn=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&An(t,e)}(o,t);var e,r,n,i=Ln(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).setCoordinates(t,e),r}return e=o,(r=[{key:"clone",value:function(){var t=new o(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,e,r,n){var i=this.flatCoordinates,o=v(t,e,i[0],i[1]);if(o<n){for(var a=this.stride,s=0;s<a;++s)r[s]=i[s];return r.length=a,o}return n}},{key:"getCoordinates",value:function(){return this.flatCoordinates?this.flatCoordinates.slice():[]}},{key:"computeExtent",value:function(t){return Ct(this.flatCoordinates,t)}},{key:"getType",value:function(){return we}},{key:"intersectsExtent",value:function(t){return wt(t,this.flatCoordinates[0],this.flatCoordinates[1])}},{key:"setCoordinates",value:function(t,e){this.setLayout(e,t,0),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=function(t,e,r,n){for(var i=0,o=r.length;i<o;++i)t[e++]=r[i];return e}(this.flatCoordinates,0,t,this.stride),this.changed()}}])&&zn(e.prototype,r),n&&zn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Kr);function Xn(t){return(Xn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yn(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qn(t,e){return(qn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Nn(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Zn(t);if(e){var i=Zn(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Vn(this,r)}}function Vn(t,e){if(e&&("object"===Xn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Zn(t){return(Zn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Un=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qn(t,e)}(o,t);var e,r,n,i=Nn(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),r=i.call(this),e&&!Array.isArray(t[0])?r.setFlatCoordinates(e,t):r.setCoordinates(t,e),r}return e=o,(r=[{key:"appendPoint",value:function(t){this.flatCoordinates?Ae(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.changed()}},{key:"clone",value:function(){var t=new o(this.flatCoordinates.slice(),this.layout);return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,e,r,n){if(n<bt(this.getExtent(),t,e))return n;for(var i=this.flatCoordinates,o=this.stride,a=0,s=i.length;a<s;a+=o){var u=v(t,e,i[a],i[a+1]);if(u<n){n=u;for(var l=0;l<o;++l)r[l]=i[a+l];r.length=o}}return n}},{key:"getCoordinates",value:function(){return cn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getPoint",value:function(t){var e=this.flatCoordinates?this.flatCoordinates.length/this.stride:0;return t<0||e<=t?null:new Wn(this.flatCoordinates.slice(t*this.stride,(t+1)*this.stride),this.layout)}},{key:"getPoints",value:function(){for(var t=this.flatCoordinates,e=this.layout,r=this.stride,n=[],i=0,o=t.length;i<o;i+=r){var a=new Wn(t.slice(i,i+r),e);n.push(a)}return n}},{key:"getType",value:function(){return Te}},{key:"intersectsExtent",value:function(t){for(var e=this.flatCoordinates,r=this.stride,n=0,i=e.length;n<i;n+=r)if(wt(t,e[n],e[n+1]))return!0;return!1}},{key:"setCoordinates",value:function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=en(this.flatCoordinates,0,t,this.stride),this.changed()}}])&&Yn(e.prototype,r),n&&Yn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Kr);function Kn(t,e,r,n){for(var i=0,o=t[r-n],a=t[r-n+1];e<r;e+=n){var s=t[e],u=t[e+1];i+=a*s-o*u,o=s,a=u}return i/2}function Hn(t,e,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=Kn(t,e,s,n),e=s}return i}function Jn(t){return(Jn="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $n(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qn(t,e){return(Qn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function ti(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ri(t);if(e){var i=ri(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ei(this,r)}}function ei(t,e){if(e&&("object"===Jn(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ri(t){return(ri=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ni=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qn(t,e)}(o,t);var e,r,n,i=ti(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this)).maxDelta_=-1,r.maxDeltaRevision_=-1,void 0===e||Array.isArray(t[0])?r.setCoordinates(t,e):r.setFlatCoordinates(e,t),r}return e=o,(r=[{key:"clone",value:function(){return new o(this.flatCoordinates.slice(),this.layout)}},{key:"closestPointXY",value:function(t,e,r,n){return n<bt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(Jr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),Qr(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,this.maxDelta_,!0,t,e,r,n))}},{key:"getArea",value:function(){return Kn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getCoordinates",value:function(){return cn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride)}},{key:"getSimplifiedGeometryInternal",value:function(t){var e=[];return e.length=nn(this.flatCoordinates,0,this.flatCoordinates.length,this.stride,t,e,0),new o(e,me)}},{key:"getType",value:function(){return Se}},{key:"intersectsExtent",value:function(t){return!1}},{key:"setCoordinates",value:function(t,e){this.setLayout(e,t,1),this.flatCoordinates||(this.flatCoordinates=[]),this.flatCoordinates.length=en(this.flatCoordinates,0,t,this.stride),this.changed()}}])&&$n(e.prototype,r),n&&$n(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Kr);function ii(t,e,r,n,i,o,a){for(var s,u,l,c,f,h,p,y=i[o+1],d=[],v=0,g=r.length;v<g;++v){var m=r[v];for(c=t[m-n],h=t[m-n+1],s=e;s<m;s+=n)f=t[s],p=t[s+1],(y<=h&&p<=y||h<=y&&y<=p)&&(l=(y-h)/(p-h)*(f-c)+c,d.push(l)),c=f,h=p}var b=NaN,_=-1/0;for(d.sort(De),c=d[0],s=1,u=d.length;s<u;++s){f=d[s];var x=Math.abs(f-c);x>_&&gn(t,e,r,n,l=(c+f)/2,y)&&(b=l,_=x),c=f}return isNaN(b)&&(b=i[o]),a?(a.push(b,y,_),a):[b,y,_]}function oi(t,e,r,n,i){for(var o=[],a=0,s=r.length;a<s;++a){var u=r[a];o=ii(t,e,u,n,i,2*a,o),e=u[u.length-1]}return o}function ai(t,e,r,n){for(;e<r-n;){for(var i=0;i<n;++i){var o=t[e+i];t[e+i]=t[r-n+i],t[r-n+i]=o}e+=n,r-=n}}function si(t,e,r,n){for(var i=0,o=t[r-n],a=t[r-n+1];e<r;e+=n){var s=t[e],u=t[e+1];i+=(s-o)*(u+a),o=s,a=u}return 0===i?void 0:i>0}function ui(t,e,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var u=r[a],l=si(t,e,u,n);if(0===a){if(o&&l||!o&&!l)return!1}else if(o&&!l||!o&&l)return!1;e=u}return!0}function li(t,e,r,n,i){for(var o=void 0!==i&&i,a=0,s=r.length;a<s;++a){var u=r[a],l=si(t,e,u,n);(0===a?o&&l||!o&&!l:o&&!l||!o&&l)&&ai(t,e,u,n),e=u}return e}function ci(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o)e=li(t,e,r[o],n,i);return e}function fi(t){return(fi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function hi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function pi(t,e){return(pi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function yi(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=vi(t);if(e){var i=vi(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return di(this,r)}}function di(t,e){if(e&&("object"===fi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function vi(t){return(vi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var gi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&pi(t,e)}(o,t);var e,r,n,i=yi(o);function o(t,e,r){var n;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).ends_=[],n.flatInteriorPointRevision_=-1,n.flatInteriorPoint_=null,n.maxDelta_=-1,n.maxDeltaRevision_=-1,n.orientedRevision_=-1,n.orientedFlatCoordinates_=null,void 0!==e&&r?(n.setFlatCoordinates(e,t),n.ends_=r):n.setCoordinates(t,e),n}return e=o,(r=[{key:"appendLinearRing",value:function(t){this.flatCoordinates?Ae(this.flatCoordinates,t.getFlatCoordinates()):this.flatCoordinates=t.getFlatCoordinates().slice(),this.ends_.push(this.flatCoordinates.length),this.changed()}},{key:"clone",value:function(){var t=new o(this.flatCoordinates.slice(),this.layout,this.ends_.slice());return t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,e,r,n){return n<bt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt($r(this.flatCoordinates,0,this.ends_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),tn(this.flatCoordinates,0,this.ends_,this.stride,this.maxDelta_,!0,t,e,r,n))}},{key:"containsXY",value:function(t,e){return gn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,e)}},{key:"getArea",value:function(){return Hn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride)}},{key:"getCoordinates",value:function(t){var e;return void 0!==t?li(e=this.getOrientedFlatCoordinates().slice(),0,this.ends_,this.stride,t):e=this.flatCoordinates,fn(e,0,this.ends_,this.stride)}},{key:"getEnds",value:function(){return this.ends_}},{key:"getFlatInteriorPoint",value:function(){if(this.flatInteriorPointRevision_!=this.getRevision()){var t=Lt(this.getExtent());this.flatInteriorPoint_=ii(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t,0),this.flatInteriorPointRevision_=this.getRevision()}return this.flatInteriorPoint_}},{key:"getInteriorPoint",value:function(){return new Wn(this.getFlatInteriorPoint(),_e)}},{key:"getLinearRingCount",value:function(){return this.ends_.length}},{key:"getLinearRing",value:function(t){return t<0||this.ends_.length<=t?null:new ni(this.flatCoordinates.slice(0===t?0:this.ends_[t-1],this.ends_[t]),this.layout)}},{key:"getLinearRings",value:function(){for(var t=this.layout,e=this.flatCoordinates,r=this.ends_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o],u=new ni(e.slice(i,s),t);n.push(u),i=s}return n}},{key:"getOrientedFlatCoordinates",value:function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;ui(t,0,this.ends_,this.stride)?this.orientedFlatCoordinates_=t:(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=li(this.orientedFlatCoordinates_,0,this.ends_,this.stride)),this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}},{key:"getSimplifiedGeometryInternal",value:function(t){var e=[],r=[];return e.length=un(this.flatCoordinates,0,this.ends_,this.stride,Math.sqrt(t),e,0,r),new o(e,me,r)}},{key:"getType",value:function(){return Oe}},{key:"intersectsExtent",value:function(t){return bn(this.getOrientedFlatCoordinates(),0,this.ends_,this.stride,t)}},{key:"setCoordinates",value:function(t,e){this.setLayout(e,t,2),this.flatCoordinates||(this.flatCoordinates=[]);var r=rn(this.flatCoordinates,0,t,this.stride,this.ends_);this.flatCoordinates.length=0===r.length?0:r[r.length-1],this.changed()}}])&&hi(e.prototype,r),n&&hi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Kr),mi=gi;function bi(t,e,r,n){for(var i=[],o=[1/0,1/0,-1/0,-1/0],a=0,s=r.length;a<s;++a){var u=r[a];o=Pt(t,e,u[0],n),i.push((o[0]+o[2])/2,(o[1]+o[3])/2),e=u[u.length-1]}return i}function _i(t){return(_i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function xi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function wi(t,e){return(wi=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function ki(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Oi(t);if(e){var i=Oi(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Si(this,r)}}function Si(t,e){if(e&&("object"===_i(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Oi(t){return(Oi=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ti=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&wi(t,e)}(o,t);var e,r,n,i=ki(o);function o(t,e,r){var n;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(n=i.call(this)).endss_=[],n.flatInteriorPointsRevision_=-1,n.flatInteriorPoints_=null,n.maxDelta_=-1,n.maxDeltaRevision_=-1,n.orientedRevision_=-1,n.orientedFlatCoordinates_=null,!r&&!Array.isArray(t[0])){for(var a=n.getLayout(),s=t,u=[],l=[],c=0,f=s.length;c<f;++c){var h=s[c];0===c&&(a=h.getLayout());for(var p=u.length,y=h.getEnds(),d=0,v=y.length;d<v;++d)y[d]+=p;Ae(u,h.getFlatCoordinates()),l.push(y)}e=a,t=u,r=l}return void 0!==e&&r?(n.setFlatCoordinates(e,t),n.endss_=r):n.setCoordinates(t,e),n}return e=o,(r=[{key:"appendPolygon",value:function(t){var e;if(this.flatCoordinates){var r=this.flatCoordinates.length;Ae(this.flatCoordinates,t.getFlatCoordinates());for(var n=0,i=(e=t.getEnds().slice()).length;n<i;++n)e[n]+=r}else this.flatCoordinates=t.getFlatCoordinates().slice(),e=t.getEnds().slice(),this.endss_.push();this.endss_.push(e),this.changed()}},{key:"clone",value:function(){for(var t=this.endss_.length,e=new Array(t),r=0;r<t;++r)e[r]=this.endss_[r].slice();var n=new o(this.flatCoordinates.slice(),this.layout,e);return n.applyProperties(this),n}},{key:"closestPointXY",value:function(t,e,r,n){return n<bt(this.getExtent(),t,e)?n:(this.maxDeltaRevision_!=this.getRevision()&&(this.maxDelta_=Math.sqrt(function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];i=$r(t,e,s,n,i),e=s[s.length-1]}return i}(this.flatCoordinates,0,this.endss_,this.stride,0)),this.maxDeltaRevision_=this.getRevision()),function(t,e,r,n,i,o,a,s,u,l,c){for(var f=c||[NaN,NaN],h=0,p=r.length;h<p;++h){var y=r[h];l=tn(t,e,y,n,i,o,a,s,u,l,f),e=y[y.length-1]}return l}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,this.maxDelta_,!0,t,e,r,n))}},{key:"containsXY",value:function(t,e){return function(t,e,r,n,i,o){if(0===r.length)return!1;for(var a=0,s=r.length;a<s;++a){var u=r[a];if(gn(t,e,u,n,i,o))return!0;e=u[u.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t,e)}},{key:"getArea",value:function(){return function(t,e,r,n){for(var i=0,o=0,a=r.length;o<a;++o){var s=r[o];i+=Hn(t,e,s,n),e=s[s.length-1]}return i}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride)}},{key:"getCoordinates",value:function(t){var e;return void 0!==t?ci(e=this.getOrientedFlatCoordinates().slice(),0,this.endss_,this.stride,t):e=this.flatCoordinates,hn(e,0,this.endss_,this.stride)}},{key:"getEndss",value:function(){return this.endss_}},{key:"getFlatInteriorPoints",value:function(){if(this.flatInteriorPointsRevision_!=this.getRevision()){var t=bi(this.flatCoordinates,0,this.endss_,this.stride);this.flatInteriorPoints_=oi(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t),this.flatInteriorPointsRevision_=this.getRevision()}return this.flatInteriorPoints_}},{key:"getInteriorPoints",value:function(){return new Un(this.getFlatInteriorPoints().slice(),_e)}},{key:"getOrientedFlatCoordinates",value:function(){if(this.orientedRevision_!=this.getRevision()){var t=this.flatCoordinates;!function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];if(!ui(t,e,s,n,i))return!1;s.length&&(e=s[s.length-1])}return!0}(t,0,this.endss_,this.stride)?(this.orientedFlatCoordinates_=t.slice(),this.orientedFlatCoordinates_.length=ci(this.orientedFlatCoordinates_,0,this.endss_,this.stride)):this.orientedFlatCoordinates_=t,this.orientedRevision_=this.getRevision()}return this.orientedFlatCoordinates_}},{key:"getSimplifiedGeometryInternal",value:function(t){var e=[],r=[];return e.length=function(t,e,r,n,i,o,a,s){for(var u=0,l=r.length;u<l;++u){var c=r[u],f=[];a=un(t,e,c,n,i,o,a,f),s.push(f),e=c[c.length-1]}return a}(this.flatCoordinates,0,this.endss_,this.stride,Math.sqrt(t),e,0,r),new o(e,me,r)}},{key:"getPolygon",value:function(t){if(t<0||this.endss_.length<=t)return null;var e;if(0===t)e=0;else{var r=this.endss_[t-1];e=r[r.length-1]}var n=this.endss_[t].slice(),i=n[n.length-1];if(0!==e)for(var o=0,a=n.length;o<a;++o)n[o]-=e;return new mi(this.flatCoordinates.slice(e,i),this.layout,n)}},{key:"getPolygons",value:function(){for(var t=this.layout,e=this.flatCoordinates,r=this.endss_,n=[],i=0,o=0,a=r.length;o<a;++o){var s=r[o].slice(),u=s[s.length-1];if(0!==i)for(var l=0,c=s.length;l<c;++l)s[l]-=i;var f=new mi(e.slice(i,u),t,s);n.push(f),i=u}return n}},{key:"getType",value:function(){return Pe}},{key:"intersectsExtent",value:function(t){return function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o];if(bn(t,e,s,n,i))return!0;e=s[s.length-1]}return!1}(this.getOrientedFlatCoordinates(),0,this.endss_,this.stride,t)}},{key:"setCoordinates",value:function(t,e){this.setLayout(e,t,3),this.flatCoordinates||(this.flatCoordinates=[]);var r=function(t,e,r,n,i){for(var o=i||[],a=0,s=0,u=r.length;s<u;++s){var l=rn(t,e,r[s],n,o[a]);o[a++]=l,e=l[l.length-1]}return o.length=a,o}(this.flatCoordinates,0,t,this.stride,this.endss_);if(0===r.length)this.flatCoordinates.length=0;else{var n=r[r.length-1];this.flatCoordinates.length=0===n.length?0:n[n.length-1]}this.changed()}}])&&xi(e.prototype,r),n&&xi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Kr),Ci=r(443);function Pi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ri=[1,0,0,1,0,0],ji=function(){function t(e,r,n,i,o){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.styleFunction,this.extent_,this.id_=o,this.type_=e,this.flatCoordinates_=r,this.flatInteriorPoints_=null,this.flatMidpoints_=null,this.ends_=n,this.properties_=i}var e,r,n;return e=t,(r=[{key:"get",value:function(t){return this.properties_[t]}},{key:"getExtent",value:function(){return this.extent_||(this.extent_=this.type_===we?Ct(this.flatCoordinates_):Pt(this.flatCoordinates_,0,this.flatCoordinates_.length,2)),this.extent_}},{key:"getFlatInteriorPoint",value:function(){if(!this.flatInteriorPoints_){var t=Lt(this.getExtent());this.flatInteriorPoints_=ii(this.flatCoordinates_,0,this.ends_,2,t,0)}return this.flatInteriorPoints_}},{key:"getFlatInteriorPoints",value:function(){if(!this.flatInteriorPoints_){var t=bi(this.flatCoordinates_,0,this.ends_,2);this.flatInteriorPoints_=oi(this.flatCoordinates_,0,this.ends_,2,t)}return this.flatInteriorPoints_}},{key:"getFlatMidpoint",value:function(){return this.flatMidpoints_||(this.flatMidpoints_=pn(this.flatCoordinates_,0,this.flatCoordinates_.length,2,.5)),this.flatMidpoints_}},{key:"getFlatMidpoints",value:function(){if(!this.flatMidpoints_){this.flatMidpoints_=[];for(var t=this.flatCoordinates_,e=0,r=this.ends_,n=0,i=r.length;n<i;++n){var o=r[n],a=pn(t,e,o,2,.5);Ae(this.flatMidpoints_,a),e=o}}return this.flatMidpoints_}},{key:"getId",value:function(){return this.id_}},{key:"getOrientedFlatCoordinates",value:function(){return this.flatCoordinates_}},{key:"getGeometry",value:function(){return this}},{key:"getSimplifiedGeometry",value:function(t){return this}},{key:"simplifyTransformed",value:function(t,e){return this}},{key:"getProperties",value:function(){return this.properties_}},{key:"getStride",value:function(){return 2}},{key:"getStyleFunction",value:function(){return this.styleFunction}},{key:"getType",value:function(){return this.type_}},{key:"transform",value:function(t){var e=(t=$t(t)).getExtent(),r=t.getWorldExtent();if(e&&r){var n=Bt(r)/Bt(e);Rr(Ri,r[0],r[3],n,-n,0,0,0),Mr(this.flatCoordinates_,0,this.flatCoordinates_.length,2,Ri,this.flatCoordinates_)}}},{key:"getEnds",value:function(){return this.ends_}}])&&Pi(e.prototype,r),n&&Pi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();ji.prototype.getEndss=ji.prototype.getEnds,ji.prototype.getFlatCoordinates=ji.prototype.getOrientedFlatCoordinates;var Ei=ji;function Mi(t){return(Mi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ii(t,e){return(Ii=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Di(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ai(t);if(e){var i=Ai(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zi(this,r)}}function zi(t,e){if(e&&("object"===Mi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ai(t){return(Ai=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Li(t,e,r){if(3===t){var n={keys:[],values:[],features:[]},i=r.readVarint()+r.pos;r.readFields(Gi,n,i),n.length=n.features.length,n.length&&(e[n.name]=n)}}function Gi(t,e,r){if(15===t)e.version=r.readVarint();else if(1===t)e.name=r.readString();else if(5===t)e.extent=r.readVarint();else if(2===t)e.features.push(r.pos);else if(3===t)e.keys.push(r.readString());else if(4===t){for(var n=null,i=r.readVarint()+r.pos;r.pos<i;)n=1===(t=r.readVarint()>>3)?r.readString():2===t?r.readFloat():3===t?r.readDouble():4===t?r.readVarint64():5===t?r.readVarint():6===t?r.readSVarint():7===t?r.readBoolean():null;e.values.push(n)}}function Bi(t,e,r){if(1==t)e.id=r.readVarint();else if(2==t)for(var n=r.readVarint()+r.pos;r.pos<n;){var i=e.layer.keys[r.readVarint()],o=e.layer.values[r.readVarint()];e.properties[i]=o}else 3==t?e.type=r.readVarint():4==t&&(e.geometry=r.pos)}function Wi(t,e,r){t.pos=e.features[r];var n=t.readVarint()+t.pos,i={layer:e,type:0,properties:{}};return t.readFields(Bi,i,n),i}var Xi=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ii(t,e)}(a,t);var e,r,i,o=Di(a);function a(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);var r=t||{};return(e=o.call(this)).dataProjection=new f({code:"",units:n.TILE_PIXELS}),e.featureClass_=r.featureClass?r.featureClass:Ei,e.geometryName_=r.geometryName,e.layerName_=r.layerName?r.layerName:"layer",e.layers_=r.layers?r.layers:null,e.idProperty_=r.idProperty,e.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"],e}return e=a,(r=[{key:"readRawGeometry_",value:function(t,e,r,n){t.pos=e.geometry;for(var i=t.readVarint()+t.pos,o=1,a=0,s=0,u=0,l=0,c=0;t.pos<i;){if(!a){var f=t.readVarint();o=7&f,a=f>>3}a--,1===o||2===o?(s+=t.readSVarint(),u+=t.readSVarint(),1===o&&l>c&&(n.push(l),c=l),r.push(s,u),l+=2):7===o?l>c&&(r.push(r[c],r[c+1]),l+=2):vt(!1,59)}l>c&&(n.push(l),c=l)}},{key:"createFeature_",value:function(t,e,r){var n,i=e.type;if(0===i)return null;var o,a=e.properties;this.idProperty_?(o=a[this.idProperty_],delete a[this.idProperty_]):o=e.id,a[this.layerName_]=e.layer.name;var s=[],u=[];this.readRawGeometry_(t,e,s,u);var l=function(t,e){var r;return 1===t?r=1===e?we:Te:2===t?r=1===e?ke:Ce:3===t&&(r=Oe),r}(i,u.length);if(this.featureClass_===Ei)(n=new this.featureClass_(l,s,u,a,o)).transform(r.dataProjection);else{var c;if(l==Oe){var f=function(t,e){for(var r=[],n=0,i=0,o=0,a=e.length;o<a;++o){var s=e[o];if(si(t,n,s,2)){if(0===r.length)continue;r[r.length-1].push(e[i])}else r.push(e.slice(i,o+1));i=o+1,n=s}return r}(s,u);c=f.length>1?new Ti(s,me,f):new mi(s,me,u)}else c=l===we?new Wn(s,me):l===ke?new Cn(s,me):l===Oe?new mi(s,me,u):l===Te?new Un(s,me):l===Ce?new In(s,me,u):null;n=new(0,this.featureClass_),this.geometryName_&&n.setGeometryName(this.geometryName_);var h=pe(c,!1,r);n.setGeometry(h),void 0!==o&&n.setId(o),n.setProperties(a,!0)}return n}},{key:"getType",value:function(){return ye}},{key:"readFeatures",value:function(t,e){var r=this.layers_,n=this.adaptOptions(e),i=$t(n.dataProjection);i.setWorldExtent(n.extent),n.dataProjection=i;var o=new Ci(t),a=o.readFields(Li,{}),s=[];for(var u in a)if(!r||-1!=r.indexOf(u)){var l=a[u],c=l?[0,0,l.extent,l.extent]:null;i.setExtent(c);for(var f=0,h=l.length;f<h;++f){var p=Wi(o,l,f),y=this.createFeature_(o,p,n);null!==y&&s.push(y)}}return s}},{key:"readProjection",value:function(t){return this.dataProjection}},{key:"setLayers",value:function(t){this.layers_=t}}])&&Fi(e.prototype,r),i&&Fi(e,i),Object.defineProperty(e,"prototype",{writable:!1}),a}(he);function Yi(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var qi=1/0,Ni=0,Vi=1,Zi=2,Ui=3,Ki=4;function Hi(t){return(Hi="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ji(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function $i(){return($i="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Qi(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Qi(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=io(t)););return t}function to(t,e){return(to=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function eo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=io(t);if(e){var i=io(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ro(this,r)}}function ro(t,e){if(e&&("object"===Hi(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return no(t)}function no(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function io(t){return(io=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var oo=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&to(t,e)}(o,t);var e,r,n,i=eo(o);function o(t,e){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(r=i.call(this,(function(e){return t.apply(null,e)}),(function(t){return t[0].getKey()}))).boundHandleTileChange_=r.handleTileChange.bind(no(r)),r.tileChangeCallback_=e,r.tilesLoading_=0,r.tilesLoadingKeys_={},r}return e=o,(r=[{key:"enqueue",value:function(t){var e=$i(io(o.prototype),"enqueue",this).call(this,t);return e&&t[0].addEventListener(Ze,this.boundHandleTileChange_),e}},{key:"getTilesLoading",value:function(){return this.tilesLoading_}},{key:"handleTileChange",value:function(t){var e=t.target,r=e.getState();if(r===Zi||r===Ui||r===Ki){e.removeEventListener(Ze,this.boundHandleTileChange_);var n=e.getKey();n in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[n],--this.tilesLoading_),this.tileChangeCallback_()}}},{key:"loadMoreTiles",value:function(t,e){for(var r,n,i=0;this.tilesLoading_<t&&i<e&&this.getCount()>0;)n=(r=this.dequeue()[0]).getKey(),r.getState()!==Ni||n in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[n]=!0,++this.tilesLoading_,++i,r.load())}}])&&Ji(e.prototype,r),n&&Ji(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(function(){function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.priorityFunction_=e,this.keyFunction_=r,this.elements_=[],this.priorities_=[],this.queuedElements_={}}var e,r,n;return e=t,(r=[{key:"clear",value:function(){this.elements_.length=0,this.priorities_.length=0,u(this.queuedElements_)}},{key:"dequeue",value:function(){var t=this.elements_,e=this.priorities_,r=t[0];1==t.length?(t.length=0,e.length=0):(t[0]=t.pop(),e[0]=e.pop(),this.siftUp_(0));var n=this.keyFunction_(r);return delete this.queuedElements_[n],r}},{key:"enqueue",value:function(t){vt(!(this.keyFunction_(t)in this.queuedElements_),31);var e=this.priorityFunction_(t);return e!=qi&&(this.elements_.push(t),this.priorities_.push(e),this.queuedElements_[this.keyFunction_(t)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}},{key:"getCount",value:function(){return this.elements_.length}},{key:"getLeftChildIndex_",value:function(t){return 2*t+1}},{key:"getRightChildIndex_",value:function(t){return 2*t+2}},{key:"getParentIndex_",value:function(t){return t-1>>1}},{key:"heapify_",value:function(){var t;for(t=(this.elements_.length>>1)-1;t>=0;t--)this.siftUp_(t)}},{key:"isEmpty",value:function(){return 0===this.elements_.length}},{key:"isKeyQueued",value:function(t){return t in this.queuedElements_}},{key:"isQueued",value:function(t){return this.isKeyQueued(this.keyFunction_(t))}},{key:"siftUp_",value:function(t){for(var e=this.elements_,r=this.priorities_,n=e.length,i=e[t],o=r[t],a=t;t<n>>1;){var s=this.getLeftChildIndex_(t),u=this.getRightChildIndex_(t),l=u<n&&r[u]<r[s]?u:s;e[t]=e[l],r[t]=r[l],t=l}e[t]=i,r[t]=o,this.siftDown_(a,t)}},{key:"siftDown_",value:function(t,e){for(var r=this.elements_,n=this.priorities_,i=r[e],o=n[e];e>t;){var a=this.getParentIndex_(e);if(!(n[a]>o))break;r[e]=r[a],n[e]=n[a],e=a}r[e]=i,n[e]=o}},{key:"reprioritize",value:function(){var t,e,r,n=this.priorityFunction_,i=this.elements_,o=this.priorities_,a=0,s=i.length;for(e=0;e<s;++e)(r=n(t=i[e]))==qi?delete this.queuedElements_[this.keyFunction_(t)]:(o[a]=r,i[a++]=t);i.length=a,o.length=a,this.heapify_()}}])&&Yi(e.prototype,r),n&&Yi(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}());var ao="opacity",so="visible",uo="extent",lo="zIndex",co="maxResolution",fo="minResolution",ho="maxZoom",po="minZoom",yo="source",vo="map";function go(t){return(go="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function mo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function bo(){return(bo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=_o(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function _o(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=So(t)););return t}function xo(t,e){return(xo=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function wo(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=So(t);if(e){var i=So(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ko(this,r)}}function ko(t,e){if(e&&("object"===go(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function So(t){return(So=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Oo="prerender",To="postrender",Co="precompose",Po="undefined",Ro="ready";function jo(t){return(jo="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Eo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Mo(){return(Mo="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Fo(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Fo(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ao(t)););return t}function Io(t,e){return(Io=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Do(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ao(t);if(e){var i=Ao(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return zo(this,r)}}function zo(t,e){if(e&&("object"===jo(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ao(t){return(Ao=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Lo(t,e){if(!t.visible)return!1;var r=e.resolution;if(r<t.minResolution||r>=t.maxResolution)return!1;var n=e.zoom;return n>t.minZoom&&n<=t.maxZoom}var Go=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Io(t,e)}(o,t);var e,r,n,i=Do(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=s({},t);delete r.source,(e=i.call(this,r)).on,e.once,e.un,e.mapPrecomposeKey_=null,e.mapRenderKey_=null,e.sourceChangeKey_=null,e.renderer_=null,e.rendered=!1,t.render&&(e.render=t.render),t.map&&e.setMap(t.map),e.addChangeListener(yo,e.handleSourcePropertyChange_);var n=t.source?t.source:null;return e.setSource(n),e}return e=o,(r=[{key:"getLayersArray",value:function(t){var e=t||[];return e.push(this),e}},{key:"getLayerStatesArray",value:function(t){var e=t||[];return e.push(this.getLayerState()),e}},{key:"getSource",value:function(){return this.get(yo)||null}},{key:"getRenderSource",value:function(){return this.getSource()}},{key:"getSourceState",value:function(){var t=this.getSource();return t?t.getState():Po}},{key:"handleSourceChange_",value:function(){this.changed()}},{key:"handleSourcePropertyChange_",value:function(){this.sourceChangeKey_&&($e(this.sourceChangeKey_),this.sourceChangeKey_=null);var t=this.getSource();t&&(this.sourceChangeKey_=He(t,Ze,this.handleSourceChange_,this)),this.changed()}},{key:"getFeatures",value:function(t){return this.renderer_?this.renderer_.getFeatures(t):new Promise((function(t){return t([])}))}},{key:"getData",value:function(t){return this.renderer_&&this.rendered?this.renderer_.getData(t):null}},{key:"render",value:function(t,e){var r=this.getRenderer();if(r.prepareFrame(t))return this.rendered=!0,r.renderFrame(t,e)}},{key:"unrender",value:function(){this.rendered=!1}},{key:"setMapInternal",value:function(t){t||this.unrender(),this.set(vo,t)}},{key:"getMapInternal",value:function(){return this.get(vo)}},{key:"setMap",value:function(t){this.mapPrecomposeKey_&&($e(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),t||this.changed(),this.mapRenderKey_&&($e(this.mapRenderKey_),this.mapRenderKey_=null),t&&(this.mapPrecomposeKey_=He(t,Co,(function(t){var e=t.frameState.layerStatesArray,r=this.getLayerState(!1);vt(!e.some((function(t){return t.layer===r.layer})),67),e.push(r)}),this),this.mapRenderKey_=He(this,Ze,t.render,t),this.changed())}},{key:"setSource",value:function(t){this.set(yo,t)}},{key:"getRenderer",value:function(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}},{key:"hasRenderer",value:function(){return!!this.renderer_}},{key:"createRenderer",value:function(){return null}},{key:"disposeInternal",value:function(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),Mo(Ao(o.prototype),"disposeInternal",this).call(this)}}])&&Eo(e.prototype,r),n&&Eo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&xo(t,e)}(a,t);var e,r,n,o=wo(a);function a(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).on,e.once,e.un,e.background_=t.background;var r=s({},t);return"object"===go(t.properties)&&(delete r.properties,s(r,t.properties)),r[ao]=void 0!==t.opacity?t.opacity:1,vt("number"==typeof r[ao],64),r[so]=void 0===t.visible||t.visible,r[lo]=t.zIndex,r[co]=void 0!==t.maxResolution?t.maxResolution:1/0,r[fo]=void 0!==t.minResolution?t.minResolution:0,r[po]=void 0!==t.minZoom?t.minZoom:-1/0,r[ho]=void 0!==t.maxZoom?t.maxZoom:1/0,e.className_=void 0!==r.className?r.className:"ol-layer",delete r.className,e.setProperties(r),e.state_=null,e}return e=a,(r=[{key:"getBackground",value:function(){return this.background_}},{key:"getClassName",value:function(){return this.className_}},{key:"getLayerState",value:function(t){var e=this.state_||{layer:this,managed:void 0===t||t},r=this.getZIndex();return e.opacity=h(Math.round(100*this.getOpacity())/100,0,1),e.visible=this.getVisible(),e.extent=this.getExtent(),e.zIndex=void 0!==r||e.managed?r:1/0,e.maxResolution=this.getMaxResolution(),e.minResolution=Math.max(this.getMinResolution(),0),e.minZoom=this.getMinZoom(),e.maxZoom=this.getMaxZoom(),this.state_=e,e}},{key:"getLayersArray",value:function(t){return i()}},{key:"getLayerStatesArray",value:function(t){return i()}},{key:"getExtent",value:function(){return this.get(uo)}},{key:"getMaxResolution",value:function(){return this.get(co)}},{key:"getMinResolution",value:function(){return this.get(fo)}},{key:"getMinZoom",value:function(){return this.get(po)}},{key:"getMaxZoom",value:function(){return this.get(ho)}},{key:"getOpacity",value:function(){return this.get(ao)}},{key:"getSourceState",value:function(){return i()}},{key:"getVisible",value:function(){return this.get(so)}},{key:"getZIndex",value:function(){return this.get(lo)}},{key:"setBackground",value:function(t){this.background_=t,this.changed()}},{key:"setExtent",value:function(t){this.set(uo,t)}},{key:"setMaxResolution",value:function(t){this.set(co,t)}},{key:"setMinResolution",value:function(t){this.set(fo,t)}},{key:"setMaxZoom",value:function(t){this.set(ho,t)}},{key:"setMinZoom",value:function(t){this.set(po,t)}},{key:"setOpacity",value:function(t){vt("number"==typeof t,64),this.set(ao,t)}},{key:"setVisible",value:function(t){this.set(so,t)}},{key:"setZIndex",value:function(t){this.set(lo,t)}},{key:"disposeInternal",value:function(){this.state_&&(this.state_.layer=null,this.state_=null),bo(So(a.prototype),"disposeInternal",this).call(this)}}])&&mo(e.prototype,r),n&&mo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(br)),Bo=r(925),Wo=0,Xo=1,Yo=2,qo=3;function No(t,e){return Array.isArray(t)?t:(void 0===e?e=[t,t]:(e[0]=t,e[1]=t),e)}function Vo(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Zo=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.opacity_=e.opacity,this.rotateWithView_=e.rotateWithView,this.rotation_=e.rotation,this.scale_=e.scale,this.scaleArray_=No(e.scale),this.displacement_=e.displacement,this.declutterMode_=e.declutterMode}var e,r,n;return e=t,(r=[{key:"clone",value:function(){var e=this.getScale();return new t({opacity:this.getOpacity(),scale:Array.isArray(e)?e.slice():e,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}},{key:"getOpacity",value:function(){return this.opacity_}},{key:"getRotateWithView",value:function(){return this.rotateWithView_}},{key:"getRotation",value:function(){return this.rotation_}},{key:"getScale",value:function(){return this.scale_}},{key:"getScaleArray",value:function(){return this.scaleArray_}},{key:"getDisplacement",value:function(){return this.displacement_}},{key:"getDeclutterMode",value:function(){return this.declutterMode_}},{key:"getAnchor",value:function(){return i()}},{key:"getImage",value:function(t){return i()}},{key:"getHitDetectionImage",value:function(){return i()}},{key:"getPixelRatio",value:function(t){return 1}},{key:"getImageState",value:function(){return i()}},{key:"getImageSize",value:function(){return i()}},{key:"getOrigin",value:function(){return i()}},{key:"getSize",value:function(){return i()}},{key:"setDisplacement",value:function(t){this.displacement_=t}},{key:"setOpacity",value:function(t){this.opacity_=t}},{key:"setRotateWithView",value:function(t){this.rotateWithView_=t}},{key:"setRotation",value:function(t){this.rotation_=t}},{key:"setScale",value:function(t){this.scale_=t,this.scaleArray_=No(t)}},{key:"listenImageChange",value:function(t){i()}},{key:"load",value:function(){i()}},{key:"unlistenImageChange",value:function(t){i()}}])&&Vo(e.prototype,r),n&&Vo(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Uo=/^#([a-f0-9]{3}|[a-f0-9]{4}(?:[a-f0-9]{2}){0,2})$/i,Ko=/^([a-z]*)$|^hsla?\(.*\)$/i;function Ho(t){return"string"==typeof t?t:ea(t)}function Jo(t){var e=document.createElement("div");if(e.style.color=t,""!==e.style.color){document.body.appendChild(e);var r=getComputedStyle(e).color;return document.body.removeChild(e),r}return""}var $o=function(){var t={},e=0;return function(r){var n;if(t.hasOwnProperty(r))n=t[r];else{if(e>=1024){var i=0;for(var o in t)0==(3&i++)&&(delete t[o],--e)}n=function(t){var e,r,n,i,o;Ko.exec(t)&&(t=Jo(t));if(Uo.exec(t)){var a,s=t.length-1;a=s<=4?1:2;var u=4===s||8===s;e=parseInt(t.substr(1+0*a,a),16),r=parseInt(t.substr(1+1*a,a),16),n=parseInt(t.substr(1+2*a,a),16),i=u?parseInt(t.substr(1+3*a,a),16):255,1==a&&(e=(e<<4)+e,r=(r<<4)+r,n=(n<<4)+n,u&&(i=(i<<4)+i)),o=[e,r,n,i/255]}else 0==t.indexOf("rgba(")?ta(o=t.slice(5,-1).split(",").map(Number)):0==t.indexOf("rgb(")?((o=t.slice(4,-1).split(",").map(Number)).push(1),ta(o)):vt(!1,14);return o}(r),t[r]=n,++e}return n}}();function Qo(t){return Array.isArray(t)?t:$o(t)}function ta(t){return t[0]=h(t[0]+.5|0,0,255),t[1]=h(t[1]+.5|0,0,255),t[2]=h(t[2]+.5|0,0,255),t[3]=h(t[3],0,1),t}function ea(t){var e=t[0];e!=(0|e)&&(e=e+.5|0);var r=t[1];r!=(0|r)&&(r=r+.5|0);var n=t[2];return n!=(0|n)&&(n=n+.5|0),"rgba("+e+","+r+","+n+","+(void 0===t[3]?1:Math.round(100*t[3])/100)+")"}function ra(t){return Array.isArray(t)?ea(t):t}function na(t,e,r,n){var i;return i=r&&r.length?r.shift():xr?new OffscreenCanvas(t||300,e||300):document.createElement("canvas"),t&&(i.width=t),e&&(i.height=e),i.getContext("2d",n)}var ia=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),oa=["style","variant","weight","size","lineHeight","family"],aa=function(t){var e=t.match(ia);if(!e)return null;for(var r={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"},n=0,i=oa.length;n<i;++n){var o=e[n+1];void 0!==o&&(r[oa[n]]=o)}return r.families=r.family.split(/,\s?/),r};var sa="10px sans-serif",ua="#000",la="round",ca=[],fa="round",ha="#000",pa="center",ya="middle",da=[0,0,0,0],va=new br;(new Ve).setSize=function(){console.warn("labelCache is deprecated.")};var ga,ma,ba=null,_a={},xa=function(){var t,e,r="32px ",n=["monospace","serif"],i=n.length,o="wmytzilWMYTZIL@#/&?$%10";function a(t,a,s){for(var u=!0,l=0;l<i;++l){var c=n[l];if(e=Sa(t+" "+a+" "+r+c,o),s!=c){var f=Sa(t+" "+a+" "+r+s+","+c,o);u=u&&f!=e}}return!!u}function s(){for(var e=!0,r=va.getKeys(),n=0,i=r.length;n<i;++n){var o=r[n];va.get(o)<100&&(a.apply(this,o.split("\n"))?(u(_a),ba=null,ga=void 0,va.set(o,100)):(va.set(o,va.get(o)+1,!0),e=!1))}e&&(clearInterval(t),t=void 0)}return function(e){var r=aa(e);if(r)for(var n=r.families,i=0,o=n.length;i<o;++i){var u=n[i],l=r.style+"\n"+r.weight+"\n"+u;void 0===va.get(l)&&(va.set(l,100,!0),a(r.style,r.weight,u)||(va.set(l,0,!0),void 0===t&&(t=setInterval(s,32))))}}}(),wa=function(t){var e=_a[t];if(null==e){if(xr){var r=aa(t),n=ka(t,"Žg");e=(isNaN(Number(r.lineHeight))?1.2:Number(r.lineHeight))*(n.actualBoundingBoxAscent+n.actualBoundingBoxDescent)}else ma||((ma=document.createElement("div")).innerHTML="M",ma.style.minHeight="0",ma.style.maxHeight="none",ma.style.height="auto",ma.style.padding="0",ma.style.border="none",ma.style.position="absolute",ma.style.display="block",ma.style.left="-99999px"),ma.style.font=t,document.body.appendChild(ma),e=ma.offsetHeight,document.body.removeChild(ma);_a[t]=e}return e};function ka(t,e){return ba||(ba=na(1,1)),t!=ga&&(ba.font=t,ga=ba.font),ba.measureText(e)}function Sa(t,e){return ka(t,e).width}function Oa(t,e,r){if(e in r)return r[e];var n=e.split("\n").reduce((function(e,r){return Math.max(e,Sa(t,r))}),0);return r[e]=n,n}function Ta(t,e,r,n,i,o,a,s,u,l,c){t.save(),1!==r&&(t.globalAlpha*=r),e&&t.setTransform.apply(t,e),n.contextInstructions?(t.translate(u,l),t.scale(c[0],c[1]),function(t,e){for(var r=t.contextInstructions,n=0,i=r.length;n<i;n+=2)Array.isArray(r[n+1])?e[r[n]].apply(e,r[n+1]):e[r[n]]=r[n+1]}(n,t)):c[0]<0||c[1]<0?(t.translate(u,l),t.scale(c[0],c[1]),t.drawImage(n,i,o,a,s,0,0,a,s)):t.drawImage(n,i,o,a,s,u,l,a*c[0],s*c[1]),t.restore()}function Ca(t){return(Ca="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Pa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ra(t,e){return(Ra=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function ja(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ma(t);if(e){var i=Ma(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Ea(this,r)}}function Ea(t,e){if(e&&("object"===Ca(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ma(t){return(Ma=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Fa(t){return(Fa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ia(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Da(t,e){return(Da=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function za(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=La(t);if(e){var i=La(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Aa(this,r)}}function Aa(t,e){if(e&&("object"===Fa(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function La(t){return(La=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ga=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Da(t,e)}(o,t);var e,r,n,i=za(o);function o(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var e=t||{};return i.call(this,{points:1/0,fill:e.fill,radius:e.radius,stroke:e.stroke,scale:void 0!==e.scale?e.scale:1,rotation:void 0!==e.rotation?e.rotation:0,rotateWithView:void 0!==e.rotateWithView&&e.rotateWithView,displacement:void 0!==e.displacement?e.displacement:[0,0],declutterMode:e.declutterMode})}return e=o,(r=[{key:"clone",value:function(){var t=this.getScale(),e=new o({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(t)?t.slice():t,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}},{key:"setRadius",value:function(t){this.radius_=t,this.render()}}])&&Ia(e.prototype,r),n&&Ia(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ra(t,e)}(o,t);var e,r,n,i=ja(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=void 0!==t.rotateWithView&&t.rotateWithView;return(e=i.call(this,{opacity:1,rotateWithView:r,rotation:void 0!==t.rotation?t.rotation:0,scale:void 0!==t.scale?t.scale:1,displacement:void 0!==t.displacement?t.displacement:[0,0],declutterMode:t.declutterMode})).canvas_=void 0,e.hitDetectionCanvas_=null,e.fill_=void 0!==t.fill?t.fill:null,e.origin_=[0,0],e.points_=t.points,e.radius_=void 0!==t.radius?t.radius:t.radius1,e.radius2_=t.radius2,e.angle_=void 0!==t.angle?t.angle:0,e.stroke_=void 0!==t.stroke?t.stroke:null,e.size_=null,e.renderOptions_=null,e.render(),e}return e=o,(r=[{key:"clone",value:function(){var t=this.getScale(),e=new o({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(t)?t.slice():t,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return e.setOpacity(this.getOpacity()),e}},{key:"getAnchor",value:function(){var t=this.size_;if(!t)return null;var e=this.getDisplacement();return[t[0]/2-e[0],t[1]/2+e[1]]}},{key:"getAngle",value:function(){return this.angle_}},{key:"getFill",value:function(){return this.fill_}},{key:"getHitDetectionImage",value:function(){return this.hitDetectionCanvas_||this.createHitDetectionCanvas_(this.renderOptions_),this.hitDetectionCanvas_}},{key:"getImage",value:function(t){var e=this.canvas_[t];if(!e){var r=this.renderOptions_,n=na(r.size*t,r.size*t);this.draw_(r,n,t),e=n.canvas,this.canvas_[t]=e}return e}},{key:"getPixelRatio",value:function(t){return t}},{key:"getImageSize",value:function(){return this.size_}},{key:"getImageState",value:function(){return Yo}},{key:"getOrigin",value:function(){return this.origin_}},{key:"getPoints",value:function(){return this.points_}},{key:"getRadius",value:function(){return this.radius_}},{key:"getRadius2",value:function(){return this.radius2_}},{key:"getSize",value:function(){return this.size_}},{key:"getStroke",value:function(){return this.stroke_}},{key:"listenImageChange",value:function(t){}},{key:"load",value:function(){}},{key:"unlistenImageChange",value:function(t){}},{key:"calculateLineJoinSize_",value:function(t,e,r){if(0===e||this.points_===1/0||"bevel"!==t&&"miter"!==t)return e;var n=this.radius_,i=void 0===this.radius2_?n:this.radius2_;if(n<i){var o=n;n=i,i=o}var a=void 0===this.radius2_?this.points_:2*this.points_,s=2*Math.PI/a,u=i*Math.sin(s),l=n-Math.sqrt(i*i-u*u),c=Math.sqrt(u*u+l*l),f=c/u;if("miter"===t&&f<=r)return f*e;var h=e/2/f,p=e/2*(l/c),y=Math.sqrt((n+h)*(n+h)+p*p)-n;if(void 0===this.radius2_||"bevel"===t)return 2*y;var d=n*Math.sin(s),v=i-Math.sqrt(n*n-d*d),g=Math.sqrt(d*d+v*v)/d;if(g<=r){var m=g*e/2-i-n;return 2*Math.max(y,m)}return 2*y}},{key:"createRenderOptions",value:function(){var t,e=fa,r=0,n=null,i=0,o=0;this.stroke_&&(null===(t=this.stroke_.getColor())&&(t=ha),t=ra(t),void 0===(o=this.stroke_.getWidth())&&(o=1),n=this.stroke_.getLineDash(),i=this.stroke_.getLineDashOffset(),void 0===(e=this.stroke_.getLineJoin())&&(e=fa),void 0===(r=this.stroke_.getMiterLimit())&&(r=10));var a=this.calculateLineJoinSize_(e,o,r),s=Math.max(this.radius_,this.radius2_||0);return{strokeStyle:t,strokeWidth:o,size:Math.ceil(2*s+a),lineDash:n,lineDashOffset:i,lineJoin:e,miterLimit:r}}},{key:"render",value:function(){this.renderOptions_=this.createRenderOptions();var t=this.renderOptions_.size;this.canvas_={},this.size_=[t,t]}},{key:"draw_",value:function(t,e,r){if(e.scale(r,r),e.translate(t.size/2,t.size/2),this.createPath_(e),this.fill_){var n=this.fill_.getColor();null===n&&(n=ua),e.fillStyle=ra(n),e.fill()}this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,e.setLineDash&&t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}},{key:"createHitDetectionCanvas_",value:function(t){if(this.fill_){var e=this.fill_.getColor(),r=0;if("string"==typeof e&&(e=Qo(e)),null===e?r=1:Array.isArray(e)&&(r=4===e.length?e[3]:1),0===r){var n=na(t.size,t.size);this.hitDetectionCanvas_=n.canvas,this.drawHitDetectionCanvas_(t,n)}}this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.getImage(1))}},{key:"createPath_",value:function(t){var e=this.points_,r=this.radius_;if(e===1/0)t.arc(0,0,r,0,2*Math.PI);else{var n=void 0===this.radius2_?r:this.radius2_;void 0!==this.radius2_&&(e*=2);for(var i=this.angle_-Math.PI/2,o=2*Math.PI/e,a=0;a<e;a++){var s=i+a*o,u=a%2==0?r:n;t.lineTo(u*Math.cos(s),u*Math.sin(s))}t.closePath()}}},{key:"drawHitDetectionCanvas_",value:function(t,e){e.translate(t.size/2,t.size/2),this.createPath_(e),e.fillStyle=ua,e.fill(),this.stroke_&&(e.strokeStyle=t.strokeStyle,e.lineWidth=t.strokeWidth,t.lineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.miterLimit=t.miterLimit,e.stroke())}}])&&Pa(e.prototype,r),n&&Pa(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Zo));function Ba(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Wa=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e||{};this.color_=void 0!==r.color?r.color:null}var e,r,n;return e=t,(r=[{key:"clone",value:function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0})}},{key:"getColor",value:function(){return this.color_}},{key:"setColor",value:function(t){this.color_=t}}])&&Ba(e.prototype,r),n&&Ba(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Xa(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ya=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e||{};this.color_=void 0!==r.color?r.color:null,this.lineCap_=r.lineCap,this.lineDash_=void 0!==r.lineDash?r.lineDash:null,this.lineDashOffset_=r.lineDashOffset,this.lineJoin_=r.lineJoin,this.miterLimit_=r.miterLimit,this.width_=r.width}var e,r,n;return e=t,(r=[{key:"clone",value:function(){var e=this.getColor();return new t({color:Array.isArray(e)?e.slice():e||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}},{key:"getColor",value:function(){return this.color_}},{key:"getLineCap",value:function(){return this.lineCap_}},{key:"getLineDash",value:function(){return this.lineDash_}},{key:"getLineDashOffset",value:function(){return this.lineDashOffset_}},{key:"getLineJoin",value:function(){return this.lineJoin_}},{key:"getMiterLimit",value:function(){return this.miterLimit_}},{key:"getWidth",value:function(){return this.width_}},{key:"setColor",value:function(t){this.color_=t}},{key:"setLineCap",value:function(t){this.lineCap_=t}},{key:"setLineDash",value:function(t){this.lineDash_=t}},{key:"setLineDashOffset",value:function(t){this.lineDashOffset_=t}},{key:"setLineJoin",value:function(t){this.lineJoin_=t}},{key:"setMiterLimit",value:function(t){this.miterLimit_=t}},{key:"setWidth",value:function(t){this.width_=t}}])&&Xa(e.prototype,r),n&&Xa(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function qa(t){return(qa="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Na(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Va=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e||{};this.geometry_=null,this.geometryFunction_=Ka,void 0!==r.geometry&&this.setGeometry(r.geometry),this.fill_=void 0!==r.fill?r.fill:null,this.image_=void 0!==r.image?r.image:null,this.renderer_=void 0!==r.renderer?r.renderer:null,this.hitDetectionRenderer_=void 0!==r.hitDetectionRenderer?r.hitDetectionRenderer:null,this.stroke_=void 0!==r.stroke?r.stroke:null,this.text_=void 0!==r.text?r.text:null,this.zIndex_=r.zIndex}var e,r,n;return e=t,(r=[{key:"clone",value:function(){var e=this.getGeometry();return e&&"object"===qa(e)&&(e=e.clone()),new t({geometry:e,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer(),stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}},{key:"getRenderer",value:function(){return this.renderer_}},{key:"setRenderer",value:function(t){this.renderer_=t}},{key:"setHitDetectionRenderer",value:function(t){this.hitDetectionRenderer_=t}},{key:"getHitDetectionRenderer",value:function(){return this.hitDetectionRenderer_}},{key:"getGeometry",value:function(){return this.geometry_}},{key:"getGeometryFunction",value:function(){return this.geometryFunction_}},{key:"getFill",value:function(){return this.fill_}},{key:"setFill",value:function(t){this.fill_=t}},{key:"getImage",value:function(){return this.image_}},{key:"setImage",value:function(t){this.image_=t}},{key:"getStroke",value:function(){return this.stroke_}},{key:"setStroke",value:function(t){this.stroke_=t}},{key:"getText",value:function(){return this.text_}},{key:"setText",value:function(t){this.text_=t}},{key:"getZIndex",value:function(){return this.zIndex_}},{key:"setGeometry",value:function(t){"function"==typeof t?this.geometryFunction_=t:"string"==typeof t?this.geometryFunction_=function(e){return e.get(t)}:t?void 0!==t&&(this.geometryFunction_=function(){return t}):this.geometryFunction_=Ka,this.geometry_=t}},{key:"setZIndex",value:function(t){this.zIndex_=t}}])&&Na(e.prototype,r),n&&Na(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();var Za=null;function Ua(t,e){if(!Za){var r=new Wa({color:"rgba(255,255,255,0.4)"}),n=new Ya({color:"#3399CC",width:1.25});Za=[new Va({image:new Ga({fill:r,stroke:n,radius:5}),fill:r,stroke:n})]}return Za}function Ka(t){return t.getGeometry()}var Ha=Va;function Ja(t){return(Ja="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Qa(){return(Qa="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=ts(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function ts(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=is(t)););return t}function es(t,e){return(es=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function rs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=is(t);if(e){var i=is(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ns(this,r)}}function ns(t,e){if(e&&("object"===Ja(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function is(t){return(is=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var os="renderOrder",as=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&es(t,e)}(o,t);var e,r,n,i=rs(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=t||{},n=s({},r);return delete n.style,delete n.renderBuffer,delete n.updateWhileAnimating,delete n.updateWhileInteracting,(e=i.call(this,n)).declutter_=void 0!==r.declutter&&r.declutter,e.renderBuffer_=void 0!==r.renderBuffer?r.renderBuffer:100,e.style_=null,e.styleFunction_=void 0,e.setStyle(r.style),e.updateWhileAnimating_=void 0!==r.updateWhileAnimating&&r.updateWhileAnimating,e.updateWhileInteracting_=void 0!==r.updateWhileInteracting&&r.updateWhileInteracting,e}return e=o,(r=[{key:"getDeclutter",value:function(){return this.declutter_}},{key:"getFeatures",value:function(t){return Qa(is(o.prototype),"getFeatures",this).call(this,t)}},{key:"getRenderBuffer",value:function(){return this.renderBuffer_}},{key:"getRenderOrder",value:function(){return this.get(os)}},{key:"getStyle",value:function(){return this.style_}},{key:"getStyleFunction",value:function(){return this.styleFunction_}},{key:"getUpdateWhileAnimating",value:function(){return this.updateWhileAnimating_}},{key:"getUpdateWhileInteracting",value:function(){return this.updateWhileInteracting_}},{key:"renderDeclutter",value:function(t){t.declutterTree||(t.declutterTree=new Bo(9)),this.getRenderer().renderDeclutter(t)}},{key:"setRenderOrder",value:function(t){this.set(os,t)}},{key:"setStyle",value:function(t){this.style_=void 0!==t?t:Ua,this.styleFunction_=null===t?void 0:function(t){var e,r;"function"==typeof t?e=t:(Array.isArray(t)?r=t:(vt("function"==typeof t.getZIndex,41),r=[t]),e=function(){return r});return e}(this.style_),this.changed()}}])&&$a(e.prototype,r),n&&$a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Go),ss={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},us=[ss.FILL],ls=[ss.STROKE],cs=[ss.BEGIN_PATH],fs=[ss.CLOSE_PATH],hs=ss;function ps(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var ys=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)}var e,r,n;return e=t,(r=[{key:"drawCustom",value:function(t,e,r,n){}},{key:"drawGeometry",value:function(t){}},{key:"setStyle",value:function(t){}},{key:"drawCircle",value:function(t,e){}},{key:"drawFeature",value:function(t,e){}},{key:"drawGeometryCollection",value:function(t,e){}},{key:"drawLineString",value:function(t,e){}},{key:"drawMultiLineString",value:function(t,e){}},{key:"drawMultiPoint",value:function(t,e){}},{key:"drawMultiPolygon",value:function(t,e){}},{key:"drawPoint",value:function(t,e){}},{key:"drawPolygon",value:function(t,e){}},{key:"drawText",value:function(t,e){}},{key:"setFillStrokeStyle",value:function(t,e){}},{key:"setImageStyle",value:function(t,e){}},{key:"setTextStyle",value:function(t,e){}}])&&ps(e.prototype,r),n&&ps(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function ds(t){return(ds="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vs(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function gs(t,e){return(gs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function ms(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=_s(t);if(e){var i=_s(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return bs(this,r)}}function bs(t,e){if(e&&("object"===ds(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _s(t){return(_s=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var xs=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gs(t,e)}(o,t);var e,r,n,i=ms(o);function o(t,e,r,n){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this)).tolerance=t,a.maxExtent=e,a.pixelRatio=n,a.maxLineWidth=0,a.resolution=r,a.beginGeometryInstruction1_=null,a.beginGeometryInstruction2_=null,a.bufferedMaxExtent_=null,a.instructions=[],a.coordinates=[],a.tmpCoordinate_=[],a.hitDetectionInstructions=[],a.state={},a}return e=o,(r=[{key:"applyPixelRatio",value:function(t){var e=this.pixelRatio;return 1==e?t:t.map((function(t){return t*e}))}},{key:"appendFlatPointCoordinates",value:function(t,e){for(var r=this.getBufferedMaxExtent(),n=this.tmpCoordinate_,i=this.coordinates,o=i.length,a=0,s=t.length;a<s;a+=e)n[0]=t[a],n[1]=t[a+1],_t(r,n)&&(i[o++]=n[0],i[o++]=n[1]);return o}},{key:"appendFlatLineCoordinates",value:function(t,e,r,n,i,o){var a=this.coordinates,s=a.length,u=this.getBufferedMaxExtent();o&&(e+=n);var l,c,f,h=t[e],p=t[e+1],y=this.tmpCoordinate_,d=!0;for(l=e+n;l<r;l+=n)y[0]=t[l],y[1]=t[l+1],(f=kt(u,y))!==c?(d&&(a[s++]=h,a[s++]=p,d=!1),a[s++]=y[0],a[s++]=y[1]):f===rt?(a[s++]=y[0],a[s++]=y[1],d=!1):d=!0,h=y[0],p=y[1],c=f;return(i&&d||l===e+n)&&(a[s++]=h,a[s++]=p),s}},{key:"drawCustomCoordinates_",value:function(t,e,r,n,i){for(var o=0,a=r.length;o<a;++o){var s=r[o],u=this.appendFlatLineCoordinates(t,e,s,n,!1,!1);i.push(u),e=s}return e}},{key:"drawCustom",value:function(t,e,r,n){this.beginGeometry(t,e);var i,o,a,s,u,l=t.getType(),c=t.getStride(),f=this.coordinates.length;switch(l){case Pe:i=t.getOrientedFlatCoordinates(),s=[];var h=t.getEndss();u=0;for(var p=0,y=h.length;p<y;++p){var d=[];u=this.drawCustomCoordinates_(i,u,h[p],c,d),s.push(d)}this.instructions.push([hs.CUSTOM,f,s,t,r,hn]),this.hitDetectionInstructions.push([hs.CUSTOM,f,s,t,n||r,hn]);break;case Oe:case Ce:a=[],i=l==Oe?t.getOrientedFlatCoordinates():t.getFlatCoordinates(),u=this.drawCustomCoordinates_(i,0,t.getEnds(),c,a),this.instructions.push([hs.CUSTOM,f,a,t,r,fn]),this.hitDetectionInstructions.push([hs.CUSTOM,f,a,t,n||r,fn]);break;case ke:case je:i=t.getFlatCoordinates(),o=this.appendFlatLineCoordinates(i,0,i.length,c,!1,!1),this.instructions.push([hs.CUSTOM,f,o,t,r,cn]),this.hitDetectionInstructions.push([hs.CUSTOM,f,o,t,n||r,cn]);break;case Te:i=t.getFlatCoordinates(),(o=this.appendFlatPointCoordinates(i,c))>f&&(this.instructions.push([hs.CUSTOM,f,o,t,r,cn]),this.hitDetectionInstructions.push([hs.CUSTOM,f,o,t,n||r,cn]));break;case we:i=t.getFlatCoordinates(),this.coordinates.push(i[0],i[1]),o=this.coordinates.length,this.instructions.push([hs.CUSTOM,f,o,t,r]),this.hitDetectionInstructions.push([hs.CUSTOM,f,o,t,n||r])}this.endGeometry(e)}},{key:"beginGeometry",value:function(t,e){this.beginGeometryInstruction1_=[hs.BEGIN_GEOMETRY,e,0,t],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[hs.BEGIN_GEOMETRY,e,0,t],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}},{key:"finish",value:function(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}},{key:"reverseHitDetectionInstructions",value:function(){var t,e=this.hitDetectionInstructions;e.reverse();var r,n,i=e.length,o=-1;for(t=0;t<i;++t)(n=(r=e[t])[0])==hs.END_GEOMETRY?o=t:n==hs.BEGIN_GEOMETRY&&(r[2]=t,ze(this.hitDetectionInstructions,o,t),o=-1)}},{key:"setFillStrokeStyle",value:function(t,e){var r=this.state;if(t){var n=t.getColor();r.fillStyle=ra(n||ua)}else r.fillStyle=void 0;if(e){var i=e.getColor();r.strokeStyle=ra(i||ha);var o=e.getLineCap();r.lineCap=void 0!==o?o:la;var a=e.getLineDash();r.lineDash=a?a.slice():ca;var s=e.getLineDashOffset();r.lineDashOffset=s||0;var u=e.getLineJoin();r.lineJoin=void 0!==u?u:fa;var l=e.getWidth();r.lineWidth=void 0!==l?l:1;var c=e.getMiterLimit();r.miterLimit=void 0!==c?c:10,r.lineWidth>this.maxLineWidth&&(this.maxLineWidth=r.lineWidth,this.bufferedMaxExtent_=null)}else r.strokeStyle=void 0,r.lineCap=void 0,r.lineDash=null,r.lineDashOffset=void 0,r.lineJoin=void 0,r.lineWidth=void 0,r.miterLimit=void 0}},{key:"createFill",value:function(t){var e=t.fillStyle,r=[hs.SET_FILL_STYLE,e];return"string"!=typeof e&&r.push(!0),r}},{key:"applyStroke",value:function(t){this.instructions.push(this.createStroke(t))}},{key:"createStroke",value:function(t){return[hs.SET_STROKE_STYLE,t.strokeStyle,t.lineWidth*this.pixelRatio,t.lineCap,t.lineJoin,t.miterLimit,this.applyPixelRatio(t.lineDash),t.lineDashOffset*this.pixelRatio]}},{key:"updateFillStyle",value:function(t,e){var r=t.fillStyle;"string"==typeof r&&t.currentFillStyle==r||(void 0!==r&&this.instructions.push(e.call(this,t)),t.currentFillStyle=r)}},{key:"updateStrokeStyle",value:function(t,e){var r=t.strokeStyle,n=t.lineCap,i=t.lineDash,o=t.lineDashOffset,a=t.lineJoin,s=t.lineWidth,u=t.miterLimit;(t.currentStrokeStyle!=r||t.currentLineCap!=n||i!=t.currentLineDash&&!Le(t.currentLineDash,i)||t.currentLineDashOffset!=o||t.currentLineJoin!=a||t.currentLineWidth!=s||t.currentMiterLimit!=u)&&(void 0!==r&&e.call(this,t),t.currentStrokeStyle=r,t.currentLineCap=n,t.currentLineDash=i,t.currentLineDashOffset=o,t.currentLineJoin=a,t.currentLineWidth=s,t.currentMiterLimit=u)}},{key:"endGeometry",value:function(t){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;var e=[hs.END_GEOMETRY,t];this.instructions.push(e),this.hitDetectionInstructions.push(e)}},{key:"getBufferedMaxExtent",value:function(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(e=this.maxExtent,r?(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r):e.slice()),this.maxLineWidth>0)){var t=this.resolution*(this.maxLineWidth+1)/2;mt(this.bufferedMaxExtent_,t,this.bufferedMaxExtent_)}var e,r;return this.bufferedMaxExtent_}}])&&vs(e.prototype,r),n&&vs(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(ys);function ws(t){return(ws="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ks(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ss(){return(Ss="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Os(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Os(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Rs(t)););return t}function Ts(t,e){return(Ts=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Cs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Rs(t);if(e){var i=Rs(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Ps(this,r)}}function Ps(t,e){if(e&&("object"===ws(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Rs(t){return(Rs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var js=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ts(t,e)}(o,t);var e,r,n,i=Cs(o);function o(t,e,r,n){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this,t,e,r,n)).hitDetectionImage_=null,a.image_=null,a.imagePixelRatio_=void 0,a.anchorX_=void 0,a.anchorY_=void 0,a.height_=void 0,a.opacity_=void 0,a.originX_=void 0,a.originY_=void 0,a.rotateWithView_=void 0,a.rotation_=void 0,a.scale_=void 0,a.width_=void 0,a.declutterMode_=void 0,a.declutterImageWithText_=void 0,a}return e=o,(r=[{key:"drawPoint",value:function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,o=this.appendFlatPointCoordinates(r,n);this.instructions.push([hs.DRAW_IMAGE,i,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([hs.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}}},{key:"drawMultiPoint",value:function(t,e){if(this.image_){this.beginGeometry(t,e);var r=t.getFlatCoordinates(),n=t.getStride(),i=this.coordinates.length,o=this.appendFlatPointCoordinates(r,n);this.instructions.push([hs.DRAW_IMAGE,i,o,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([hs.DRAW_IMAGE,i,o,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,this.opacity_,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(e)}}},{key:"finish",value:function(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,Ss(Rs(o.prototype),"finish",this).call(this)}},{key:"setImageStyle",value:function(t,e){var r=t.getAnchor(),n=t.getSize(),i=t.getOrigin();this.imagePixelRatio_=t.getPixelRatio(this.pixelRatio),this.anchorX_=r[0],this.anchorY_=r[1],this.hitDetectionImage_=t.getHitDetectionImage(),this.image_=t.getImage(this.pixelRatio),this.height_=n[1],this.opacity_=t.getOpacity(),this.originX_=i[0],this.originY_=i[1],this.rotateWithView_=t.getRotateWithView(),this.rotation_=t.getRotation(),this.scale_=t.getScaleArray(),this.width_=n[0],this.declutterMode_=t.getDeclutterMode(),this.declutterImageWithText_=e}}])&&ks(e.prototype,r),n&&ks(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(xs);function Es(t){return(Es="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ms(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Fs(){return(Fs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Is(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Is(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ls(t)););return t}function Ds(t,e){return(Ds=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function zs(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ls(t);if(e){var i=Ls(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return As(this,r)}}function As(t,e){if(e&&("object"===Es(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ls(t){return(Ls=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Gs=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ds(t,e)}(o,t);var e,r,n,i=zs(o);function o(t,e,r,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,t,e,r,n)}return e=o,(r=[{key:"drawFlatCoordinates_",value:function(t,e,r,n){var i=this.coordinates.length,o=this.appendFlatLineCoordinates(t,e,r,n,!1,!1),a=[hs.MOVE_TO_LINE_TO,i,o];return this.instructions.push(a),this.hitDetectionInstructions.push(a),r}},{key:"drawLineString",value:function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,ca,0],cs);var o=t.getFlatCoordinates(),a=t.getStride();this.drawFlatCoordinates_(o,0,o.length,a),this.hitDetectionInstructions.push(ls),this.endGeometry(e)}}},{key:"drawMultiLineString",value:function(t,e){var r=this.state,n=r.strokeStyle,i=r.lineWidth;if(void 0!==n&&void 0!==i){this.updateStrokeStyle(r,this.applyStroke),this.beginGeometry(t,e),this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset],cs);for(var o=t.getEnds(),a=t.getFlatCoordinates(),s=t.getStride(),u=0,l=0,c=o.length;l<c;++l)u=this.drawFlatCoordinates_(a,u,o[l],s);this.hitDetectionInstructions.push(ls),this.endGeometry(e)}}},{key:"finish",value:function(){var t=this.state;return null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&this.instructions.push(ls),this.reverseHitDetectionInstructions(),this.state=null,Fs(Ls(o.prototype),"finish",this).call(this)}},{key:"applyStroke",value:function(t){null!=t.lastStroke&&t.lastStroke!=this.coordinates.length&&(this.instructions.push(ls),t.lastStroke=this.coordinates.length),t.lastStroke=0,Fs(Ls(o.prototype),"applyStroke",this).call(this,t),this.instructions.push(cs)}}])&&Ms(e.prototype,r),n&&Ms(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(xs);function Bs(t){return(Bs="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Ws(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Xs(){return(Xs="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Ys(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Ys(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Zs(t)););return t}function qs(t,e){return(qs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ns(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Zs(t);if(e){var i=Zs(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Vs(this,r)}}function Vs(t,e){if(e&&("object"===Bs(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Zs(t){return(Zs=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Us=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&qs(t,e)}(o,t);var e,r,n,i=Ns(o);function o(t,e,r,n){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),i.call(this,t,e,r,n)}return e=o,(r=[{key:"drawFlatCoordinatess_",value:function(t,e,r,n){var i=this.state,o=void 0!==i.fillStyle,a=void 0!==i.strokeStyle,s=r.length;this.instructions.push(cs),this.hitDetectionInstructions.push(cs);for(var u=0;u<s;++u){var l=r[u],c=this.coordinates.length,f=this.appendFlatLineCoordinates(t,e,l,n,!0,!a),h=[hs.MOVE_TO_LINE_TO,c,f];this.instructions.push(h),this.hitDetectionInstructions.push(h),a&&(this.instructions.push(fs),this.hitDetectionInstructions.push(fs)),e=l}return o&&(this.instructions.push(us),this.hitDetectionInstructions.push(us)),a&&(this.instructions.push(ls),this.hitDetectionInstructions.push(ls)),e}},{key:"drawCircle",value:function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([hs.SET_FILL_STYLE,ua]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=t.getFlatCoordinates(),a=t.getStride(),s=this.coordinates.length;this.appendFlatLineCoordinates(o,0,o.length,a,!1,!1);var u=[hs.CIRCLE,s];this.instructions.push(cs,u),this.hitDetectionInstructions.push(cs,u),void 0!==r.fillStyle&&(this.instructions.push(us),this.hitDetectionInstructions.push(us)),void 0!==r.strokeStyle&&(this.instructions.push(ls),this.hitDetectionInstructions.push(ls)),this.endGeometry(e)}}},{key:"drawPolygon",value:function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([hs.SET_FILL_STYLE,ua]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);var o=t.getEnds(),a=t.getOrientedFlatCoordinates(),s=t.getStride();this.drawFlatCoordinatess_(a,0,o,s),this.endGeometry(e)}}},{key:"drawMultiPolygon",value:function(t,e){var r=this.state,n=r.fillStyle,i=r.strokeStyle;if(void 0!==n||void 0!==i){this.setFillStrokeStyles_(),this.beginGeometry(t,e),void 0!==r.fillStyle&&this.hitDetectionInstructions.push([hs.SET_FILL_STYLE,ua]),void 0!==r.strokeStyle&&this.hitDetectionInstructions.push([hs.SET_STROKE_STYLE,r.strokeStyle,r.lineWidth,r.lineCap,r.lineJoin,r.miterLimit,r.lineDash,r.lineDashOffset]);for(var o=t.getEndss(),a=t.getOrientedFlatCoordinates(),s=t.getStride(),u=0,l=0,c=o.length;l<c;++l)u=this.drawFlatCoordinatess_(a,u,o[l],s);this.endGeometry(e)}}},{key:"finish",value:function(){this.reverseHitDetectionInstructions(),this.state=null;var t=this.tolerance;if(0!==t)for(var e=this.coordinates,r=0,n=e.length;r<n;++r)e[r]=an(e[r],t);return Xs(Zs(o.prototype),"finish",this).call(this)}},{key:"setFillStrokeStyles_",value:function(){var t=this.state;void 0!==t.fillStyle&&this.updateFillStyle(t,this.createFill),void 0!==t.strokeStyle&&this.updateStrokeStyle(t,this.applyStroke)}}])&&Ws(e.prototype,r),n&&Ws(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(xs),Ks="point",Hs="line";function Js(t,e,r,n,i){var o,a,s,u,l,c,f,h,p,y=r,d=r,v=0,g=0,m=r;for(o=r;o<n;o+=i){var b=e[o],_=e[o+1];void 0!==u&&(h=b-u,p=_-l,s=Math.sqrt(h*h+p*p),void 0!==c&&(g+=a,Math.acos((c*h+f*p)/(a*s))>t&&(g>v&&(v=g,y=m,d=o),g=0,m=o-i)),a=s,c=h,f=p),u=b,l=_}return(g+=s)>v?[m,o]:[y,d]}function $s(t){return($s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qs(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tu(){return(tu="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=eu(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function eu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ou(t)););return t}function ru(t,e){return(ru=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function nu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ou(t);if(e){var i=ou(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return iu(this,r)}}function iu(t,e){if(e&&("object"===$s(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ou(t){return(ou=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var au={left:0,end:0,center:.5,right:1,start:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};function su(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var uu={Circle:Us,Default:xs,Image:js,LineString:Gs,Polygon:Us,Text:function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ru(t,e)}(o,t);var e,r,n,i=nu(o);function o(t,e,r,n){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this,t,e,r,n)).labels_=null,a.text_="",a.textOffsetX_=0,a.textOffsetY_=0,a.textRotateWithView_=void 0,a.textRotation_=0,a.textFillState_=null,a.fillStates={},a.textStrokeState_=null,a.strokeStates={},a.textState_={},a.textStates={},a.textKey_="",a.fillKey_="",a.strokeKey_="",a.declutterImageWithText_=void 0,a}return e=o,(r=[{key:"finish",value:function(){var t=tu(ou(o.prototype),"finish",this).call(this);return t.textStates=this.textStates,t.fillStates=this.fillStates,t.strokeStates=this.strokeStates,t}},{key:"drawText",value:function(t,e){var r=this.textFillState_,n=this.textStrokeState_,i=this.textState_;if(""!==this.text_&&i&&(r||n)){var o=this.coordinates,a=o.length,s=t.getType(),u=null,l=t.getStride();if(i.placement!==Hs||s!=ke&&s!=Ce&&s!=Oe&&s!=Pe){var c=i.overflow?null:[];switch(s){case we:case Te:u=t.getFlatCoordinates();break;case ke:u=t.getFlatMidpoint();break;case je:u=t.getCenter();break;case Ce:u=t.getFlatMidpoints(),l=2;break;case Oe:u=t.getFlatInteriorPoint(),i.overflow||c.push(u[2]/this.resolution),l=3;break;case Pe:var f=t.getFlatInteriorPoints();u=[];for(var h=0,p=f.length;h<p;h+=3)i.overflow||c.push(f[h+2]/this.resolution),u.push(f[h],f[h+1]);if(0===u.length)return;l=2}var y=this.appendFlatPointCoordinates(u,l);if(y===a)return;if(c&&(y-a)/2!=u.length/l){var d=a/2;c=c.filter((function(t,e){var r=o[2*(d+e)]===u[e*l]&&o[2*(d+e)+1]===u[e*l+1];return r||--d,r}))}this.saveTextStates_(),(i.backgroundFill||i.backgroundStroke)&&(this.setFillStrokeStyle(i.backgroundFill,i.backgroundStroke),i.backgroundFill&&(this.updateFillStyle(this.state,this.createFill),this.hitDetectionInstructions.push(this.createFill(this.state))),i.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(t,e);var v=i.padding;if(v!=da&&(i.scale[0]<0||i.scale[1]<0)){var g=i.padding[0],m=i.padding[1],b=i.padding[2],_=i.padding[3];i.scale[0]<0&&(m=-m,_=-_),i.scale[1]<0&&(g=-g,b=-b),v=[g,m,b,_]}var x=this.pixelRatio;this.instructions.push([hs.DRAW_IMAGE,a,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,v==da?da:v.map((function(t){return t*x})),!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]);var w=1/x;this.hitDetectionInstructions.push([hs.DRAW_IMAGE,a,y,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[w,w],NaN,void 0,this.declutterImageWithText_,v,!!i.backgroundFill,!!i.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,c]),this.endGeometry(e)}else{if(!Nt(this.getBufferedMaxExtent(),t.getExtent()))return;var k;if(u=t.getFlatCoordinates(),s==ke)k=[u.length];else if(s==Ce)k=t.getEnds();else if(s==Oe)k=t.getEnds().slice(0,1);else if(s==Pe){var S=t.getEndss();k=[];for(var O=0,T=S.length;O<T;++O)k.push(S[O][0])}this.beginGeometry(t,e);for(var C,P=i.textAlign,R=0,j=0,E=k.length;j<E;++j){if(null==P){var M=Js(i.maxAngle,u,R,k[j],l);R=M[0],C=M[1]}else C=k[j];for(var F=R;F<C;F+=l)o.push(u[F],u[F+1]);var I=o.length;R=k[j],this.drawChars_(a,I),a=I}this.endGeometry(e)}}}},{key:"saveTextStates_",value:function(){var t=this.textStrokeState_,e=this.textState_,r=this.textFillState_,n=this.strokeKey_;t&&(n in this.strokeStates||(this.strokeStates[n]={strokeStyle:t.strokeStyle,lineCap:t.lineCap,lineDashOffset:t.lineDashOffset,lineWidth:t.lineWidth,lineJoin:t.lineJoin,miterLimit:t.miterLimit,lineDash:t.lineDash}));var i=this.textKey_;i in this.textStates||(this.textStates[i]={font:e.font,textAlign:e.textAlign||pa,justify:e.justify,textBaseline:e.textBaseline||ya,scale:e.scale});var o=this.fillKey_;r&&(o in this.fillStates||(this.fillStates[o]={fillStyle:r.fillStyle}))}},{key:"drawChars_",value:function(t,e){var r=this.textStrokeState_,n=this.textState_,i=this.strokeKey_,o=this.textKey_,a=this.fillKey_;this.saveTextStates_();var s=this.pixelRatio,u=au[n.textBaseline],l=this.textOffsetY_*s,c=this.text_,f=r?r.lineWidth*Math.abs(n.scale[0])/2:0;this.instructions.push([hs.DRAW_CHARS,t,e,u,n.overflow,a,n.maxAngle,s,l,i,f*s,c,o,1]),this.hitDetectionInstructions.push([hs.DRAW_CHARS,t,e,u,n.overflow,a,n.maxAngle,1,l,i,f,c,o,1/s])}},{key:"setTextStyle",value:function(t,e){var r,n,i;if(t){var o=t.getFill();o?((n=this.textFillState_)||(n={},this.textFillState_=n),n.fillStyle=ra(o.getColor()||ua)):(n=null,this.textFillState_=n);var s=t.getStroke();if(s){(i=this.textStrokeState_)||(i={},this.textStrokeState_=i);var u=s.getLineDash(),l=s.getLineDashOffset(),c=s.getWidth(),f=s.getMiterLimit();i.lineCap=s.getLineCap()||la,i.lineDash=u?u.slice():ca,i.lineDashOffset=void 0===l?0:l,i.lineJoin=s.getLineJoin()||fa,i.lineWidth=void 0===c?1:c,i.miterLimit=void 0===f?10:f,i.strokeStyle=ra(s.getColor()||ha)}else i=null,this.textStrokeState_=i;r=this.textState_;var h=t.getFont()||sa;xa(h);var p=t.getScaleArray();r.overflow=t.getOverflow(),r.font=h,r.maxAngle=t.getMaxAngle(),r.placement=t.getPlacement(),r.textAlign=t.getTextAlign(),r.justify=t.getJustify(),r.textBaseline=t.getTextBaseline()||ya,r.backgroundFill=t.getBackgroundFill(),r.backgroundStroke=t.getBackgroundStroke(),r.padding=t.getPadding()||da,r.scale=void 0===p?[1,1]:p;var y=t.getOffsetX(),d=t.getOffsetY(),v=t.getRotateWithView(),g=t.getRotation();this.text_=t.getText()||"",this.textOffsetX_=void 0===y?0:y,this.textOffsetY_=void 0===d?0:d,this.textRotateWithView_=void 0!==v&&v,this.textRotation_=void 0===g?0:g,this.strokeKey_=i?("string"==typeof i.strokeStyle?i.strokeStyle:a(i.strokeStyle))+i.lineCap+i.lineDashOffset+"|"+i.lineWidth+i.lineJoin+i.miterLimit+"["+i.lineDash.join()+"]":"",this.textKey_=r.font+r.scale+(r.textAlign||"?")+(r.justify||"?")+(r.textBaseline||"?"),this.fillKey_=n?"string"==typeof n.fillStyle?n.fillStyle:"|"+a(n.fillStyle):""}else this.text_="";this.declutterImageWithText_=e}}])&&Qs(e.prototype,r),n&&Qs(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(xs)},lu=function(){function t(e,r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.tolerance_=e,this.maxExtent_=r,this.pixelRatio_=i,this.resolution_=n,this.buildersByZIndex_={}}var e,r,n;return e=t,(r=[{key:"finish",value:function(){var t={};for(var e in this.buildersByZIndex_){t[e]=t[e]||{};var r=this.buildersByZIndex_[e];for(var n in r){var i=r[n].finish();t[e][n]=i}}return t}},{key:"getBuilder",value:function(t,e){var r=void 0!==t?t.toString():"0",n=this.buildersByZIndex_[r];void 0===n&&(n={},this.buildersByZIndex_[r]=n);var i=n[e];return void 0===i&&(i=new(0,uu[e])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),n[e]=i),i}}])&&su(e.prototype,r),n&&su(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),cu="Circle",fu="Default",hu="Image",pu="LineString",yu="Polygon",du="Text";function vu(t,e,r,n,i,o,a,s,u,l,c,f){var h=t[e],p=t[e+1],y=0,d=0,v=0,g=0;function m(){y=h,d=p,h=t[e+=n],p=t[e+1],g+=v,v=Math.sqrt((h-y)*(h-y)+(p-d)*(p-d))}do{m()}while(e<r-n&&g+v<o);for(var _=0===v?0:(o-g)/v,x=b(y,h,_),w=b(d,p,_),k=e-n,S=g,O=o+s*u(l,i,c);e<r-n&&g+v<O;)m();var T,C=b(y,h,_=0===v?0:(O-g)/v),P=b(d,p,_);if(f){var R=[x,w,C,P];Fr(R,0,4,2,f,R,R),T=R[0]>R[2]}else T=x>C;var j,E=Math.PI,M=[],F=k+n===e;if(v=0,g=S,h=t[e=k],p=t[e+1],F){m(),j=Math.atan2(p-d,h-y),T&&(j+=j>0?-E:E);var I=(C+x)/2,D=(P+w)/2;return M[0]=[I,D,(O-o)/2,j,i],M}for(var z=0,A=(i=i.replace(/\n/g," ")).length;z<A;){m();var L=Math.atan2(p-d,h-y);if(T&&(L+=L>0?-E:E),void 0!==j){var G=L-j;if(G+=G>E?-2*E:G<-E?2*E:0,Math.abs(G)>a)return null}j=L;for(var B=z,W=0;z<A;++z){var X=s*u(l,i[T?A-z-1:z],c);if(e+n<r&&g+v<o+W+X/2)break;W+=X}if(z!==B){var Y=T?i.substring(A-B,A-z):i.substring(B,z),q=b(y,h,_=0===v?0:(o+W/2-g)/v),N=b(d,p,_);M.push([q,N,W/2,L,Y]),o+=W}}return M}function gu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var mu=[1/0,1/0,-1/0,-1/0],bu=[],_u=[],xu=[],wu=[];function ku(t){return t[3].declutterBox}var Su=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function Ou(t,e){return"start"!==e&&"end"!==e||Su.test(t)||(e="start"===e?"left":"right"),au[e]}function Tu(t,e,r){return r>0&&t.push("\n",""),t.push(e,""),t}var Cu=function(){function t(e,r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.overlaps=n,this.pixelRatio=r,this.resolution=e,this.alignFill_,this.instructions=i.instructions,this.coordinates=i.coordinates,this.coordinateCache_={},this.renderedTransform_=[1,0,0,1,0,0],this.hitDetectionInstructions=i.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=i.fillStates||{},this.strokeStates=i.strokeStates||{},this.textStates=i.textStates||{},this.widths_={},this.labels_={}}var e,r,n;return e=t,(r=[{key:"createLabel",value:function(t,e,r,n){var i=t+e+r+n;if(this.labels_[i])return this.labels_[i];var o=n?this.strokeStates[n]:null,a=r?this.fillStates[r]:null,s=this.textStates[e],u=this.pixelRatio,l=[s.scale[0]*u,s.scale[1]*u],c=Array.isArray(t),f=s.justify?au[s.justify]:Ou(Array.isArray(t)?t[0]:t,s.textAlign||pa),h=n&&o.lineWidth?o.lineWidth:0,p=c?t:t.split("\n").reduce(Tu,[]),y=function(t,e){for(var r=[],n=[],i=[],o=0,a=0,s=0,u=0,l=0,c=e.length;l<=c;l+=2){var f=e[l];if("\n"!==f&&l!==c){var h=e[l+1]||t.font,p=Sa(h,f);r.push(p),a+=p;var y=wa(h);n.push(y),u=Math.max(u,y)}else o=Math.max(o,a),i.push(a),a=0,s+=u}return{width:o,height:s,widths:r,heights:n,lineWidths:i}}(s,p),d=y.width,v=y.height,g=y.widths,m=y.heights,b=y.lineWidths,_=d+h,x=[],w=(_+2)*l[0],k=(v+h)*l[1],S={width:w<0?Math.floor(w):Math.ceil(w),height:k<0?Math.floor(k):Math.ceil(k),contextInstructions:x};1==l[0]&&1==l[1]||x.push("scale",l),n&&(x.push("strokeStyle",o.strokeStyle),x.push("lineWidth",h),x.push("lineCap",o.lineCap),x.push("lineJoin",o.lineJoin),x.push("miterLimit",o.miterLimit),(xr?OffscreenCanvasRenderingContext2D:CanvasRenderingContext2D).prototype.setLineDash&&(x.push("setLineDash",[o.lineDash]),x.push("lineDashOffset",o.lineDashOffset))),r&&x.push("fillStyle",a.fillStyle),x.push("textBaseline","middle"),x.push("textAlign","center");for(var O,T=.5-f,C=f*_+T*h,P=[],R=[],j=0,E=0,M=0,F=0,I=0,D=p.length;I<D;I+=2){var z=p[I];if("\n"!==z){var A=p[I+1]||s.font;A!==O&&(n&&P.push("font",A),r&&R.push("font",A),O=A),j=Math.max(j,m[M]);var L=[z,C+T*g[M]+f*(g[M]-b[F]),.5*(h+j)+E];C+=g[M],n&&P.push("strokeText",L),r&&R.push("fillText",L),++M}else E+=j,j=0,C=f*_+T*h,++F}return Array.prototype.push.apply(x,P),Array.prototype.push.apply(x,R),this.labels_[i]=S,S}},{key:"replayTextBackground_",value:function(t,e,r,n,i,o,a){t.beginPath(),t.moveTo.apply(t,e),t.lineTo.apply(t,r),t.lineTo.apply(t,n),t.lineTo.apply(t,i),t.lineTo.apply(t,e),o&&(this.alignFill_=o[2],this.fill_(t)),a&&(this.setStrokeStyle_(t,a),t.stroke())}},{key:"calculateImageOrLabelDimensions_",value:function(t,e,r,n,i,o,a,s,u,l,c,f,h,p,y,d){var v,g=r-(a*=f[0]),m=n-(s*=f[1]),b=i+u>t?t-u:i,_=o+l>e?e-l:o,x=p[3]+b*f[0]+p[1],w=p[0]+_*f[1]+p[2],k=g-p[3],S=m-p[0];return(y||0!==c)&&(bu[0]=k,wu[0]=k,bu[1]=S,_u[1]=S,_u[0]=k+x,xu[0]=_u[0],xu[1]=S+w,wu[1]=xu[1]),0!==c?(Cr(v=Rr([1,0,0,1,0,0],r,n,1,1,c,-r,-n),bu),Cr(v,_u),Cr(v,xu),Cr(v,wu),Ot(Math.min(bu[0],_u[0],xu[0],wu[0]),Math.min(bu[1],_u[1],xu[1],wu[1]),Math.max(bu[0],_u[0],xu[0],wu[0]),Math.max(bu[1],_u[1],xu[1],wu[1]),mu)):Ot(Math.min(k,k+x),Math.min(S,S+w),Math.max(k,k+x),Math.max(S,S+w),mu),h&&(g=Math.round(g),m=Math.round(m)),{drawImageX:g,drawImageY:m,drawImageW:b,drawImageH:_,originX:u,originY:l,declutterBox:{minX:mu[0],minY:mu[1],maxX:mu[2],maxY:mu[3],value:d},canvasTransform:v,scale:f}}},{key:"replayImageOrLabel_",value:function(t,e,r,n,i,o,a){var s=!(!o&&!a),u=n.declutterBox,l=t.canvas,c=a?a[2]*n.scale[0]/2:0;return u.minX-c<=l.width/e&&u.maxX+c>=0&&u.minY-c<=l.height/e&&u.maxY+c>=0&&(s&&this.replayTextBackground_(t,bu,_u,xu,wu,o,a),Ta(t,n.canvasTransform,i,r,n.originX,n.originY,n.drawImageW,n.drawImageH,n.drawImageX,n.drawImageY,n.scale)),!0}},{key:"fill_",value:function(t){if(this.alignFill_){var e=Cr(this.renderedTransform_,[0,0]),r=512*this.pixelRatio;t.save(),t.translate(e[0]%r,e[1]%r),t.rotate(this.viewRotation_)}t.fill(),this.alignFill_&&t.restore()}},{key:"setStrokeStyle_",value:function(t,e){t.strokeStyle=e[1],t.lineWidth=e[2],t.lineCap=e[3],t.lineJoin=e[4],t.miterLimit=e[5],t.setLineDash&&(t.lineDashOffset=e[7],t.setLineDash(e[6]))}},{key:"drawLabelWithPointPlacement_",value:function(t,e,r,n){var i=this.textStates[e],o=this.createLabel(t,e,n,r),a=this.strokeStates[r],s=this.pixelRatio,u=Ou(Array.isArray(t)?t[0]:t,i.textAlign||pa),l=au[i.textBaseline||ya],c=a&&a.lineWidth?a.lineWidth:0;return{label:o,anchorX:u*(o.width/s-2*i.scale[0])+2*(.5-u)*c,anchorY:l*o.height/s+2*(.5-l)*c}}},{key:"execute_",value:function(t,e,r,n,i,o,a,s){var u,l,c;this.pixelCoordinates_&&Le(r,this.renderedTransform_)?u=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),u=Mr(this.coordinates,0,this.coordinates.length,2,r,this.pixelCoordinates_),l=this.renderedTransform_,c=r,l[0]=c[0],l[1]=c[1],l[2]=c[2],l[3]=c[3],l[4]=c[4],l[5]=c[5]);for(var f,h,p,y,d,v,g,m,b,_,x,w,k,S,O,T,C=0,P=n.length,R=0,j=0,E=0,M=null,F=null,I=this.coordinateCache_,D=this.viewRotation_,z=Math.round(1e12*Math.atan2(-r[1],r[0]))/1e12,A={context:t,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:D},L=this.instructions!=n||this.overlaps?0:200;C<P;){var G=n[C];switch(G[0]){case hs.BEGIN_GEOMETRY:k=G[1],T=G[3],k.getGeometry()?void 0===a||Nt(a,T.getExtent())?++C:C=G[2]+1:C=G[2];break;case hs.BEGIN_PATH:j>L&&(this.fill_(t),j=0),E>L&&(t.stroke(),E=0),j||E||(t.beginPath(),y=NaN,d=NaN),++C;break;case hs.CIRCLE:var B=u[R=G[1]],W=u[R+1],X=u[R+2]-B,Y=u[R+3]-W,q=Math.sqrt(X*X+Y*Y);t.moveTo(B+q,W),t.arc(B,W,q,0,2*Math.PI,!0),++C;break;case hs.CLOSE_PATH:t.closePath(),++C;break;case hs.CUSTOM:R=G[1],f=G[2];var N=G[3],V=G[4],Z=6==G.length?G[5]:void 0;A.geometry=N,A.feature=k,C in I||(I[C]=[]);var U=I[C];Z?Z(u,R,f,2,U):(U[0]=u[R],U[1]=u[R+1],U.length=2),V(U,A),++C;break;case hs.DRAW_IMAGE:R=G[1],f=G[2],m=G[3],h=G[4],p=G[5];var K=G[6],H=G[7],J=G[8],$=G[9],Q=G[10],tt=G[11],et=G[12],rt=G[13],nt=G[14],it=G[15];if(!m&&G.length>=20){b=G[19],_=G[20],x=G[21],w=G[22];var ot=this.drawLabelWithPointPlacement_(b,_,x,w);m=ot.label,G[3]=m;var at=G[23];h=(ot.anchorX-at)*this.pixelRatio,G[4]=h;var st=G[24];p=(ot.anchorY-st)*this.pixelRatio,G[5]=p,K=m.height,G[6]=K,rt=m.width,G[13]=rt}var ut=void 0;G.length>25&&(ut=G[25]);var lt=void 0,ct=void 0,ft=void 0;G.length>17?(lt=G[16],ct=G[17],ft=G[18]):(lt=da,ct=!1,ft=!1),Q&&z?tt+=D:Q||z||(tt-=D);for(var ht=0;R<f;R+=2)if(!(ut&&ut[ht++]<rt/this.pixelRatio)){var pt=this.calculateImageOrLabelDimensions_(m.width,m.height,u[R],u[R+1],rt,K,h,p,J,$,tt,et,i,lt,ct||ft,k),yt=[t,e,m,pt,H,ct?M:null,ft?F:null];if(s){if("none"===nt)continue;if("obstacle"===nt){s.insert(pt.declutterBox);continue}var dt=void 0,vt=void 0;if(it){var gt=f-R;if(!it[gt]){it[gt]=yt;continue}if(dt=it[gt],delete it[gt],vt=ku(dt),s.collides(vt))continue}if(s.collides(pt.declutterBox))continue;dt&&(s.insert(vt),this.replayImageOrLabel_.apply(this,dt)),s.insert(pt.declutterBox)}this.replayImageOrLabel_.apply(this,yt)}++C;break;case hs.DRAW_CHARS:var mt=G[1],bt=G[2],_t=G[3],xt=G[4];w=G[5];var wt=G[6],kt=G[7],St=G[8];x=G[9];var Ot=G[10];b=G[11],_=G[12];var Tt=[G[13],G[13]],Ct=this.textStates[_],Pt=Ct.font,Rt=[Ct.scale[0]*kt,Ct.scale[1]*kt],jt=void 0;Pt in this.widths_?jt=this.widths_[Pt]:(jt={},this.widths_[Pt]=jt);var Et=_n(u,mt,bt,2),Mt=Math.abs(Rt[0])*Oa(Pt,b,jt);if(xt||Mt<=Et){var Ft=this.textStates[_].textAlign,It=vu(u,mt,bt,2,b,(Et-Mt)*au[Ft],wt,Math.abs(Rt[0]),Oa,Pt,jt,z?0:this.viewRotation_);t:if(It){var Dt=[],zt=void 0,At=void 0,Lt=void 0,Gt=void 0,Bt=void 0;if(x)for(zt=0,At=It.length;zt<At;++zt){Lt=(Bt=It[zt])[4],Gt=this.createLabel(Lt,_,"",x),h=Bt[2]+(Rt[0]<0?-Ot:Ot),p=_t*Gt.height+2*(.5-_t)*Ot*Rt[1]/Rt[0]-St;var Wt=this.calculateImageOrLabelDimensions_(Gt.width,Gt.height,Bt[0],Bt[1],Gt.width,Gt.height,h,p,0,0,Bt[3],Tt,!1,da,!1,k);if(s&&s.collides(Wt.declutterBox))break t;Dt.push([t,e,Gt,Wt,1,null,null])}if(w)for(zt=0,At=It.length;zt<At;++zt){Lt=(Bt=It[zt])[4],Gt=this.createLabel(Lt,_,w,""),h=Bt[2],p=_t*Gt.height-St;var Xt=this.calculateImageOrLabelDimensions_(Gt.width,Gt.height,Bt[0],Bt[1],Gt.width,Gt.height,h,p,0,0,Bt[3],Tt,!1,da,!1,k);if(s&&s.collides(Xt.declutterBox))break t;Dt.push([t,e,Gt,Xt,1,null,null])}s&&s.load(Dt.map(ku));for(var Yt=0,qt=Dt.length;Yt<qt;++Yt)this.replayImageOrLabel_.apply(this,Dt[Yt])}}++C;break;case hs.END_GEOMETRY:if(void 0!==o){var Vt=o(k=G[1],T);if(Vt)return Vt}++C;break;case hs.FILL:L?j++:this.fill_(t),++C;break;case hs.MOVE_TO_LINE_TO:for(R=G[1],f=G[2],S=u[R],g=(O=u[R+1])+.5|0,(v=S+.5|0)===y&&g===d||(t.moveTo(S,O),y=v,d=g),R+=2;R<f;R+=2)v=(S=u[R])+.5|0,g=(O=u[R+1])+.5|0,R!=f-2&&v===y&&g===d||(t.lineTo(S,O),y=v,d=g);++C;break;case hs.SET_FILL_STYLE:M=G,this.alignFill_=G[2],j&&(this.fill_(t),j=0,E&&(t.stroke(),E=0)),t.fillStyle=G[1],++C;break;case hs.SET_STROKE_STYLE:F=G,E&&(t.stroke(),E=0),this.setStrokeStyle_(t,G),++C;break;case hs.STROKE:L?E++:t.stroke(),++C;break;default:++C}}j&&this.fill_(t),E&&t.stroke()}},{key:"execute",value:function(t,e,r,n,i,o){this.viewRotation_=n,this.execute_(t,e,r,this.instructions,i,void 0,void 0,o)}},{key:"executeHitDetection",value:function(t,e,r,n,i){return this.viewRotation_=r,this.execute_(t,1,e,this.hitDetectionInstructions,!0,n,i)}}])&&gu(e.prototype,r),n&&gu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Pu(t){return function(t){if(Array.isArray(t))return Ru(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return Ru(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return Ru(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ru(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function ju(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Eu=[yu,cu,pu,hu,du,fu],Mu=function(){function t(e,r,n,i,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.maxExtent_=e,this.overlaps_=i,this.pixelRatio_=n,this.resolution_=r,this.renderBuffer_=a,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=[1,0,0,1,0,0],this.createExecutors_(o)}var e,r,n;return e=t,(r=[{key:"clip",value:function(t,e){var r=this.getClipCoords(e);t.beginPath(),t.moveTo(r[0],r[1]),t.lineTo(r[2],r[3]),t.lineTo(r[4],r[5]),t.lineTo(r[6],r[7]),t.clip()}},{key:"createExecutors_",value:function(t){for(var e in t){var r=this.executorsByZIndex_[e];void 0===r&&(r={},this.executorsByZIndex_[e]=r);var n=t[e];for(var i in n){var o=n[i];r[i]=new Cu(this.resolution_,this.pixelRatio_,this.overlaps_,o)}}}},{key:"hasExecutors",value:function(t){for(var e in this.executorsByZIndex_)for(var r=this.executorsByZIndex_[e],n=0,i=t.length;n<i;++n)if(t[n]in r)return!0;return!1}},{key:"forEachFeatureAtCoordinate",value:function(t,e,r,n,i,o){var a=2*(n=Math.round(n))+1,s=Rr(this.hitDetectionTransform_,n+.5,n+.5,1/e,-1/e,-r,-t[0],-t[1]),u=!this.hitDetectionContext_;u&&(this.hitDetectionContext_=na(a,a));var l,c=this.hitDetectionContext_;c.canvas.width!==a||c.canvas.height!==a?(c.canvas.width=a,c.canvas.height=a):u||c.clearRect(0,0,a,a),void 0!==this.renderBuffer_&&(Et(l=[1/0,1/0,-1/0,-1/0],t),mt(l,e*(this.renderBuffer_+n),l));var f,h=function(t){if(void 0!==Fu[t])return Fu[t];for(var e=2*t+1,r=t*t,n=new Array(r+1),i=0;i<=t;++i)for(var o=0;o<=t;++o){var a=i*i+o*o;if(a>r)break;var s=n[a];s||(s=[],n[a]=s),s.push(4*((t+i)*e+(t+o))+3),i>0&&s.push(4*((t-i)*e+(t+o))+3),o>0&&(s.push(4*((t+i)*e+(t-o))+3),i>0&&s.push(4*((t-i)*e+(t-o))+3))}for(var u=[],l=0,c=n.length;l<c;++l)n[l]&&u.push.apply(u,Pu(n[l]));return Fu[t]=u,u}(n);function p(t,e){for(var r=c.getImageData(0,0,a,a).data,s=0,u=h.length;s<u;s++)if(r[h[s]]>0){if(!o||f!==hu&&f!==du||-1!==o.indexOf(t)){var l=(h[s]-3)/4,p=n-l%a,y=n-(l/a|0),d=i(t,e,p*p+y*y);if(d)return d}c.clearRect(0,0,a,a);break}}var y,d,v,g,m,b=Object.keys(this.executorsByZIndex_).map(Number);for(b.sort(De),y=b.length-1;y>=0;--y){var _=b[y].toString();for(v=this.executorsByZIndex_[_],d=Eu.length-1;d>=0;--d)if(void 0!==(g=v[f=Eu[d]])&&(m=g.executeHitDetection(c,s,r,p,l)))return m}}},{key:"getClipCoords",value:function(t){var e=this.maxExtent_;if(!e)return null;var r=e[0],n=e[1],i=e[2],o=e[3],a=[r,n,r,o,i,o,i,n];return Mr(a,0,8,2,t,a),a}},{key:"isEmpty",value:function(){return l(this.executorsByZIndex_)}},{key:"execute",value:function(t,e,r,n,i,o,a){var s=Object.keys(this.executorsByZIndex_).map(Number);s.sort(De),this.maxExtent_&&(t.save(),this.clip(t,r));var u,l,c,f,h,p,y=o||Eu;for(a&&s.reverse(),u=0,l=s.length;u<l;++u){var d=s[u].toString();for(h=this.executorsByZIndex_[d],c=0,f=y.length;c<f;++c)void 0!==(p=h[y[c]])&&p.execute(t,e,r,n,i,a)}this.maxExtent_&&t.restore()}}])&&ju(e.prototype,r),n&&ju(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Fu={};var Iu=Mu;function Du(t){return(Du="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function zu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Au(){return(Au="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Lu(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Lu(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Yu(t)););return t}function Gu(t,e){return(Gu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Bu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Yu(t);if(e){var i=Yu(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Wu(this,r)}}function Wu(t,e){if(e&&("object"===Du(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Xu(t)}function Xu(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Yu(t){return(Yu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var qu=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Gu(t,e)}(a,t);var e,r,n,o=Bu(a);function a(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).ready=!0,e.boundHandleImageChange_=e.handleImageChange_.bind(Xu(e)),e.layer_=t,e.declutterExecutorGroup=null,e}return e=a,(r=[{key:"getFeatures",value:function(t){return i()}},{key:"getData",value:function(t){return null}},{key:"prepareFrame",value:function(t){return i()}},{key:"renderFrame",value:function(t,e){return i()}},{key:"loadedTileCallback",value:function(t,e,r){t[e]||(t[e]={}),t[e][r.tileCoord.toString()]=r}},{key:"createLoadedTileFinder",value:function(t,e,r){return function(n,i){var o=this.loadedTileCallback.bind(this,r,n);return t.forEachLoadedTile(e,n,i,o)}.bind(this)}},{key:"forEachFeatureAtCoordinate",value:function(t,e,r,n,i){}},{key:"getDataAtPixel",value:function(t,e,r){return null}},{key:"getLayer",value:function(){return this.layer_}},{key:"handleFontsChanged",value:function(){}},{key:"handleImageChange_",value:function(t){t.target.getState()===Yo&&this.renderIfReadyAndVisible()}},{key:"loadImage",value:function(t){var e=t.getState();return e!=Yo&&e!=qo&&t.addEventListener(Ze,this.boundHandleImageChange_),e==Wo&&(t.load(),e=t.getState()),e==Yo}},{key:"renderIfReadyAndVisible",value:function(){var t=this.getLayer();t&&t.getVisible()&&t.getSourceState()==Ro&&t.changed()}},{key:"disposeInternal",value:function(){delete this.layer_,Au(Yu(a.prototype),"disposeInternal",this).call(this)}}])&&zu(e.prototype,r),n&&zu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(ar);function Nu(t){return(Nu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Zu(t,e){return(Zu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Uu(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Hu(t);if(e){var i=Hu(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Ku(this,r)}}function Ku(t,e){if(e&&("object"===Nu(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Hu(t){return(Hu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ju=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zu(t,e)}(o,t);var e,r,n,i=Uu(o);function o(t,e,r,n){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this,t)).inversePixelTransform=e,a.frameState=r,a.context=n,a}return e=o,r&&Vu(e.prototype,r),n&&Vu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}(Me);function $u(t){return($u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qu(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tl(){return(tl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=el(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function el(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=ol(t)););return t}function rl(t,e){return(rl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function nl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=ol(t);if(e){var i=ol(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return il(this,r)}}function il(t,e){if(e&&("object"===$u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function ol(t){return(ol=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var al=null;var sl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rl(t,e)}(o,t);var e,r,n,i=nl(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,t)).container=null,e.renderedResolution,e.tempTransform=[1,0,0,1,0,0],e.pixelTransform=[1,0,0,1,0,0],e.inversePixelTransform=[1,0,0,1,0,0],e.context=null,e.containerReused=!1,e.pixelContext_=null,e.frameState=null,e}return e=o,(r=[{key:"getImageData",value:function(t,e,r){var n;al||function(){var t=document.createElement("canvas");t.width=1,t.height=1,al=t.getContext("2d")}(),al.clearRect(0,0,1,1);try{al.drawImage(t,e,r,1,1,0,0,1,1),n=al.getImageData(0,0,1,1).data}catch(t){return al=null,null}return n}},{key:"getBackground",value:function(t){var e=this.getLayer().getBackground();return"function"==typeof e&&(e=e(t.viewState.resolution)),e||void 0}},{key:"useContainer",value:function(t,e,r,n){var i,o,a=this.getLayer().getClassName();if(t&&t.className===a&&""===t.style.opacity&&1===r&&(!n||t&&t.style.backgroundColor&&Le(Qo(t.style.backgroundColor),Qo(n)))){var s=t.firstElementChild;s instanceof HTMLCanvasElement&&(o=s.getContext("2d"))}if(o&&o.canvas.style.transform===e?(this.container=t,this.context=o,this.containerReused=!0):this.containerReused&&(this.container=null,this.context=null,this.containerReused=!1),!this.container){(i=document.createElement("div")).className=a;var u=i.style;u.position="absolute",u.width="100%",u.height="100%";var l=(o=na()).canvas;i.appendChild(l),(u=l.style).position="absolute",u.left="0",u.transformOrigin="top left",this.container=i,this.context=o}this.containerReused||!n||this.container.style.backgroundColor||(this.container.style.backgroundColor=n)}},{key:"clipUnrotated",value:function(t,e,r){var n=Xt(r),i=Yt(r),o=At(r),a=zt(r);Cr(e.coordinateToPixelTransform,n),Cr(e.coordinateToPixelTransform,i),Cr(e.coordinateToPixelTransform,o),Cr(e.coordinateToPixelTransform,a);var s=this.inversePixelTransform;Cr(s,n),Cr(s,i),Cr(s,o),Cr(s,a),t.save(),t.beginPath(),t.moveTo(Math.round(n[0]),Math.round(n[1])),t.lineTo(Math.round(i[0]),Math.round(i[1])),t.lineTo(Math.round(o[0]),Math.round(o[1])),t.lineTo(Math.round(a[0]),Math.round(a[1])),t.clip()}},{key:"dispatchRenderEvent_",value:function(t,e,r){var n=this.getLayer();if(n.hasListener(t)){var i=new Ju(t,this.inversePixelTransform,r,e);n.dispatchEvent(i)}}},{key:"preRender",value:function(t,e){this.frameState=e,this.dispatchRenderEvent_(Oo,t,e)}},{key:"postRender",value:function(t,e){this.dispatchRenderEvent_(To,t,e)}},{key:"getRenderTransform",value:function(t,e,r,n,i,o,a){var s=i/2,u=o/2,l=n/e,c=-l,f=-t[0]+a,h=-t[1];return Rr(this.tempTransform,s,u,l,c,-r,f,h)}},{key:"getDataAtPixel",value:function(t,e,r){var n=Cr(this.inversePixelTransform,t.slice()),i=this.context,o=this.getLayer().getExtent();if(o&&!_t(o,Cr(e.pixelToCoordinateTransform,t.slice())))return null;var a,s=Math.round(n[0]),u=Math.round(n[1]),l=this.pixelContext_;if(!l){var c=document.createElement("canvas");c.width=1,c.height=1,l=c.getContext("2d"),this.pixelContext_=l}l.clearRect(0,0,1,1);try{l.drawImage(i.canvas,s,u,1,1,0,0,1,1),a=l.getImageData(0,0,1,1).data}catch(t){return"SecurityError"===t.name?(this.pixelContext_=null,new Uint8Array):a}return 0===a[3]?null:a}},{key:"disposeInternal",value:function(){delete this.frameState,tl(ol(o.prototype),"disposeInternal",this).call(this)}}])&&Qu(e.prototype,r),n&&Qu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(qu);function ul(t){return Math.pow(t,3)}function ll(t){return(ll="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function cl(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function fl(t,e){return(fl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function hl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=yl(t);if(e){var i=yl(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return pl(this,r)}}function pl(t,e){if(e&&("object"===ll(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function yl(t){return(yl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var dl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&fl(t,e)}(a,t);var e,r,n,o=hl(a);function a(t,e,r){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a);var i=r||{};return(n=o.call(this)).tileCoord=t,n.state=e,n.interimTile=null,n.key="",n.transition_=void 0===i.transition?250:i.transition,n.transitionStarts_={},n.interpolate=!!i.interpolate,n}return e=a,(r=[{key:"changed",value:function(){this.dispatchEvent(Ze)}},{key:"release",value:function(){}},{key:"getKey",value:function(){return this.key+"/"+this.tileCoord}},{key:"getInterimTile",value:function(){if(!this.interimTile)return this;var t=this.interimTile;do{if(t.getState()==Zi)return this.transition_=0,t;t=t.interimTile}while(t);return this}},{key:"refreshInterimChain",value:function(){if(this.interimTile){var t=this.interimTile,e=this;do{if(t.getState()==Zi){t.interimTile=null;break}t.getState()==Vi?e=t:t.getState()==Ni?e.interimTile=t.interimTile:e=t,t=e.interimTile}while(t)}}},{key:"getTileCoord",value:function(){return this.tileCoord}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(t){if(this.state!==Ui&&this.state>t)throw new Error("Tile load sequence violation");this.state=t,this.changed()}},{key:"load",value:function(){i()}},{key:"getAlpha",value:function(t,e){if(!this.transition_)return 1;var r=this.transitionStarts_[t];if(r){if(-1===r)return 1}else r=e,this.transitionStarts_[t]=r;var n=e-r+1e3/60;return n>=this.transition_?1:ul(n/this.transition_)}},{key:"inTransition",value:function(t){return!!this.transition_&&-1!==this.transitionStarts_[t]}},{key:"endTransition",value:function(t){this.transition_&&(this.transitionStarts_[t]=-1)}}])&&cl(e.prototype,r),n&&cl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(Ve);function vl(t,e,r){var n=t,i=!0,o=!1,a=!1,s=[Je(n,Ke,(function(){a=!0,o||e()}))];return n.src&&wr?(o=!0,n.decode().then((function(){i&&e()})).catch((function(t){i&&(a?e():r())}))):s.push(Je(n,Ue,r)),function(){i=!1,s.forEach($e)}}function gl(t){return(gl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ml(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function bl(t,e){return(bl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _l(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=wl(t);if(e){var i=wl(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return xl(this,r)}}function xl(t,e){if(e&&("object"===gl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function wl(t){return(wl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var kl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&bl(t,e)}(o,t);var e,r,n,i=_l(o);function o(t,e,r,n,a,s){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(u=i.call(this,t,e,s)).crossOrigin_=n,u.src_=r,u.key=r,u.image_=new Image,null!==n&&(u.image_.crossOrigin=n),u.unlisten_=null,u.tileLoadFunction_=a,u}return e=o,(r=[{key:"getImage",value:function(){return this.image_}},{key:"setImage",value:function(t){this.image_=t,this.state=Zi,this.unlistenImage_(),this.changed()}},{key:"handleImageError_",value:function(){var t;this.state=Ui,this.unlistenImage_(),this.image_=((t=na(1,1)).fillStyle="rgba(0,0,0,0)",t.fillRect(0,0,1,1),t.canvas),this.changed()}},{key:"handleImageLoad_",value:function(){var t=this.image_;t.naturalWidth&&t.naturalHeight?this.state=Zi:this.state=Ki,this.unlistenImage_(),this.changed()}},{key:"load",value:function(){this.state==Ui&&(this.state=Ni,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==Ni&&(this.state=Vi,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=vl(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}},{key:"unlistenImage_",value:function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}])&&ml(e.prototype,r),n&&ml(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(dl);function Sl(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Ol,Tl=function(){function t(e,r,n,i,o,a){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.sourceProj_=e,this.targetProj_=r;var s={},u=ne(this.targetProj_,this.sourceProj_);this.transformInv_=function(t){var e=t[0]+"/"+t[1];return s[e]||(s[e]=u(t)),s[e]},this.maxSourceExtent_=i,this.errorThresholdSquared_=o*o,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!i&&!!this.sourceProj_.getExtent()&&qt(i)==qt(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?qt(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?qt(this.targetProj_.getExtent()):null;var l=Xt(n),c=Yt(n),f=At(n),h=zt(n),p=this.transformInv_(l),d=this.transformInv_(c),v=this.transformInv_(f),g=this.transformInv_(h),m=10+(a?Math.max(0,Math.ceil(y(Dt(n)/(a*a*256*256)))):0);if(this.addQuad_(l,c,f,h,p,d,v,g,m),this.wrapsXInSource_){var b=1/0;this.triangles_.forEach((function(t,e,r){b=Math.min(b,t.source[0][0],t.source[1][0],t.source[2][0])})),this.triangles_.forEach(function(t){if(Math.max(t.source[0][0],t.source[1][0],t.source[2][0])-b>this.sourceWorldWidth_/2){var e=[[t.source[0][0],t.source[0][1]],[t.source[1][0],t.source[1][1]],[t.source[2][0],t.source[2][1]]];e[0][0]-b>this.sourceWorldWidth_/2&&(e[0][0]-=this.sourceWorldWidth_),e[1][0]-b>this.sourceWorldWidth_/2&&(e[1][0]-=this.sourceWorldWidth_),e[2][0]-b>this.sourceWorldWidth_/2&&(e[2][0]-=this.sourceWorldWidth_);var r=Math.min(e[0][0],e[1][0],e[2][0]);Math.max(e[0][0],e[1][0],e[2][0])-r<this.sourceWorldWidth_/2&&(t.source=e)}}.bind(this))}s={}}var e,r,n;return e=t,(r=[{key:"addTriangle_",value:function(t,e,r,n,i,o){this.triangles_.push({source:[n,i,o],target:[t,e,r]})}},{key:"addQuad_",value:function(t,e,r,n,i,o,a,s,u){var l=gt([i,o,a,s]),c=this.sourceWorldWidth_?qt(l)/this.sourceWorldWidth_:null,f=this.sourceWorldWidth_,h=this.sourceProj_.canWrapX()&&c>.5&&c<1,p=!1;if(u>0&&(this.targetProj_.isGlobal()&&this.targetWorldWidth_&&(p=qt(gt([t,e,r,n]))/this.targetWorldWidth_>.25||p),!h&&this.sourceProj_.isGlobal()&&c&&(p=c>.25||p)),!(!p&&this.maxSourceExtent_&&isFinite(l[0])&&isFinite(l[1])&&isFinite(l[2])&&isFinite(l[3]))||Nt(l,this.maxSourceExtent_)){var y=0;if(!(p||isFinite(i[0])&&isFinite(i[1])&&isFinite(o[0])&&isFinite(o[1])&&isFinite(a[0])&&isFinite(a[1])&&isFinite(s[0])&&isFinite(s[1])))if(u>0)p=!0;else if(1!=(y=(isFinite(i[0])&&isFinite(i[1])?0:8)+(isFinite(o[0])&&isFinite(o[1])?0:4)+(isFinite(a[0])&&isFinite(a[1])?0:2)+(isFinite(s[0])&&isFinite(s[1])?0:1))&&2!=y&&4!=y&&8!=y)return;if(u>0){if(!p){var d,v=[(t[0]+r[0])/2,(t[1]+r[1])/2],g=this.transformInv_(v);d=h?(m(i[0],f)+m(a[0],f))/2-m(g[0],f):(i[0]+a[0])/2-g[0];var b=(i[1]+a[1])/2-g[1];p=d*d+b*b>this.errorThresholdSquared_}if(p){if(Math.abs(t[0]-r[0])<=Math.abs(t[1]-r[1])){var _=[(e[0]+r[0])/2,(e[1]+r[1])/2],x=this.transformInv_(_),w=[(n[0]+t[0])/2,(n[1]+t[1])/2],k=this.transformInv_(w);this.addQuad_(t,e,_,w,i,o,x,k,u-1),this.addQuad_(w,_,r,n,k,x,a,s,u-1)}else{var S=[(t[0]+e[0])/2,(t[1]+e[1])/2],O=this.transformInv_(S),T=[(r[0]+n[0])/2,(r[1]+n[1])/2],C=this.transformInv_(T);this.addQuad_(t,S,T,n,i,O,C,s,u-1),this.addQuad_(S,e,r,T,O,o,a,C,u-1)}return}}if(h){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}0==(11&y)&&this.addTriangle_(t,r,n,i,a,s),0==(14&y)&&this.addTriangle_(t,r,e,i,a,o),y&&(0==(13&y)&&this.addTriangle_(e,n,t,o,s,i),0==(7&y)&&this.addTriangle_(e,n,r,o,s,a))}}},{key:"calculateSourceExtent",value:function(){var t=[1/0,1/0,-1/0,-1/0];return this.triangles_.forEach((function(e,r,n){var i=e.source;Et(t,i[0]),Et(t,i[1]),Et(t,i[2])})),t}},{key:"getTriangles",value:function(){return this.triangles_}}])&&Sl(e.prototype,r),n&&Sl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Cl={imageSmoothingEnabled:!1,msImageSmoothingEnabled:!1},Pl={imageSmoothingEnabled:!0,msImageSmoothingEnabled:!0};function Rl(t,e,r,n,i){t.beginPath(),t.moveTo(0,0),t.lineTo(e,r),t.lineTo(n,i),t.closePath(),t.save(),t.clip(),t.fillRect(0,0,Math.max(e,n)+1,Math.max(r,i)),t.restore()}function jl(t,e){return Math.abs(t[4*e]-210)>2||Math.abs(t[4*e+3]-191.25)>2}function El(t,e,r,n){var i=ie(r,e,t),o=Qt(e,n,r),a=e.getMetersPerUnit();void 0!==a&&(o*=a);var s=t.getMetersPerUnit();void 0!==s&&(o/=s);var u=t.getExtent();if(!u||_t(u,i)){var l=Qt(t,o,i)/o;isFinite(l)&&l>0&&(o/=l)}return o}function Ml(t,e,r,n,i,o,a,u,l,c,f,h){var p=na(Math.round(r*t),Math.round(r*e));if(h||s(p,Cl),0===l.length)return p.canvas;function y(t){return Math.round(t*r)/r}p.scale(r,r),p.globalCompositeOperation="lighter";var d=[1/0,1/0,-1/0,-1/0];l.forEach((function(t,e,r){jt(d,t.extent)}));var v=qt(d),g=Bt(d),m=na(Math.round(r*v/n),Math.round(r*g/n));h||s(m,Cl);var b=r/n;l.forEach((function(t,e,r){var n=t.extent[0]-d[0],i=-(t.extent[3]-d[3]),o=qt(t.extent),a=Bt(t.extent);t.image.width>0&&t.image.height>0&&m.drawImage(t.image,c,c,t.image.width-2*c,t.image.height-2*c,n*b,i*b,o*b,a*b)}));var _=Xt(a);return u.getTriangles().forEach((function(t,e,i){var a=t.source,s=t.target,u=a[0][0],l=a[0][1],c=a[1][0],f=a[1][1],v=a[2][0],g=a[2][1],b=y((s[0][0]-_[0])/o),x=y(-(s[0][1]-_[1])/o),w=y((s[1][0]-_[0])/o),k=y(-(s[1][1]-_[1])/o),S=y((s[2][0]-_[0])/o),O=y(-(s[2][1]-_[1])/o),T=u,C=l;u=0,l=0;var P=function(t){for(var e=t.length,r=0;r<e;r++){for(var n=r,i=Math.abs(t[r][r]),o=r+1;o<e;o++){var a=Math.abs(t[o][r]);a>i&&(i=a,n=o)}if(0===i)return null;var s=t[n];t[n]=t[r],t[r]=s;for(var u=r+1;u<e;u++)for(var l=-t[u][r]/t[r][r],c=r;c<e+1;c++)r==c?t[u][c]=0:t[u][c]+=l*t[r][c]}for(var f=new Array(e),h=e-1;h>=0;h--){f[h]=t[h][e]/t[h][h];for(var p=h-1;p>=0;p--)t[p][e]-=t[p][h]*f[h]}return f}([[c-=T,f-=C,0,0,w-b],[v-=T,g-=C,0,0,S-b],[0,0,c,f,k-x],[0,0,v,g,O-x]]);if(P){if(p.save(),p.beginPath(),function(){if(void 0===Ol){var t=document.createElement("canvas").getContext("2d");t.globalCompositeOperation="lighter",t.fillStyle="rgba(210, 0, 0, 0.75)",Rl(t,4,5,4,0),Rl(t,4,5,0,5);var e=t.getImageData(0,0,3,3).data;Ol=jl(e,0)||jl(e,4)||jl(e,8)}return Ol}()||!h){p.moveTo(w,k);for(var R=b-w,j=x-k,E=0;E<4;E++)p.lineTo(w+y((E+1)*R/4),k+y(E*j/3)),3!=E&&p.lineTo(w+y((E+1)*R/4),k+y((E+1)*j/3));p.lineTo(S,O)}else p.moveTo(w,k),p.lineTo(b,x),p.lineTo(S,O);p.clip(),p.transform(P[0],P[2],P[1],P[3],b,x),p.translate(d[0]-T,d[3]-C),p.scale(n/r,-n/r),p.drawImage(m.canvas,0,0),p.restore()}})),f&&(p.save(),p.globalCompositeOperation="source-over",p.strokeStyle="black",p.lineWidth=1,u.getTriangles().forEach((function(t,e,r){var n=t.target,i=(n[0][0]-_[0])/o,a=-(n[0][1]-_[1])/o,s=(n[1][0]-_[0])/o,u=-(n[1][1]-_[1])/o,l=(n[2][0]-_[0])/o,c=-(n[2][1]-_[1])/o;p.beginPath(),p.moveTo(s,u),p.lineTo(i,a),p.lineTo(l,c),p.closePath(),p.stroke()})),p.restore()),p.canvas}function Fl(t){return(Fl="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Il(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Dl(t,e){return(Dl=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function zl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ll(t);if(e){var i=Ll(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Al(this,r)}}function Al(t,e){if(e&&("object"===Fl(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ll(t){return(Ll=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Gl=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Dl(t,e)}(o,t);var e,r,n,i=zl(o);function o(t,e,r,n,a,s,u,l,c,f,p,y){var d;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(d=i.call(this,a,Ni,{interpolate:!!y})).renderEdges_=void 0!==p&&p,d.pixelRatio_=u,d.gutter_=l,d.canvas_=null,d.sourceTileGrid_=e,d.targetTileGrid_=n,d.wrappedTileCoord_=s||a,d.sourceTiles_=[],d.sourcesListenerKeys_=null,d.sourceZ_=0;var v=n.getTileCoordExtent(d.wrappedTileCoord_),g=d.targetTileGrid_.getExtent(),m=d.sourceTileGrid_.getExtent(),b=g?Wt(v,g):v;if(0===Dt(b))return d.state=Ki,Al(d);var _=t.getExtent();_&&(m=m?Wt(m,_):_);var x=n.getResolution(d.wrappedTileCoord_[0]),w=function(t,e,r,n){var i=Lt(r),o=El(t,e,i,n);return(!isFinite(o)||o<=0)&&It(r,(function(r){return o=El(t,e,r,n),isFinite(o)&&o>0})),o}(t,r,b,x);if(!isFinite(w)||w<=0)return d.state=Ki,Al(d);var k=void 0!==f?f:.5;if(d.triangulation_=new Tl(t,r,b,m,w*k,x),0===d.triangulation_.getTriangles().length)return d.state=Ki,Al(d);d.sourceZ_=e.getZForResolution(w);var S=d.triangulation_.calculateSourceExtent();if(m&&(t.canWrapX()?(S[1]=h(S[1],m[1],m[3]),S[3]=h(S[3],m[1],m[3])):S=Wt(S,m)),Dt(S)){for(var O=e.getTileRangeForExtentAndZ(S,d.sourceZ_),T=O.minX;T<=O.maxX;T++)for(var C=O.minY;C<=O.maxY;C++){var P=c(d.sourceZ_,T,C,u);P&&d.sourceTiles_.push(P)}0===d.sourceTiles_.length&&(d.state=Ki)}else d.state=Ki;return d}return e=o,(r=[{key:"getImage",value:function(){return this.canvas_}},{key:"reproject_",value:function(){var t=[];if(this.sourceTiles_.forEach(function(e,r,n){e&&e.getState()==Zi&&t.push({extent:this.sourceTileGrid_.getTileCoordExtent(e.tileCoord),image:e.getImage()})}.bind(this)),this.sourceTiles_.length=0,0===t.length)this.state=Ui;else{var e=this.wrappedTileCoord_[0],r=this.targetTileGrid_.getTileSize(e),n="number"==typeof r?r:r[0],i="number"==typeof r?r:r[1],o=this.targetTileGrid_.getResolution(e),a=this.sourceTileGrid_.getResolution(this.sourceZ_),s=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=Ml(n,i,this.pixelRatio_,a,this.sourceTileGrid_.getExtent(),o,s,this.triangulation_,t,this.gutter_,this.renderEdges_,this.interpolate),this.state=Zi}this.changed()}},{key:"load",value:function(){if(this.state==Ni){this.state=Vi,this.changed();var t=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach(function(e,r,n){var i=e.getState();if(i==Ni||i==Vi){t++;var o=He(e,Ze,(function(r){var n=e.getState();n!=Zi&&n!=Ui&&n!=Ki||($e(o),0==--t&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(o)}}.bind(this)),0===t?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(t,e,r){t.getState()==Ni&&t.load()}))}}},{key:"unlistenSources_",value:function(){this.sourcesListenerKeys_.forEach($e),this.sourcesListenerKeys_=null}}])&&Il(e.prototype,r),n&&Il(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(dl);function Bl(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Wl=function(){function t(e,r,n,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.minX=e,this.maxX=r,this.minY=n,this.maxY=i}var e,r,n;return e=t,(r=[{key:"contains",value:function(t){return this.containsXY(t[1],t[2])}},{key:"containsTileRange",value:function(t){return this.minX<=t.minX&&t.maxX<=this.maxX&&this.minY<=t.minY&&t.maxY<=this.maxY}},{key:"containsXY",value:function(t,e){return this.minX<=t&&t<=this.maxX&&this.minY<=e&&e<=this.maxY}},{key:"equals",value:function(t){return this.minX==t.minX&&this.minY==t.minY&&this.maxX==t.maxX&&this.maxY==t.maxY}},{key:"extend",value:function(t){t.minX<this.minX&&(this.minX=t.minX),t.maxX>this.maxX&&(this.maxX=t.maxX),t.minY<this.minY&&(this.minY=t.minY),t.maxY>this.maxY&&(this.maxY=t.maxY)}},{key:"getHeight",value:function(){return this.maxY-this.minY+1}},{key:"getSize",value:function(){return[this.getWidth(),this.getHeight()]}},{key:"getWidth",value:function(){return this.maxX-this.minX+1}},{key:"intersects",value:function(t){return this.minX<=t.maxX&&this.maxX>=t.minX&&this.minY<=t.maxY&&this.maxY>=t.minY}}])&&Bl(e.prototype,r),n&&Bl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Xl(t,e,r,n,i){return void 0!==i?(i.minX=t,i.maxX=e,i.minY=r,i.maxY=n,i):new Wl(t,e,r,n)}var Yl=Wl;function ql(t){return(ql="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Nl(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Vl(){return(Vl="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Zl(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Zl(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Jl(t)););return t}function Ul(t,e){return(Ul=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Kl(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Jl(t);if(e){var i=Jl(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Hl(this,r)}}function Hl(t,e){if(e&&("object"===ql(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Jl(t){return(Jl=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var $l=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ul(t,e)}(o,t);var e,r,n,i=Kl(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,t)).extentChanged=!0,e.renderedExtent_=null,e.renderedPixelRatio,e.renderedProjection=null,e.renderedRevision,e.renderedTiles=[],e.newTiles_=!1,e.tmpExtent=[1/0,1/0,-1/0,-1/0],e.tmpTileRange_=new Yl(0,0,0,0),e}return e=o,(r=[{key:"isDrawableTile",value:function(t){var e=this.getLayer(),r=t.getState(),n=e.getUseInterimTilesOnError();return r==Zi||r==Ki||r==Ui&&!n}},{key:"getTile",value:function(t,e,r,n){var i=n.pixelRatio,o=n.viewState.projection,a=this.getLayer(),s=a.getSource().getTile(t,e,r,i,o);return s.getState()==Ui&&(a.getUseInterimTilesOnError()?a.getPreload()>0&&(this.newTiles_=!0):s.setState(Zi)),this.isDrawableTile(s)||(s=s.getInterimTile()),s}},{key:"getData",value:function(t){var e=this.frameState;if(!e)return null;var r=this.getLayer(),n=Cr(e.pixelToCoordinateTransform,t.slice()),i=r.getExtent();if(i&&!_t(i,n))return null;for(var o=e.pixelRatio,a=e.viewState.projection,s=e.viewState,u=r.getRenderSource(),l=u.getTileGridForProjection(s.projection),c=u.getTilePixelRatio(e.pixelRatio),f=l.getZForResolution(s.resolution);f>=l.getMinZoom();--f){var h=l.getTileCoordForCoordAndZ(n,f),p=u.getTile(f,h[1],h[2],o,a);if(!(p instanceof kl||p instanceof Gl))return null;if(p.getState()===Zi){var y=l.getOrigin(f),d=No(l.getTileSize(f)),v=l.getResolution(f),g=Math.floor(c*((n[0]-y[0])/v-h[1]*d[0])),m=Math.floor(c*((y[1]-n[1])/v-h[2]*d[1])),b=Math.round(c*u.getGutterForProjection(s.projection));return this.getImageData(p.getImage(),g+b,m+b)}}return null}},{key:"loadedTileCallback",value:function(t,e,r){return!!this.isDrawableTile(r)&&Vl(Jl(o.prototype),"loadedTileCallback",this).call(this,t,e,r)}},{key:"prepareFrame",value:function(t){return!!this.getLayer().getSource()}},{key:"renderFrame",value:function(t,e){var r=t.layerStatesArray[t.layerIndex],n=t.viewState,i=n.projection,o=n.resolution,u=n.center,l=n.rotation,c=t.pixelRatio,f=this.getLayer(),h=f.getSource(),p=h.getRevision(),y=h.getTileGridForProjection(i),d=y.getZForResolution(o,h.zDirection),v=y.getResolution(d),g=t.extent,m=r.extent&&ce(r.extent,i);m&&(g=Wt(g,ce(r.extent,i)));var b=h.getTilePixelRatio(c),_=Math.round(t.size[0]*b),x=Math.round(t.size[1]*b);if(l){var w=Math.round(Math.sqrt(_*_+x*x));_=w,x=w}var k=v*_/2/b,S=v*x/2/b,O=[u[0]-k,u[1]-S,u[0]+k,u[1]+S],T=y.getTileRangeForExtentAndZ(g,d),C={};C[d]={};var P=this.createLoadedTileFinder(h,i,C),R=this.tmpExtent,j=this.tmpTileRange_;this.newTiles_=!1;for(var E=T.minX;E<=T.maxX;++E)for(var M=T.minY;M<=T.maxY;++M){var F=this.getTile(d,E,M,t);if(this.isDrawableTile(F)){var I=a(this);if(F.getState()==Zi){C[d][F.tileCoord.toString()]=F;var D=F.inTransition(I);this.newTiles_||!D&&-1!==this.renderedTiles.indexOf(F)||(this.newTiles_=!0)}if(1===F.getAlpha(I,t.time))continue}var z=y.getTileCoordChildTileRange(F.tileCoord,j,R),A=!1;z&&(A=P(d+1,z)),A||y.forEachTileCoordParentTileRange(F.tileCoord,P,j,R)}var L=v/o;Rr(this.pixelTransform,t.size[0]/2,t.size[1]/2,1/b,1/b,l,-_/2,-x/2);var G=Er(this.pixelTransform);this.useContainer(e,G,r.opacity,this.getBackground(t));var B=this.context,W=B.canvas;jr(this.inversePixelTransform,this.pixelTransform),Rr(this.tempTransform,_/2,x/2,L,L,0,-_/2,-x/2),W.width!=_||W.height!=x?(W.width=_,W.height=x):this.containerReused||B.clearRect(0,0,_,x),m&&this.clipUnrotated(B,t,m),h.getInterpolate()||s(B,Cl),this.preRender(B,t),this.renderedTiles.length=0;var X,Y,q,N=Object.keys(C).map(Number);N.sort(De),1!==r.opacity||this.containerReused&&!h.getOpaque(t.viewState.projection)?(X=[],Y=[]):N=N.reverse();for(var V=N.length-1;V>=0;--V){var Z=N[V],U=h.getTilePixelSize(Z,c,i),K=y.getResolution(Z)/v,H=U[0]*K*L,J=U[1]*K*L,$=y.getTileCoordForCoordAndZ(Xt(O),Z),Q=y.getTileCoordExtent($),tt=Cr(this.tempTransform,[b*(Q[0]-O[0])/v,b*(O[3]-Q[3])/v]),et=b*h.getGutterForProjection(i),rt=C[Z];for(var nt in rt){var it=rt[nt],ot=it.tileCoord,at=$[1]-ot[1],st=Math.round(tt[0]-(at-1)*H),ut=$[2]-ot[2],lt=Math.round(tt[1]-(ut-1)*J),ct=Math.round(tt[0]-at*H),ft=Math.round(tt[1]-ut*J),ht=st-ct,pt=lt-ft,yt=d===Z,dt=yt&&1!==it.getAlpha(a(this),t.time),vt=!1;if(!dt)if(X){q=[ct,ft,ct+ht,ft,ct+ht,ft+pt,ct,ft+pt];for(var gt=0,mt=X.length;gt<mt;++gt)if(d!==Z&&Z<Y[gt]){var bt=X[gt];Nt([ct,ft,ct+ht,ft+pt],[bt[0],bt[3],bt[4],bt[7]])&&(vt||(B.save(),vt=!0),B.beginPath(),B.moveTo(q[0],q[1]),B.lineTo(q[2],q[3]),B.lineTo(q[4],q[5]),B.lineTo(q[6],q[7]),B.moveTo(bt[6],bt[7]),B.lineTo(bt[4],bt[5]),B.lineTo(bt[2],bt[3]),B.lineTo(bt[0],bt[1]),B.clip())}X.push(q),Y.push(Z)}else B.clearRect(ct,ft,ht,pt);this.drawTileImage(it,t,ct,ft,ht,pt,et,yt),X&&!dt?(vt&&B.restore(),this.renderedTiles.unshift(it)):this.renderedTiles.push(it),this.updateUsedTiles(t.usedTiles,h,it)}}this.renderedRevision=p,this.renderedResolution=v,this.extentChanged=!this.renderedExtent_||!Rt(this.renderedExtent_,O),this.renderedExtent_=O,this.renderedPixelRatio=c,this.renderedProjection=i,this.manageTilePyramid(t,h,y,c,i,g,d,f.getPreload()),this.scheduleExpireCache(t,h),this.postRender(B,t),r.extent&&B.restore(),s(B,Pl),G!==W.style.transform&&(W.style.transform=G);var _t=function(t){return 1===t?"":String(Math.round(100*t)/100)}(r.opacity),xt=this.container;return _t!==xt.style.opacity&&(xt.style.opacity=_t),this.container}},{key:"drawTileImage",value:function(t,e,r,n,i,o,s,u){var l=this.getTileImage(t);if(l){var c=a(this),f=u?t.getAlpha(c,e.time):1,h=f!==this.context.globalAlpha;h&&(this.context.save(),this.context.globalAlpha=f),this.context.drawImage(l,s,s,l.width-2*s,l.height-2*s,r,n,i,o),h&&this.context.restore(),1!==f?e.animate=!0:u&&t.endTransition(c)}}},{key:"getImage",value:function(){var t=this.context;return t?t.canvas:null}},{key:"getTileImage",value:function(t){return t.getImage()}},{key:"scheduleExpireCache",value:function(t,e){if(e.canExpireCache()){var r=function(t,e,r){var n=a(t);n in r.usedTiles&&t.expireCache(r.viewState.projection,r.usedTiles[n])}.bind(null,e);t.postRenderFunctions.push(r)}}},{key:"updateUsedTiles",value:function(t,e,r){var n=a(e);n in t||(t[n]={}),t[n][r.getKey()]=!0}},{key:"manageTilePyramid",value:function(t,e,r,n,i,o,s,u,l){var c=a(e);c in t.wantedTiles||(t.wantedTiles[c]={});var f,h,p,y,d,v,g=t.wantedTiles[c],m=t.tileQueue,b=0;for(v=r.getMinZoom();v<=s;++v)for(h=r.getTileRangeForExtentAndZ(o,v,h),p=r.getResolution(v),y=h.minX;y<=h.maxX;++y)for(d=h.minY;d<=h.maxY;++d)s-v<=u?(++b,(f=e.getTile(v,y,d,n,i)).getState()==Ni&&(g[f.getKey()]=!0,m.isKeyQueued(f.getKey())||m.enqueue([f,c,r.getTileCoordCenter(f.tileCoord),p])),void 0!==l&&l(f)):e.useTile(v,y,d,i);e.updateCacheSize(b,i)}}])&&Nl(e.prototype,r),n&&Nl(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(sl),Ql="image",tc="hybrid",ec="vector",rc=0,nc=1;function ic(t){return(ic="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function oc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function ac(t,e){return(ac=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function sc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=lc(t);if(e){var i=lc(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return uc(this,r)}}function uc(t,e){if(e&&("object"===ic(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function lc(t){return(lc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var cc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ac(t,e)}(o,t);var e,r,n,i=sc(o);function o(t,e,r,n,a,s,u){var l;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(l=i.call(this)).context_=t,l.pixelRatio_=e,l.extent_=r,l.transform_=n,l.viewRotation_=a,l.squaredTolerance_=s,l.userTransform_=u,l.contextFillState_=null,l.contextStrokeState_=null,l.contextTextState_=null,l.fillState_=null,l.strokeState_=null,l.image_=null,l.imageAnchorX_=0,l.imageAnchorY_=0,l.imageHeight_=0,l.imageOpacity_=0,l.imageOriginX_=0,l.imageOriginY_=0,l.imageRotateWithView_=!1,l.imageRotation_=0,l.imageScale_=[0,0],l.imageWidth_=0,l.text_="",l.textOffsetX_=0,l.textOffsetY_=0,l.textRotateWithView_=!1,l.textRotation_=0,l.textScale_=[0,0],l.textFillState_=null,l.textStrokeState_=null,l.textState_=null,l.pixelCoordinates_=[],l.tmpLocalTransform_=[1,0,0,1,0,0],l}return e=o,(r=[{key:"drawImages_",value:function(t,e,r,n){if(this.image_){var i=Mr(t,e,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.tmpLocalTransform_,s=o.globalAlpha;1!=this.imageOpacity_&&(o.globalAlpha=s*this.imageOpacity_);var u=this.imageRotation_;this.imageRotateWithView_&&(u+=this.viewRotation_);for(var l=0,c=i.length;l<c;l+=2){var f=i[l]-this.imageAnchorX_,h=i[l+1]-this.imageAnchorY_;if(0!==u||1!=this.imageScale_[0]||1!=this.imageScale_[1]){var p=f+this.imageAnchorX_,y=h+this.imageAnchorY_;Rr(a,p,y,1,1,u,-p,-y),o.setTransform.apply(o,a),o.translate(p,y),o.scale(this.imageScale_[0],this.imageScale_[1]),o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),o.setTransform(1,0,0,1,0,0)}else o.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,f,h,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(o.globalAlpha=s)}}},{key:"drawText_",value:function(t,e,r,n){if(this.textState_&&""!==this.text_){this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);var i=Mr(t,e,r,n,this.transform_,this.pixelCoordinates_),o=this.context_,a=this.textRotation_;for(this.textRotateWithView_&&(a+=this.viewRotation_);e<r;e+=n){var s=i[e]+this.textOffsetX_,u=i[e+1]+this.textOffsetY_;if(0!==a||1!=this.textScale_[0]||1!=this.textScale_[1]){var l=Rr(this.tmpLocalTransform_,s,u,1,1,a,-s,-u);o.setTransform.apply(o,l),o.translate(s,u),o.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&o.strokeText(this.text_,0,0),this.textFillState_&&o.fillText(this.text_,0,0),o.setTransform(1,0,0,1,0,0)}else this.textStrokeState_&&o.strokeText(this.text_,s,u),this.textFillState_&&o.fillText(this.text_,s,u)}}}},{key:"moveToLineTo_",value:function(t,e,r,n,i){var o=this.context_,a=Mr(t,e,r,n,this.transform_,this.pixelCoordinates_);o.moveTo(a[0],a[1]);var s=a.length;i&&(s-=2);for(var u=2;u<s;u+=2)o.lineTo(a[u],a[u+1]);return i&&o.closePath(),r}},{key:"drawRings_",value:function(t,e,r,n){for(var i=0,o=r.length;i<o;++i)e=this.moveToLineTo_(t,e,r[i],n,!0);return e}},{key:"drawCircle",value:function(t){if(Nt(this.extent_,t.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=function(t,e,r){var n=t.getFlatCoordinates();if(n){var i=t.getStride();return Mr(n,0,n.length,i,e,r)}return null}(t,this.transform_,this.pixelCoordinates_),r=e[2]-e[0],n=e[3]-e[1],i=Math.sqrt(r*r+n*n),o=this.context_;o.beginPath(),o.arc(e[0],e[1],i,0,2*Math.PI),this.fillState_&&o.fill(),this.strokeState_&&o.stroke()}""!==this.text_&&this.drawText_(t.getCenter(),0,2,2)}}},{key:"setStyle",value:function(t){this.setFillStrokeStyle(t.getFill(),t.getStroke()),this.setImageStyle(t.getImage()),this.setTextStyle(t.getText())}},{key:"setTransform",value:function(t){this.transform_=t}},{key:"drawGeometry",value:function(t){switch(t.getType()){case we:this.drawPoint(t);break;case ke:this.drawLineString(t);break;case Oe:this.drawPolygon(t);break;case Te:this.drawMultiPoint(t);break;case Ce:this.drawMultiLineString(t);break;case Pe:this.drawMultiPolygon(t);break;case Re:this.drawGeometryCollection(t);break;case je:this.drawCircle(t)}}},{key:"drawFeature",value:function(t,e){var r=e.getGeometryFunction()(t);r&&Nt(this.extent_,r.getExtent())&&(this.setStyle(e),this.drawGeometry(r))}},{key:"drawGeometryCollection",value:function(t){for(var e=t.getGeometriesArray(),r=0,n=e.length;r<n;++r)this.drawGeometry(e[r])}},{key:"drawPoint",value:function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),""!==this.text_&&this.drawText_(e,0,e.length,r)}},{key:"drawMultiPoint",value:function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getFlatCoordinates(),r=t.getStride();this.image_&&this.drawImages_(e,0,e.length,r),""!==this.text_&&this.drawText_(e,0,e.length,r)}},{key:"drawLineString",value:function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Nt(this.extent_,t.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var e=this.context_,r=t.getFlatCoordinates();e.beginPath(),this.moveToLineTo_(r,0,r.length,t.getStride(),!1),e.stroke()}if(""!==this.text_){var n=t.getFlatMidpoint();this.drawText_(n,0,2,2)}}}},{key:"drawMultiLineString",value:function(t){this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_));var e=t.getExtent();if(Nt(this.extent_,e)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);var r=this.context_,n=t.getFlatCoordinates(),i=0,o=t.getEnds(),a=t.getStride();r.beginPath();for(var s=0,u=o.length;s<u;++s)i=this.moveToLineTo_(n,i,o[s],a,!1);r.stroke()}if(""!==this.text_){var l=t.getFlatMidpoints();this.drawText_(l,0,l.length,2)}}}},{key:"drawPolygon",value:function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Nt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_;e.beginPath(),this.drawRings_(t.getOrientedFlatCoordinates(),0,t.getEnds(),t.getStride()),this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var r=t.getFlatInteriorPoint();this.drawText_(r,0,2,2)}}}},{key:"drawMultiPolygon",value:function(t){if(this.squaredTolerance_&&(t=t.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),Nt(this.extent_,t.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);var e=this.context_,r=t.getOrientedFlatCoordinates(),n=0,i=t.getEndss(),o=t.getStride();e.beginPath();for(var a=0,s=i.length;a<s;++a){var u=i[a];n=this.drawRings_(r,n,u,o)}this.fillState_&&e.fill(),this.strokeState_&&e.stroke()}if(""!==this.text_){var l=t.getFlatInteriorPoints();this.drawText_(l,0,l.length,2)}}}},{key:"setContextFillState_",value:function(t){var e=this.context_,r=this.contextFillState_;r?r.fillStyle!=t.fillStyle&&(r.fillStyle=t.fillStyle,e.fillStyle=t.fillStyle):(e.fillStyle=t.fillStyle,this.contextFillState_={fillStyle:t.fillStyle})}},{key:"setContextStrokeState_",value:function(t){var e=this.context_,r=this.contextStrokeState_;r?(r.lineCap!=t.lineCap&&(r.lineCap=t.lineCap,e.lineCap=t.lineCap),e.setLineDash&&(Le(r.lineDash,t.lineDash)||e.setLineDash(r.lineDash=t.lineDash),r.lineDashOffset!=t.lineDashOffset&&(r.lineDashOffset=t.lineDashOffset,e.lineDashOffset=t.lineDashOffset)),r.lineJoin!=t.lineJoin&&(r.lineJoin=t.lineJoin,e.lineJoin=t.lineJoin),r.lineWidth!=t.lineWidth&&(r.lineWidth=t.lineWidth,e.lineWidth=t.lineWidth),r.miterLimit!=t.miterLimit&&(r.miterLimit=t.miterLimit,e.miterLimit=t.miterLimit),r.strokeStyle!=t.strokeStyle&&(r.strokeStyle=t.strokeStyle,e.strokeStyle=t.strokeStyle)):(e.lineCap=t.lineCap,e.setLineDash&&(e.setLineDash(t.lineDash),e.lineDashOffset=t.lineDashOffset),e.lineJoin=t.lineJoin,e.lineWidth=t.lineWidth,e.miterLimit=t.miterLimit,e.strokeStyle=t.strokeStyle,this.contextStrokeState_={lineCap:t.lineCap,lineDash:t.lineDash,lineDashOffset:t.lineDashOffset,lineJoin:t.lineJoin,lineWidth:t.lineWidth,miterLimit:t.miterLimit,strokeStyle:t.strokeStyle})}},{key:"setContextTextState_",value:function(t){var e=this.context_,r=this.contextTextState_,n=t.textAlign?t.textAlign:pa;r?(r.font!=t.font&&(r.font=t.font,e.font=t.font),r.textAlign!=n&&(r.textAlign=n,e.textAlign=n),r.textBaseline!=t.textBaseline&&(r.textBaseline=t.textBaseline,e.textBaseline=t.textBaseline)):(e.font=t.font,e.textAlign=n,e.textBaseline=t.textBaseline,this.contextTextState_={font:t.font,textAlign:n,textBaseline:t.textBaseline})}},{key:"setFillStrokeStyle",value:function(t,e){var r=this;if(t){var n=t.getColor();this.fillState_={fillStyle:ra(n||ua)}}else this.fillState_=null;if(e){var i=e.getColor(),o=e.getLineCap(),a=e.getLineDash(),s=e.getLineDashOffset(),u=e.getLineJoin(),l=e.getWidth(),c=e.getMiterLimit(),f=a||ca;this.strokeState_={lineCap:void 0!==o?o:la,lineDash:1===this.pixelRatio_?f:f.map((function(t){return t*r.pixelRatio_})),lineDashOffset:(s||0)*this.pixelRatio_,lineJoin:void 0!==u?u:fa,lineWidth:(void 0!==l?l:1)*this.pixelRatio_,miterLimit:void 0!==c?c:10,strokeStyle:ra(i||ha)}}else this.strokeState_=null}},{key:"setImageStyle",value:function(t){var e;if(t&&(e=t.getSize())){var r=t.getAnchor(),n=t.getOrigin();this.image_=t.getImage(this.pixelRatio_),this.imageAnchorX_=r[0]*this.pixelRatio_,this.imageAnchorY_=r[1]*this.pixelRatio_,this.imageHeight_=e[1]*this.pixelRatio_,this.imageOpacity_=t.getOpacity(),this.imageOriginX_=n[0],this.imageOriginY_=n[1],this.imageRotateWithView_=t.getRotateWithView(),this.imageRotation_=t.getRotation(),this.imageScale_=t.getScaleArray(),this.imageWidth_=e[0]*this.pixelRatio_}else this.image_=null}},{key:"setTextStyle",value:function(t){if(t){var e=t.getFill();if(e){var r=e.getColor();this.textFillState_={fillStyle:ra(r||ua)}}else this.textFillState_=null;var n=t.getStroke();if(n){var i=n.getColor(),o=n.getLineCap(),a=n.getLineDash(),s=n.getLineDashOffset(),u=n.getLineJoin(),l=n.getWidth(),c=n.getMiterLimit();this.textStrokeState_={lineCap:void 0!==o?o:la,lineDash:a||ca,lineDashOffset:s||0,lineJoin:void 0!==u?u:fa,lineWidth:void 0!==l?l:1,miterLimit:void 0!==c?c:10,strokeStyle:ra(i||ha)}}else this.textStrokeState_=null;var f=t.getFont(),h=t.getOffsetX(),p=t.getOffsetY(),y=t.getRotateWithView(),d=t.getRotation(),v=t.getScaleArray(),g=t.getText(),m=t.getTextAlign(),b=t.getTextBaseline();this.textState_={font:void 0!==f?f:sa,textAlign:void 0!==m?m:pa,textBaseline:void 0!==b?b:ya},this.text_=void 0!==g?Array.isArray(g)?g.reduce((function(t,e,r){return t+(r%2?" ":e)}),""):g:"",this.textOffsetX_=void 0!==h?this.pixelRatio_*h:0,this.textOffsetY_=void 0!==p?this.pixelRatio_*p:0,this.textRotateWithView_=void 0!==y&&y,this.textRotation_=void 0!==d?d:0,this.textScale_=[this.pixelRatio_*v[0],this.pixelRatio_*v[1]]}else this.text_=""}}])&&oc(e.prototype,r),n&&oc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(ys),fc="fraction",hc="pixels",pc="bottom-left",yc="bottom-right",dc="top-left",vc="top-right";function gc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var mc=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}var e,r,n;return e=t,(r=[{key:"clear",value:function(){this.cache_={},this.cacheSize_=0}},{key:"canExpireCache",value:function(){return this.cacheSize_>this.maxCacheSize_}},{key:"expire",value:function(){if(this.canExpireCache()){var t=0;for(var e in this.cache_){var r=this.cache_[e];0!=(3&t++)||r.hasListener()||(delete this.cache_[e],--this.cacheSize_)}}}},{key:"get",value:function(t,e,r){var n=bc(t,e,r);return n in this.cache_?this.cache_[n]:null}},{key:"set",value:function(t,e,r,n){var i=bc(t,e,r);this.cache_[i]=n,++this.cacheSize_}},{key:"setSize",value:function(t){this.maxCacheSize_=t,this.expire()}}])&&gc(e.prototype,r),n&&gc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function bc(t,e,r){return e+":"+t+":"+(r?Ho(r):"null")}var _c=new mc;function xc(t){return(xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function wc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function kc(t,e){return(kc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Sc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Tc(t);if(e){var i=Tc(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Oc(this,r)}}function Oc(t,e){if(e&&("object"===xc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Tc(t){return(Tc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Cc=null,Pc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kc(t,e)}(o,t);var e,r,n,i=Sc(o);function o(t,e,r,n,a,s){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(u=i.call(this)).hitDetectionImage_=null,u.image_=t||new Image,null!==n&&(u.image_.crossOrigin=n),u.canvas_={},u.color_=s,u.unlisten_=null,u.imageState_=a,u.size_=r,u.src_=e,u.tainted_,u}return e=o,(r=[{key:"isTainted_",value:function(){if(void 0===this.tainted_&&this.imageState_===Yo){Cc||(Cc=na(1,1)),Cc.drawImage(this.image_,0,0);try{Cc.getImageData(0,0,1,1),this.tainted_=!1}catch(t){Cc=null,this.tainted_=!0}}return!0===this.tainted_}},{key:"dispatchChangeEvent_",value:function(){this.dispatchEvent(Ze)}},{key:"handleImageError_",value:function(){this.imageState_=qo,this.unlistenImage_(),this.dispatchChangeEvent_()}},{key:"handleImageLoad_",value:function(){this.imageState_=Yo,this.size_?(this.image_.width=this.size_[0],this.image_.height=this.size_[1]):this.size_=[this.image_.width,this.image_.height],this.unlistenImage_(),this.dispatchChangeEvent_()}},{key:"getImage",value:function(t){return this.replaceColor_(t),this.canvas_[t]?this.canvas_[t]:this.image_}},{key:"getPixelRatio",value:function(t){return this.replaceColor_(t),this.canvas_[t]?t:1}},{key:"getImageState",value:function(){return this.imageState_}},{key:"getHitDetectionImage",value:function(){if(!this.hitDetectionImage_)if(this.isTainted_()){var t=this.size_[0],e=this.size_[1],r=na(t,e);r.fillRect(0,0,t,e),this.hitDetectionImage_=r.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}},{key:"getSize",value:function(){return this.size_}},{key:"getSrc",value:function(){return this.src_}},{key:"load",value:function(){if(this.imageState_==Wo){this.imageState_=Xo;try{this.image_.src=this.src_}catch(t){this.handleImageError_()}this.unlisten_=vl(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this))}}},{key:"replaceColor_",value:function(t){if(this.color_&&!this.canvas_[t]&&this.imageState_===Yo){var e=document.createElement("canvas");this.canvas_[t]=e,e.width=Math.ceil(this.image_.width*t),e.height=Math.ceil(this.image_.height*t);var r=e.getContext("2d");if(r.scale(t,t),r.drawImage(this.image_,0,0),r.globalCompositeOperation="multiply","multiply"===r.globalCompositeOperation||this.isTainted_())r.fillStyle=Ho(this.color_),r.fillRect(0,0,e.width/t,e.height/t),r.globalCompositeOperation="destination-in",r.drawImage(this.image_,0,0);else{for(var n=r.getImageData(0,0,e.width,e.height),i=n.data,o=this.color_[0]/255,a=this.color_[1]/255,s=this.color_[2]/255,u=this.color_[3],l=0,c=i.length;l<c;l+=4)i[l]*=o,i[l+1]*=a,i[l+2]*=s,i[l+3]*=u;r.putImageData(n,0,0)}}}},{key:"unlistenImage_",value:function(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}}])&&wc(e.prototype,r),n&&wc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Ve);function Rc(t){return(Rc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function jc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ec(t,e){return(Ec=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Mc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ic(t);if(e){var i=Ic(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Fc(this,r)}}function Fc(t,e){if(e&&("object"===Rc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ic(t){return(Ic=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Dc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ec(t,e)}(o,t);var e,r,n,i=Mc(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=t||{},n=void 0!==r.opacity?r.opacity:1,s=void 0!==r.rotation?r.rotation:0,u=void 0!==r.scale?r.scale:1,l=void 0!==r.rotateWithView&&r.rotateWithView;(e=i.call(this,{opacity:n,rotation:s,scale:u,displacement:void 0!==r.displacement?r.displacement:[0,0],rotateWithView:l,declutterMode:r.declutterMode})).anchor_=void 0!==r.anchor?r.anchor:[.5,.5],e.normalizedAnchor_=null,e.anchorOrigin_=void 0!==r.anchorOrigin?r.anchorOrigin:dc,e.anchorXUnits_=void 0!==r.anchorXUnits?r.anchorXUnits:fc,e.anchorYUnits_=void 0!==r.anchorYUnits?r.anchorYUnits:fc,e.crossOrigin_=void 0!==r.crossOrigin?r.crossOrigin:null;var c=void 0!==r.img?r.img:null;e.imgSize_=r.imgSize;var f=r.src;vt(!(void 0!==f&&c),4),vt(!c||c&&e.imgSize_,5),void 0!==f&&0!==f.length||!c||(f=c.src||a(c)),vt(void 0!==f&&f.length>0,6);var h=void 0!==r.src?Wo:Yo;return e.color_=void 0!==r.color?Qo(r.color):null,e.iconImage_=function(t,e,r,n,i,o){var a=_c.get(e,n,o);return a||(a=new Pc(t,e,r,n,i,o),_c.set(e,n,o,a)),a}(c,f,void 0!==e.imgSize_?e.imgSize_:null,e.crossOrigin_,h,e.color_),e.offset_=void 0!==r.offset?r.offset:[0,0],e.offsetOrigin_=void 0!==r.offsetOrigin?r.offsetOrigin:dc,e.origin_=null,e.size_=void 0!==r.size?r.size:null,e}return e=o,(r=[{key:"clone",value:function(){var t=this.getScale();return new o({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,imgSize:this.imgSize_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale:Array.isArray(t)?t.slice():t,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc()})}},{key:"getAnchor",value:function(){var t=this.normalizedAnchor_;if(!t){t=this.anchor_;var e=this.getSize();if(this.anchorXUnits_==fc||this.anchorYUnits_==fc){if(!e)return null;t=this.anchor_.slice(),this.anchorXUnits_==fc&&(t[0]*=e[0]),this.anchorYUnits_==fc&&(t[1]*=e[1])}if(this.anchorOrigin_!=dc){if(!e)return null;t===this.anchor_&&(t=this.anchor_.slice()),this.anchorOrigin_!=vc&&this.anchorOrigin_!=yc||(t[0]=-t[0]+e[0]),this.anchorOrigin_!=pc&&this.anchorOrigin_!=yc||(t[1]=-t[1]+e[1])}this.normalizedAnchor_=t}var r=this.getDisplacement();return[t[0]-r[0],t[1]+r[1]]}},{key:"setAnchor",value:function(t){this.anchor_=t,this.normalizedAnchor_=null}},{key:"getColor",value:function(){return this.color_}},{key:"getImage",value:function(t){return this.iconImage_.getImage(t)}},{key:"getPixelRatio",value:function(t){return this.iconImage_.getPixelRatio(t)}},{key:"getImageSize",value:function(){return this.iconImage_.getSize()}},{key:"getImageState",value:function(){return this.iconImage_.getImageState()}},{key:"getHitDetectionImage",value:function(){return this.iconImage_.getHitDetectionImage()}},{key:"getOrigin",value:function(){if(this.origin_)return this.origin_;var t=this.offset_;if(this.offsetOrigin_!=dc){var e=this.getSize(),r=this.iconImage_.getSize();if(!e||!r)return null;t=t.slice(),this.offsetOrigin_!=vc&&this.offsetOrigin_!=yc||(t[0]=r[0]-e[0]-t[0]),this.offsetOrigin_!=pc&&this.offsetOrigin_!=yc||(t[1]=r[1]-e[1]-t[1])}return this.origin_=t,this.origin_}},{key:"getSrc",value:function(){return this.iconImage_.getSrc()}},{key:"getSize",value:function(){return this.size_?this.size_:this.iconImage_.getSize()}},{key:"listenImageChange",value:function(t){this.iconImage_.addEventListener(Ze,t)}},{key:"load",value:function(){this.iconImage_.load()}},{key:"unlistenImageChange",value:function(t){this.iconImage_.removeEventListener(Ze,t)}}])&&jc(e.prototype,r),n&&jc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Zo),zc=.5;var Ac={Point:function(t,e,r,n,i){var o,a=r.getImage(),s=r.getText();if(a){if(a.getImageState()!=Yo)return;var u=t;if(i){var l=a.getDeclutterMode();if("none"!==l)if(u=i,"obstacle"===l){var c=t.getBuilder(r.getZIndex(),hu);c.setImageStyle(a,o),c.drawPoint(e,n)}else s&&s.getText()&&(o={})}var f=u.getBuilder(r.getZIndex(),hu);f.setImageStyle(a,o),f.drawPoint(e,n)}if(s&&s.getText()){var h=t;i&&(h=i);var p=h.getBuilder(r.getZIndex(),du);p.setTextStyle(s,o),p.drawText(e,n)}},LineString:function(t,e,r,n,i){var o=r.getStroke();if(o){var a=t.getBuilder(r.getZIndex(),pu);a.setFillStrokeStyle(null,o),a.drawLineString(e,n)}var s=r.getText();if(s&&s.getText()){var u=(i||t).getBuilder(r.getZIndex(),du);u.setTextStyle(s),u.drawText(e,n)}},Polygon:function(t,e,r,n,i){var o=r.getFill(),a=r.getStroke();if(o||a){var s=t.getBuilder(r.getZIndex(),yu);s.setFillStrokeStyle(o,a),s.drawPolygon(e,n)}var u=r.getText();if(u&&u.getText()){var l=(i||t).getBuilder(r.getZIndex(),du);l.setTextStyle(u),l.drawText(e,n)}},MultiPoint:function(t,e,r,n,i){var o,a=r.getImage(),s=r.getText();if(a){if(a.getImageState()!=Yo)return;var u=t;if(i){var l=a.getDeclutterMode();if("none"!==l)if(u=i,"obstacle"===l){var c=t.getBuilder(r.getZIndex(),hu);c.setImageStyle(a,o),c.drawMultiPoint(e,n)}else s&&s.getText()&&(o={})}var f=u.getBuilder(r.getZIndex(),hu);f.setImageStyle(a,o),f.drawMultiPoint(e,n)}if(s&&s.getText()){var h=t;i&&(h=i);var p=h.getBuilder(r.getZIndex(),du);p.setTextStyle(s,o),p.drawText(e,n)}},MultiLineString:function(t,e,r,n,i){var o=r.getStroke();if(o){var a=t.getBuilder(r.getZIndex(),pu);a.setFillStrokeStyle(null,o),a.drawMultiLineString(e,n)}var s=r.getText();if(s&&s.getText()){var u=(i||t).getBuilder(r.getZIndex(),du);u.setTextStyle(s),u.drawText(e,n)}},MultiPolygon:function(t,e,r,n,i){var o=r.getFill(),a=r.getStroke();if(a||o){var s=t.getBuilder(r.getZIndex(),yu);s.setFillStrokeStyle(o,a),s.drawMultiPolygon(e,n)}var u=r.getText();if(u&&u.getText()){var l=(i||t).getBuilder(r.getZIndex(),du);l.setTextStyle(u),l.drawText(e,n)}},GeometryCollection:function(t,e,r,n,i){var o,a,s=e.getGeometriesArray();for(o=0,a=s.length;o<a;++o){(0,Ac[s[o].getType()])(t,s[o],r,n,i)}},Circle:function(t,e,r,n,i){var o=r.getFill(),a=r.getStroke();if(o||a){var s=t.getBuilder(r.getZIndex(),cu);s.setFillStrokeStyle(o,a),s.drawCircle(e,n)}var u=r.getText();if(u&&u.getText()){var l=(i||t).getBuilder(r.getZIndex(),du);l.setTextStyle(u),l.drawText(e,n)}}};function Lc(t,e){var r=function(t,e){return.5*t/e}(t,e);return r*r}function Gc(t,e,r,n,i,o,a){var s=!1,u=r.getImage();if(u){var l=u.getImageState();l==Yo||l==qo?u.unlistenImageChange(i):(l==Wo&&u.load(),u.listenImageChange(i),s=!0)}return function(t,e,r,n,i,o){var a=r.getGeometryFunction()(e);if(!a)return;var s=a.simplifyTransformed(n,i);if(r.getRenderer())Bc(t,s,r,e);else{(0,Ac[s.getType()])(t,s,r,e,o)}}(t,e,r,n,o,a),s}function Bc(t,e,r,n){if(e.getType()!=Re)t.getBuilder(r.getZIndex(),fu).drawCustom(e,n,r.getRenderer(),r.getHitDetectionRenderer());else for(var i=e.getGeometries(),o=0,a=i.length;o<a;++o)Bc(t,i[o],r,n)}function Wc(t,e){if(e.canWrapX()){var r=qt(e.getExtent()),n=function(t,e,r){var n=e.getExtent(),i=0;if(e.canWrapX()&&(t[0]<n[0]||t[0]>n[2])){var o=r||qt(n);i=Math.floor((t[0]-n[0])/o)}return i}(t,e,r);n&&(t[0]-=n*r)}return t}function Xc(t){return(Xc="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Yc(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function qc(){return(qc="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Nc(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Nc(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Hc(t)););return t}function Vc(t,e){return(Vc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Zc(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Hc(t);if(e){var i=Hc(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Uc(this,r)}}function Uc(t,e){if(e&&("object"===Xc(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Kc(t)}function Kc(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Hc(t){return(Hc=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Jc={image:[yu,cu,pu,hu,du],hybrid:[yu,pu],vector:[]},$c={hybrid:[hu,du,fu],vector:[yu,cu,pu,hu,du,fu]},Qc=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Vc(t,e)}(o,t);var e,r,n,i=Zc(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,t)).boundHandleStyleImageChange_=e.handleStyleImageChange_.bind(Kc(e)),e.renderedLayerRevision_,e.renderedPixelToCoordinateTransform_=null,e.renderedRotation_,e.tmpTransform_=[1,0,0,1,0,0],e}return e=o,(r=[{key:"prepareTile",value:function(t,e,r){var n,i=t.getState();return i!==Zi&&i!==Ui||(this.updateExecutorGroup_(t,e,r),this.tileImageNeedsRender_(t)&&(n=!0)),n}},{key:"getTile",value:function(t,e,r,n){var i=n.pixelRatio,a=n.viewState,s=a.resolution,u=a.projection,l=this.getLayer(),c=l.getSource().getTile(t,e,r,i,u),f=n.viewHints,h=!(f[rc]||f[nc]);return!h&&c.wantedResolution||(c.wantedResolution=s),this.prepareTile(c,i,u)&&(h||Date.now()-n.time<8)&&l.getRenderMode()!==ec&&this.renderTileImage_(c,n),qc(Hc(o.prototype),"getTile",this).call(this,t,e,r,n)}},{key:"isDrawableTile",value:function(t){var e=this.getLayer();return qc(Hc(o.prototype),"isDrawableTile",this).call(this,t)&&(e.getRenderMode()===ec?a(e)in t.executorGroups:t.hasContext(e))}},{key:"getTileImage",value:function(t){return t.getImage(this.getLayer())}},{key:"prepareFrame",value:function(t){var e=this.getLayer().getRevision();return this.renderedLayerRevision_!==e&&(this.renderedLayerRevision_=e,this.renderedTiles.length=0),qc(Hc(o.prototype),"prepareFrame",this).call(this,t)}},{key:"updateExecutorGroup_",value:function(t,e,r){var n=this,i=this.getLayer(),o=i.getRevision(),s=i.getRenderOrder()||null,u=t.wantedResolution,l=t.getReplayState(i);if(l.dirty||l.renderedResolution!==u||l.renderedRevision!=o||l.renderedRenderOrder!=s){var c=i.getSource(),f=i.getDeclutter(),h=c.getTileGrid(),p=c.getTileGridForProjection(r).getTileCoordExtent(t.wrappedTileCoord),y=c.getSourceTiles(e,r,t),d=a(i);delete t.hitDetectionImageData[d],t.executorGroups[d]=[],f&&(t.declutterExecutorGroups[d]=[]),l.dirty=!1;for(var v=function(r,o){var a=y[r];if(a.getState()!=Zi)return"continue";var v=a.tileCoord,g=h.getTileCoordExtent(v),m=Wt(p,g),b=mt(m,i.getRenderBuffer()*u,n.tmpExtent),_=Rt(g,m)?null:b,x=new lu(0,b,u,e),w=f?new lu(0,m,u,e):void 0,k=Lc(u,e),S=function(t){var e,r=t.getStyleFunction()||i.getStyleFunction();if(r&&(e=r(t,u)),e){var n=this.renderFeature(t,k,e,x,w);l.dirty=l.dirty||n}},O=a.getFeatures();s&&s!==l.renderedRenderOrder&&O.sort(s);for(var T=0,C=O.length;T<C;++T){var P=O[T];_&&!Nt(_,P.getGeometry().getExtent())||S.call(n,P)}var R=x.finish(),j=i.getRenderMode()!==ec&&f&&1===y.length?null:m,E=new Iu(j,u,e,c.getOverlaps(),R,i.getRenderBuffer());if(t.executorGroups[d].push(E),w){var M=new Iu(null,u,e,c.getOverlaps(),w.finish(),i.getRenderBuffer());t.declutterExecutorGroups[d].push(M)}},g=0,m=y.length;g<m;++g)v(g);l.renderedRevision=o,l.renderedRenderOrder=s,l.renderedResolution=u}}},{key:"forEachFeatureAtCoordinate",value:function(t,e,r,n,i){var o=e.viewState.resolution,s=e.viewState.rotation;r=null==r?0:r;var u=this.getLayer(),l=u.getSource().getTileGridForProjection(e.viewState.projection),c=gt([t]);mt(c,o*r,c);for(var f,h={},p=function(t,e,r){var o=t.getId();void 0===o&&(o=a(t));var s=h[o];if(s){if(!0!==s&&r<s.distanceSq){if(0===r)return h[o]=!0,i.splice(i.lastIndexOf(s),1),n(t,u,e);s.geometry=e,s.distanceSq=r}}else{if(0===r)return h[o]=!0,n(t,u,e);i.push(h[o]={feature:t,layer:u,geometry:e,distanceSq:r,callback:n})}},y=this.renderedTiles,d=function(n,i){var h=y[n];if(!Nt(l.getTileCoordExtent(h.wrappedTileCoord),c))return"continue";var d=a(u),v=[h.executorGroups[d]],g=h.declutterExecutorGroups[d];g&&v.push(g),v.some((function(n){for(var i=n===g?e.declutterTree.all().map((function(t){return t.value})):null,a=0,u=n.length;a<u;++a){var l=n[a];if(f=l.forEachFeatureAtCoordinate(t,o,s,r,p,i))return!0}}))},v=0,g=y.length;!f&&v<g;++v)d(v);return f}},{key:"getFeatures",value:function(t){return new Promise(function(e,r){for(var n,i=this.getLayer(),o=a(i),s=i.getSource(),u=this.renderedProjection,l=u.getExtent(),c=this.renderedResolution,f=s.getTileGridForProjection(u),p=Cr(this.renderedPixelToCoordinateTransform_,t.slice()),y=f.getTileCoordForCoordAndResolution(p,c),d=0,v=this.renderedTiles.length;d<v;++d)if(y.toString()===this.renderedTiles[d].tileCoord.toString()){if((n=this.renderedTiles[d]).getState()===Zi){var g=f.getTileCoordExtent(n.tileCoord);s.getWrapX()&&u.canWrapX()&&!xt(l,g)&&Wc(p,u);break}n=void 0}if(!n||n.loadingSourceTiles>0)e([]);else{var m=Xt(f.getTileCoordExtent(n.wrappedTileCoord)),b=[(p[0]-m[0])/c,(m[1]-p[1])/c],_=n.getSourceTiles().reduce((function(t,e){return t.concat(e.getFeatures())}),[]),x=n.hitDetectionImageData[o];if(!x&&!this.animatingOrInteracting_){var w=No(f.getTileSize(f.getZForResolution(c))),k=this.renderedRotation_;x=function(t,e,r,n,i,o,a){var s=na(t[0]*zc,t[1]*zc);s.imageSmoothingEnabled=!1;for(var u=s.canvas,l=new cc(s,zc,i,null,a),c=r.length,f=Math.floor(16777215/c),h={},p=1;p<=c;++p){var y=r[p-1],d=y.getStyleFunction()||n;if(n){var v=d(y,o);if(v){Array.isArray(v)||(v=[v]);for(var g="#"+("000000"+(p*f).toString(16)).slice(-6),m=0,b=v.length;m<b;++m){var _=v[m],x=_.getGeometryFunction()(y);if(x&&Nt(i,x.getExtent())){var w=_.clone(),k=w.getFill();k&&k.setColor(g);var S=w.getStroke();S&&(S.setColor(g),S.setLineDash(null)),w.setText(void 0);var O=_.getImage();if(O&&0!==O.getOpacity()){var T=O.getImageSize();if(!T)continue;var C=na(T[0],T[1],void 0,{alpha:!1}),P=C.canvas;C.fillStyle=g,C.fillRect(0,0,P.width,P.height),w.setImage(new Dc({img:P,imgSize:T,anchor:O.getAnchor(),anchorXUnits:hc,anchorYUnits:hc,offset:O.getOrigin(),opacity:1,size:O.getSize(),scale:O.getScale(),rotation:O.getRotation(),rotateWithView:O.getRotateWithView()}))}var R=w.getZIndex()||0,j=h[R];j||(j={},h[R]=j,j[Oe]=[],j[je]=[],j[ke]=[],j[we]=[]),j[x.getType().replace("Multi","")].push(x,w)}}}}}for(var E=Object.keys(h).map(Number).sort(De),M=0,F=E.length;M<F;++M){var I=h[E[M]];for(var D in I)for(var z=I[D],A=0,L=z.length;A<L;A+=2){l.setStyle(z[A+1]);for(var G=0,B=e.length;G<B;++G)l.setTransform(e[G]),l.drawGeometry(z[A])}}return s.getImageData(0,0,u.width,u.height)}(w,[this.getRenderTransform(f.getTileCoordCenter(n.wrappedTileCoord),c,0,zc,w[0]*zc,w[1]*zc,0)],_,i.getStyleFunction(),f.getTileCoordExtent(n.wrappedTileCoord),n.getReplayState(i).renderedResolution,k),n.hitDetectionImageData[o]=x}e(function(t,e,r){var n=[];if(r){var i=Math.floor(Math.round(t[0])*zc),o=Math.floor(Math.round(t[1])*zc),a=4*(h(i,0,r.width-1)+h(o,0,r.height-1)*r.width),s=r.data[a],u=r.data[a+1],l=r.data[a+2]+256*(u+256*s),c=Math.floor(16777215/e.length);l&&l%c==0&&n.push(e[l/c-1])}return n}(b,_,x))}}.bind(this))}},{key:"handleFontsChanged",value:function(){var t=this.getLayer();t.getVisible()&&void 0!==this.renderedLayerRevision_&&t.changed()}},{key:"handleStyleImageChange_",value:function(t){this.renderIfReadyAndVisible()}},{key:"renderDeclutter",value:function(t){var e=this.context,r=e.globalAlpha;e.globalAlpha=this.getLayer().getOpacity();for(var n=t.viewHints,i=!(n[rc]||n[nc]),o=this.renderedTiles,s=0,u=o.length;s<u;++s){var l=o[s],c=l.declutterExecutorGroups[a(this.getLayer())];if(c)for(var f=c.length-1;f>=0;--f)c[f].execute(this.context,1,this.getTileRenderTransform(l,t),t.viewState.rotation,i,void 0,t.declutterTree)}e.globalAlpha=r}},{key:"getTileRenderTransform",value:function(t,e){var r=e.pixelRatio,n=e.viewState,i=n.center,o=n.resolution,a=n.rotation,s=e.size,u=Math.round(s[0]*r),l=Math.round(s[1]*r),c=this.getLayer().getSource().getTileGridForProjection(e.viewState.projection),f=t.tileCoord,h=c.getTileCoordExtent(t.wrappedTileCoord),p=c.getTileCoordExtent(f,this.tmpExtent)[0]-h[0];return Or(Pr(this.inversePixelTransform.slice(),1/r,1/r),this.getRenderTransform(i,o,a,r,u,l,p))}},{key:"renderFrame",value:function(t,e){var r=t.viewHints,n=!(r[rc]||r[nc]);qc(Hc(o.prototype),"renderFrame",this).call(this,t,e),this.renderedPixelToCoordinateTransform_=t.pixelToCoordinateTransform.slice(),this.renderedRotation_=t.viewState.rotation;var i=this.getLayer(),s=i.getRenderMode(),u=this.context,l=u.globalAlpha;u.globalAlpha=i.getOpacity();for(var c=$c[s],f=t.viewState,h=f.rotation,p=i.getSource(),y=p.getTileGridForProjection(f.projection).getZForResolution(f.resolution,p.zDirection),d=this.renderedTiles,v=[],g=[],m=!0,b=d.length-1;b>=0;--b){var _=d[b];m=m&&!_.getReplayState(i).dirty;var x=_.executorGroups[a(i)].filter((function(t){return t.hasExecutors(c)}));if(0!==x.length){var w=this.getTileRenderTransform(_,t),k=_.tileCoord[0],S=!1,O=x[0].getClipCoords(w);if(O){for(var T=0,C=v.length;T<C;++T)if(y!==k&&k<g[T]){var P=v[T];Nt([O[0],O[3],O[4],O[7]],[P[0],P[3],P[4],P[7]])&&(S||(u.save(),S=!0),u.beginPath(),u.moveTo(O[0],O[1]),u.lineTo(O[2],O[3]),u.lineTo(O[4],O[5]),u.lineTo(O[6],O[7]),u.moveTo(P[6],P[7]),u.lineTo(P[4],P[5]),u.lineTo(P[2],P[3]),u.lineTo(P[0],P[1]),u.clip())}v.push(O),g.push(k)}for(var R=0,j=x.length;R<j;++R)x[R].execute(u,1,w,h,n,c);S&&u.restore()}}return u.globalAlpha=l,this.ready=m,this.container}},{key:"renderFeature",value:function(t,e,r,n,i){if(!r)return!1;var o=!1;if(Array.isArray(r))for(var a=0,s=r.length;a<s;++a)o=Gc(n,t,r[a],e,this.boundHandleStyleImageChange_,void 0,i)||o;else o=Gc(n,t,r,e,this.boundHandleStyleImageChange_,void 0,i);return o}},{key:"tileImageNeedsRender_",value:function(t){var e=this.getLayer();if(e.getRenderMode()===ec)return!1;var r=t.getReplayState(e),n=e.getRevision(),i=t.wantedResolution;return r.renderedTileResolution!==i||r.renderedTileRevision!==n}},{key:"renderTileImage_",value:function(t,e){var r=this.getLayer(),n=t.getReplayState(r),i=r.getRevision(),o=t.executorGroups[a(r)];n.renderedTileRevision=i;var s=t.wrappedTileCoord,u=s[0],l=r.getSource(),c=e.pixelRatio,f=e.viewState.projection,h=l.getTileGridForProjection(f),p=h.getResolution(t.tileCoord[0]),y=e.pixelRatio/t.wantedResolution*p,d=h.getResolution(u),v=t.getContext(r);c=Math.round(Math.max(c,y/c));var g=l.getTilePixelSize(u,c,f);v.canvas.width=g[0],v.canvas.height=g[1];var m=c/y;if(1!==m){var b=Sr(this.tmpTransform_);Pr(b,m,m),v.setTransform.apply(v,b)}var _=h.getTileCoordExtent(s,this.tmpExtent),x=y/d,w=Sr(this.tmpTransform_);Pr(w,x,-x),function(t,e,r){Or(t,Tr(kr,1,0,0,1,e,r))}(w,-_[0],-_[3]);for(var k=0,S=o.length;k<S;++k)o[k].execute(v,m,w,0,!0,Jc[r.getRenderMode()]);n.renderedTileResolution=t.wantedResolution}}])&&Yc(e.prototype,r),n&&Yc(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}($l),tf="preload",ef="useInterimTilesOnError";function rf(t){return(rf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function nf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function of(){return(of="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=af(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function af(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=cf(t)););return t}function sf(t,e){return(sf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function uf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=cf(t);if(e){var i=cf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return lf(this,r)}}function lf(t,e){if(e&&("object"===rf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function cf(t){return(cf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var ff=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&sf(t,e)}(o,t);var e,r,n,i=uf(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=t||{},n=s({},r);delete n.preload,delete n.useInterimTilesOnError,(e=i.call(this,n)).on,e.once,e.un,r.renderMode===Ql&&(console.warn('renderMode: "image" is deprecated. Option ignored.'),r.renderMode=void 0);var a=r.renderMode||tc;return vt(a==tc||a==ec,28),e.renderMode_=a,e.setPreload(r.preload?r.preload:0),e.setUseInterimTilesOnError(void 0===r.useInterimTilesOnError||r.useInterimTilesOnError),e.getBackground,e.setBackground,e}return e=o,(r=[{key:"createRenderer",value:function(){return new Qc(this)}},{key:"getFeatures",value:function(t){return of(cf(o.prototype),"getFeatures",this).call(this,t)}},{key:"getRenderMode",value:function(){return this.renderMode_}},{key:"getPreload",value:function(){return this.get(tf)}},{key:"getUseInterimTilesOnError",value:function(){return this.get(ef)}},{key:"setPreload",value:function(t){this.set(tf,t)}},{key:"setUseInterimTilesOnError",value:function(t){this.set(ef,t)}}])&&nf(e.prototype,r),n&&nf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(as);function hf(t){return(hf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function pf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yf(t,e){return(yf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function df(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=gf(t);if(e){var i=gf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return vf(this,r)}}function vf(t,e){if(e&&("object"===hf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gf(t){return(gf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var mf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yf(t,e)}(o,t);var e,r,n,i=df(o);function o(t,e,r,n,a,s){var u;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(u=i.call(this,t,e,s)).extent=null,u.format_=n,u.features_=null,u.loader_,u.projection=null,u.resolution,u.tileLoadFunction_=a,u.url_=r,u.key=r,u}return e=o,(r=[{key:"getFormat",value:function(){return this.format_}},{key:"getFeatures",value:function(){return this.features_}},{key:"load",value:function(){this.state==Ni&&(this.setState(Vi),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}},{key:"onLoad",value:function(t,e){this.setFeatures(t)}},{key:"onError",value:function(){this.setState(Ui)}},{key:"setFeatures",value:function(t){this.features_=t,this.setState(Zi)}},{key:"setLoader",value:function(t){this.loader_=t}}])&&pf(e.prototype,r),n&&pf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(dl);function bf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _f(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null==r)return;var n,i,o=[],a=!0,s=!1;try{for(r=r.call(t);!(a=(n=r.next()).done)&&(o.push(n.value),!e||o.length!==e);a=!0);}catch(t){s=!0,i=t}finally{try{a||null==r.return||r.return()}finally{if(s)throw i}}return o}(t,e)||function(t,e){if(!t)return;if("string"==typeof t)return xf(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);"Object"===r&&t.constructor&&(r=t.constructor.name);if("Map"===r||"Set"===r)return Array.from(t);if("Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r))return xf(t,e)}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xf(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function wf(t,e,r,n){return void 0!==n?(n[0]=t,n[1]=e,n[2]=r,n):[t,e,r]}function kf(t,e,r){return t+"/"+e+"/"+r}function Sf(t){return t.split("/").map(Number)}function Of(t){return(Of="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Tf(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Cf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Pf(t,e){return(Pf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Rf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ef(t);if(e){var i=Ef(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return jf(this,r)}}function jf(t,e){if(e&&("object"===Of(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Ef(t){return(Ef=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Mf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pf(t,e)}(o,t);var e,r,n,i=Rf(o);function o(){return Tf(this,o),i.apply(this,arguments)}return e=o,(r=[{key:"expireCache",value:function(t){for(;this.canExpireCache()&&!(this.peekLast().getKey()in t);)this.pop().release()}},{key:"pruneExceptNewestZ",value:function(){if(0!==this.getCount()){var t=Sf(this.peekFirstKey())[0];this.forEach(function(e){e.tileCoord[0]!==t&&(this.remove(function(t){return kf(t[0],t[1],t[2])}(e.tileCoord)),e.release())}.bind(this))}}}])&&Cf(e.prototype,r),n&&Cf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.highWaterMark=void 0!==e?e:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}var e,r,n;return e=t,(r=[{key:"canExpireCache",value:function(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}},{key:"expireCache",value:function(t){for(;this.canExpireCache();)this.pop()}},{key:"clear",value:function(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}},{key:"containsKey",value:function(t){return this.entries_.hasOwnProperty(t)}},{key:"forEach",value:function(t){for(var e=this.oldest_;e;)t(e.value_,e.key_,this),e=e.newer}},{key:"get",value:function(t,e){var r=this.entries_[t];return vt(void 0!==r,15),r===this.newest_||(r===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(r.newer.older=r.older,r.older.newer=r.newer),r.newer=null,r.older=this.newest_,this.newest_.newer=r,this.newest_=r),r.value_}},{key:"remove",value:function(t){var e=this.entries_[t];return vt(void 0!==e,15),e===this.newest_?(this.newest_=e.older,this.newest_&&(this.newest_.newer=null)):e===this.oldest_?(this.oldest_=e.newer,this.oldest_&&(this.oldest_.older=null)):(e.newer.older=e.older,e.older.newer=e.newer),delete this.entries_[t],--this.count_,e.value_}},{key:"getCount",value:function(){return this.count_}},{key:"getKeys",value:function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.key_;return e}},{key:"getValues",value:function(){var t,e=new Array(this.count_),r=0;for(t=this.newest_;t;t=t.older)e[r++]=t.value_;return e}},{key:"peekLast",value:function(){return this.oldest_.value_}},{key:"peekLastKey",value:function(){return this.oldest_.key_}},{key:"peekFirstKey",value:function(){return this.newest_.key_}},{key:"pop",value:function(){var t=this.oldest_;return delete this.entries_[t.key_],t.newer&&(t.newer.older=null),this.oldest_=t.newer,this.oldest_||(this.newest_=null),--this.count_,t.value_}},{key:"replace",value:function(t,e){this.get(t),this.entries_[t].value_=e}},{key:"set",value:function(t,e){vt(!(t in this.entries_),16);var r={key_:t,newer:null,older:this.newest_,value_:e};this.newest_?this.newest_.newer=r:this.oldest_=r,this.newest_=r,this.entries_[t]=r,++this.count_}},{key:"setSize",value:function(t){this.highWaterMark=t}}])&&bf(e.prototype,r),n&&bf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}()),Ff="tileloadstart",If="tileloadend",Df="tileloaderror";function zf(t){return(zf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Af(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Lf(t,e){return(Lf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Gf(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Xf(t);if(e){var i=Xf(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Bf(this,r)}}function Bf(t,e){if(e&&("object"===zf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Wf(t)}function Wf(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Xf(t){return(Xf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function Yf(t){return t?Array.isArray(t)?function(e){return t}:"function"==typeof t?t:function(e){return[t]}:null}var qf=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Lf(t,e)}(a,t);var e,r,n,o=Gf(a);function a(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),(e=o.call(this)).projection=$t(t.projection),e.attributions_=Yf(t.attributions),e.attributionsCollapsible_=void 0===t.attributionsCollapsible||t.attributionsCollapsible,e.loading=!1,e.state_=void 0!==t.state?t.state:Ro,e.wrapX_=void 0!==t.wrapX&&t.wrapX,e.interpolate_=!!t.interpolate,e.viewResolver=null,e.viewRejector=null;var r=Wf(e);return e.viewPromise_=new Promise((function(t,e){r.viewResolver=t,r.viewRejector=e})),e}return e=a,(r=[{key:"getAttributions",value:function(){return this.attributions_}},{key:"getAttributionsCollapsible",value:function(){return this.attributionsCollapsible_}},{key:"getProjection",value:function(){return this.projection}},{key:"getResolutions",value:function(){return i()}},{key:"getView",value:function(){return this.viewPromise_}},{key:"getState",value:function(){return this.state_}},{key:"getWrapX",value:function(){return this.wrapX_}},{key:"getInterpolate",value:function(){return this.interpolate_}},{key:"refresh",value:function(){this.changed()}},{key:"setAttributions",value:function(t){this.attributions_=Yf(t),this.changed()}},{key:"setState",value:function(t){this.state_=t,this.changed()}}])&&Af(e.prototype,r),n&&Af(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(br);function Nf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var Vf=[0,0,0],Zf=function(){function t(e){var r;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.minZoom=void 0!==e.minZoom?e.minZoom:0,this.resolutions_=e.resolutions,vt(function(t,e,r){var n=e||De;return t.every((function(e,i){if(0===i)return!0;var o=n(t[i-1],e);return!(o>0||r&&0===o)}))}(this.resolutions_,(function(t,e){return e-t}),!0),17),!e.origins)for(var n=0,i=this.resolutions_.length-1;n<i;++n)if(r){if(this.resolutions_[n]/this.resolutions_[n+1]!==r){r=void 0;break}}else r=this.resolutions_[n]/this.resolutions_[n+1];this.zoomFactor_=r,this.maxZoom=this.resolutions_.length-1,this.origin_=void 0!==e.origin?e.origin:null,this.origins_=null,void 0!==e.origins&&(this.origins_=e.origins,vt(this.origins_.length==this.resolutions_.length,20));var o=e.extent;void 0===o||this.origin_||this.origins_||(this.origin_=Xt(o)),vt(!this.origin_&&this.origins_||this.origin_&&!this.origins_,18),this.tileSizes_=null,void 0!==e.tileSizes&&(this.tileSizes_=e.tileSizes,vt(this.tileSizes_.length==this.resolutions_.length,19)),this.tileSize_=void 0!==e.tileSize?e.tileSize:this.tileSizes_?null:256,vt(!this.tileSize_&&this.tileSizes_||this.tileSize_&&!this.tileSizes_,22),this.extent_=void 0!==o?o:null,this.fullTileRanges_=null,this.tmpSize_=[0,0],this.tmpExtent_=[0,0,0,0],void 0!==e.sizes?this.fullTileRanges_=e.sizes.map((function(t,e){var r=new Yl(Math.min(0,t[0]),Math.max(t[0]-1,-1),Math.min(0,t[1]),Math.max(t[1]-1,-1));if(o){var n=this.getTileRangeForExtentAndZ(o,e);r.minX=Math.max(n.minX,r.minX),r.maxX=Math.min(n.maxX,r.maxX),r.minY=Math.max(n.minY,r.minY),r.maxY=Math.min(n.maxY,r.maxY)}return r}),this):o&&this.calculateTileRanges_(o)}var e,r,n;return e=t,(r=[{key:"forEachTileCoord",value:function(t,e,r){for(var n=this.getTileRangeForExtentAndZ(t,e),i=n.minX,o=n.maxX;i<=o;++i)for(var a=n.minY,s=n.maxY;a<=s;++a)r([e,i,a])}},{key:"forEachTileCoordParentTileRange",value:function(t,e,r,n){var i,o,a=null,s=t[0]-1;for(2===this.zoomFactor_?(i=t[1],o=t[2]):a=this.getTileCoordExtent(t,n);s>=this.minZoom;){if(e(s,2===this.zoomFactor_?Xl(i=Math.floor(i/2),i,o=Math.floor(o/2),o,r):this.getTileRangeForExtentAndZ(a,s,r)))return!0;--s}return!1}},{key:"getExtent",value:function(){return this.extent_}},{key:"getMaxZoom",value:function(){return this.maxZoom}},{key:"getMinZoom",value:function(){return this.minZoom}},{key:"getOrigin",value:function(t){return this.origin_?this.origin_:this.origins_[t]}},{key:"getResolution",value:function(t){return this.resolutions_[t]}},{key:"getResolutions",value:function(){return this.resolutions_}},{key:"getTileCoordChildTileRange",value:function(t,e,r){if(t[0]<this.maxZoom){if(2===this.zoomFactor_){var n=2*t[1],i=2*t[2];return Xl(n,n+1,i,i+1,e)}var o=this.getTileCoordExtent(t,r||this.tmpExtent_);return this.getTileRangeForExtentAndZ(o,t[0]+1,e)}return null}},{key:"getTileRangeForTileCoordAndZ",value:function(t,e,r){if(e>this.maxZoom||e<this.minZoom)return null;var n=t[0],i=t[1],o=t[2];if(e===n)return Xl(i,o,i,o,r);if(this.zoomFactor_){var a=Math.pow(this.zoomFactor_,e-n),s=Math.floor(i*a),u=Math.floor(o*a);return e<n?Xl(s,s,u,u,r):Xl(s,Math.floor(a*(i+1))-1,u,Math.floor(a*(o+1))-1,r)}var l=this.getTileCoordExtent(t,this.tmpExtent_);return this.getTileRangeForExtentAndZ(l,e,r)}},{key:"getTileRangeExtent",value:function(t,e,r){var n=this.getOrigin(t),i=this.getResolution(t),o=No(this.getTileSize(t),this.tmpSize_),a=n[0]+e.minX*o[0]*i,s=n[0]+(e.maxX+1)*o[0]*i;return Ot(a,n[1]+e.minY*o[1]*i,s,n[1]+(e.maxY+1)*o[1]*i,r)}},{key:"getTileRangeForExtentAndZ",value:function(t,e,r){var n=Vf;this.getTileCoordForXYAndZ_(t[0],t[3],e,!1,n);var i=n[1],o=n[2];return this.getTileCoordForXYAndZ_(t[2],t[1],e,!0,n),Xl(i,n[1],o,n[2],r)}},{key:"getTileCoordCenter",value:function(t){var e=this.getOrigin(t[0]),r=this.getResolution(t[0]),n=No(this.getTileSize(t[0]),this.tmpSize_);return[e[0]+(t[1]+.5)*n[0]*r,e[1]-(t[2]+.5)*n[1]*r]}},{key:"getTileCoordExtent",value:function(t,e){var r=this.getOrigin(t[0]),n=this.getResolution(t[0]),i=No(this.getTileSize(t[0]),this.tmpSize_),o=r[0]+t[1]*i[0]*n,a=r[1]-(t[2]+1)*i[1]*n;return Ot(o,a,o+i[0]*n,a+i[1]*n,e)}},{key:"getTileCoordForCoordAndResolution",value:function(t,e,r){return this.getTileCoordForXYAndResolution_(t[0],t[1],e,!1,r)}},{key:"getTileCoordForXYAndResolution_",value:function(t,e,r,n,i){var o=this.getZForResolution(r),a=r/this.getResolution(o),s=this.getOrigin(o),u=No(this.getTileSize(o),this.tmpSize_),l=a*(t-s[0])/r/u[0],c=a*(s[1]-e)/r/u[1];return n?(l=w(l,5)-1,c=w(c,5)-1):(l=x(l,5),c=x(c,5)),wf(o,l,c,i)}},{key:"getTileCoordForXYAndZ_",value:function(t,e,r,n,i){var o=this.getOrigin(r),a=this.getResolution(r),s=No(this.getTileSize(r),this.tmpSize_),u=(t-o[0])/a/s[0],l=(o[1]-e)/a/s[1];return n?(u=w(u,5)-1,l=w(l,5)-1):(u=x(u,5),l=x(l,5)),wf(r,u,l,i)}},{key:"getTileCoordForCoordAndZ",value:function(t,e,r){return this.getTileCoordForXYAndZ_(t[0],t[1],e,!1,r)}},{key:"getTileCoordResolution",value:function(t){return this.resolutions_[t[0]]}},{key:"getTileSize",value:function(t){return this.tileSize_?this.tileSize_:this.tileSizes_[t]}},{key:"getFullTileRange",value:function(t){return this.fullTileRanges_?this.fullTileRanges_[t]:this.extent_?this.getTileRangeForExtentAndZ(this.extent_,t):null}},{key:"getZForResolution",value:function(t,e){return h(function(t,e,r){var n,i=t.length;if(t[0]<=e)return 0;if(e<=t[i-1])return i-1;if(r>0){for(n=1;n<i;++n)if(t[n]<e)return n-1}else if(r<0){for(n=1;n<i;++n)if(t[n]<=e)return n}else for(n=1;n<i;++n){if(t[n]==e)return n;if(t[n]<e)return"function"==typeof r?r(e,t[n-1],t[n])>0?n-1:n:t[n-1]-e<e-t[n]?n-1:n}return i-1}(this.resolutions_,t,e||0),this.minZoom,this.maxZoom)}},{key:"calculateTileRanges_",value:function(t){for(var e=this.resolutions_.length,r=new Array(e),n=this.minZoom;n<e;++n)r[n]=this.getTileRangeForExtentAndZ(t,n);this.fullTileRanges_=r}}])&&Nf(e.prototype,r),n&&Nf(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Uf(t,e,r,n){for(var i=void 0!==e?e:42,o=Bt(t),a=qt(t),s=No(void 0!==r?r:256),u=n>0?n:Math.max(a/s[0],o/s[1]),l=i+1,c=new Array(l),f=0;f<l;++f)c[f]=u/Math.pow(2,f);return c}function Kf(t,e,r,n){return function(t,e,r,n){var i=void 0!==n?n:Q,o=Uf(t,e,r);return new Zf({extent:t,origin:Gt(t,i),resolutions:o,tileSize:r})}(Hf(t),e,r,n)}function Hf(t){var r=(t=$t(t)).getExtent();if(!r){var i=180*e[n.DEGREES]/t.getMetersPerUnit();r=Ot(-i,-i,i,i)}return r}function Jf(t){return(Jf="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function $f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Qf(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function th(t,e,r){return e&&Qf(t.prototype,e),r&&Qf(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function eh(){return(eh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=rh(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function rh(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=sh(t)););return t}function nh(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&ih(t,e)}function ih(t,e){return(ih=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function oh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=sh(t);if(e){var i=sh(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ah(this,r)}}function ah(t,e){if(e&&("object"===Jf(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function sh(t){return(sh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var uh=function(t){nh(r,t);var e=oh(r);function r(t){var n;$f(this,r),(n=e.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,projection:t.projection,state:t.state,wrapX:t.wrapX,interpolate:t.interpolate})).on,n.once,n.un,n.opaque_=void 0!==t.opaque&&t.opaque,n.tilePixelRatio_=void 0!==t.tilePixelRatio?t.tilePixelRatio:1,n.tileGrid=void 0!==t.tileGrid?t.tileGrid:null;return n.tileGrid&&No(n.tileGrid.getTileSize(n.tileGrid.getMinZoom()),[256,256]),n.tileCache=new Mf(t.cacheSize||0),n.tmpSize=[0,0],n.key_=t.key||"",n.tileOptions={transition:t.transition,interpolate:t.interpolate},n.zDirection=t.zDirection?t.zDirection:0,n}return th(r,[{key:"canExpireCache",value:function(){return this.tileCache.canExpireCache()}},{key:"expireCache",value:function(t,e){var r=this.getTileCacheForProjection(t);r&&r.expireCache(e)}},{key:"forEachLoadedTile",value:function(t,e,r,n){var i=this.getTileCacheForProjection(t);if(!i)return!1;for(var o,a,s,u=!0,l=r.minX;l<=r.maxX;++l)for(var c=r.minY;c<=r.maxY;++c)a=kf(e,l,c),s=!1,i.containsKey(a)&&(s=(o=i.get(a)).getState()===Zi)&&(s=!1!==n(o)),s||(u=!1);return u}},{key:"getGutterForProjection",value:function(t){return 0}},{key:"getKey",value:function(){return this.key_}},{key:"setKey",value:function(t){this.key_!==t&&(this.key_=t,this.changed())}},{key:"getOpaque",value:function(t){return this.opaque_}},{key:"getResolutions",value:function(){return this.tileGrid?this.tileGrid.getResolutions():null}},{key:"getTile",value:function(t,e,r,n,o){return i()}},{key:"getTileGrid",value:function(){return this.tileGrid}},{key:"getTileGridForProjection",value:function(t){return this.tileGrid?this.tileGrid:function(t){var e=t.getDefaultTileGrid();return e||(e=Kf(t),t.setDefaultTileGrid(e)),e}(t)}},{key:"getTileCacheForProjection",value:function(t){var e=this.getProjection();return vt(null===e||ee(e,t),68),this.tileCache}},{key:"getTilePixelRatio",value:function(t){return this.tilePixelRatio_}},{key:"getTilePixelSize",value:function(t,e,r){var n,i,o,a=this.getTileGridForProjection(r),s=this.getTilePixelRatio(e),u=No(a.getTileSize(t),this.tmpSize);return 1==s?u:(n=u,i=s,void 0===(o=this.tmpSize)&&(o=[0,0]),o[0]=n[0]*i+.5|0,o[1]=n[1]*i+.5|0,o)}},{key:"getTileCoordForTileUrlFunction",value:function(t,e){var r=void 0!==e?e:this.getProjection(),n=this.getTileGridForProjection(r);return this.getWrapX()&&r.isGlobal()&&(t=function(t,e,r){var n=e[0],i=t.getTileCoordCenter(e),o=Hf(r);if(_t(o,i))return e;var a=qt(o),s=Math.ceil((o[0]-i[0])/a);return i[0]+=a*s,t.getTileCoordForCoordAndZ(i,n)}(n,t,r)),function(t,e){var r=t[0],n=t[1],i=t[2];if(e.getMinZoom()>r||r>e.getMaxZoom())return!1;var o=e.getFullTileRange(r);return!o||o.containsXY(n,i)}(t,n)?t:null}},{key:"clear",value:function(){this.tileCache.clear()}},{key:"refresh",value:function(){this.clear(),eh(sh(r.prototype),"refresh",this).call(this)}},{key:"updateCacheSize",value:function(t,e){var r=this.getTileCacheForProjection(e);t>r.highWaterMark&&(r.highWaterMark=t)}},{key:"useTile",value:function(t,e,r,n){}}]),r}(qf),lh=function(t){nh(r,t);var e=oh(r);function r(t,n){var i;return $f(this,r),(i=e.call(this,t)).tile=n,i}return th(r)}(Me);function ch(t,e){var r=/\{z\}/g,n=/\{x\}/g,i=/\{y\}/g,o=/\{-y\}/g;return function(a,s,u){return a?t.replace(r,a[0].toString()).replace(n,a[1].toString()).replace(i,a[2].toString()).replace(o,(function(){var t=a[0],r=e.getFullTileRange(t);return vt(r,55),(r.getHeight()-a[2]-1).toString()})):void 0}}function fh(t,e){for(var r=t.length,n=new Array(r),i=0;i<r;++i)n[i]=ch(t[i],e);return function(t){if(1===t.length)return t[0];return function(e,r,n){if(e){var i=m(function(t){return(t[1]<<t[0])+t[2]}(e),t.length);return t[i](e,r,n)}}}(n)}function hh(t){return(hh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function ph(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function yh(t,e){return(yh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function dh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=gh(t);if(e){var i=gh(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return vh(this,r)}}function vh(t,e){if(e&&("object"===hh(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function gh(t){return(gh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var mh=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&yh(t,e)}(o,t);var e,r,n,i=dh(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this,{attributions:t.attributions,cacheSize:t.cacheSize,opaque:t.opaque,projection:t.projection,state:t.state,tileGrid:t.tileGrid,tilePixelRatio:t.tilePixelRatio,wrapX:t.wrapX,transition:t.transition,interpolate:t.interpolate,key:t.key,attributionsCollapsible:t.attributionsCollapsible,zDirection:t.zDirection})).generateTileUrlFunction_=e.tileUrlFunction===o.prototype.tileUrlFunction,e.tileLoadFunction=t.tileLoadFunction,t.tileUrlFunction&&(e.tileUrlFunction=t.tileUrlFunction),e.urls=null,t.urls?e.setUrls(t.urls):t.url&&e.setUrl(t.url),e.tileLoadingKeys_={},e}return e=o,(r=[{key:"getTileLoadFunction",value:function(){return this.tileLoadFunction}},{key:"getTileUrlFunction",value:function(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}},{key:"getUrls",value:function(){return this.urls}},{key:"handleTileChange",value:function(t){var e,r=t.target,n=a(r),i=r.getState();i==Vi?(this.tileLoadingKeys_[n]=!0,e=Ff):n in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[n],e=i==Ui?Df:i==Zi?If:void 0),null!=e&&this.dispatchEvent(new lh(e,r))}},{key:"setTileLoadFunction",value:function(t){this.tileCache.clear(),this.tileLoadFunction=t,this.changed()}},{key:"setTileUrlFunction",value:function(t,e){this.tileUrlFunction=t,this.tileCache.pruneExceptNewestZ(),void 0!==e?this.setKey(e):this.changed()}},{key:"setUrl",value:function(t){var e=function(t){var e=[],r=/\{([a-z])-([a-z])\}/.exec(t);if(r){var n,i=r[1].charCodeAt(0),o=r[2].charCodeAt(0);for(n=i;n<=o;++n)e.push(t.replace(r[0],String.fromCharCode(n)));return e}if(r=/\{(\d+)-(\d+)\}/.exec(t)){for(var a=parseInt(r[2],10),s=parseInt(r[1],10);s<=a;s++)e.push(t.replace(r[0],s.toString()));return e}return e.push(t),e}(t);this.urls=e,this.setUrls(e)}},{key:"setUrls",value:function(t){this.urls=t;var e=t.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(fh(t,this.tileGrid),e):this.setKey(e)}},{key:"tileUrlFunction",value:function(t,e,r){}},{key:"useTile",value:function(t,e,r){var n=kf(t,e,r);this.tileCache.containsKey(n)&&this.tileCache.get(n)}}])&&ph(e.prototype,r),n&&ph(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(uh);function bh(t){return(bh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function _h(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function xh(){return(xh="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=wh(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function wh(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Ch(t)););return t}function kh(t,e){return(kh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Sh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Ch(t);if(e){var i=Ch(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Oh(this,r)}}function Oh(t,e){if(e&&("object"===bh(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Th(t)}function Th(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ch(t){return(Ch=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Ph=[],Rh=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&kh(t,e)}(o,t);var e,r,n,i=Sh(o);function o(t,e,r,n){var a;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(a=i.call(this,t,e,{transition:0})).context_={},a.executorGroups={},a.declutterExecutorGroups={},a.loadingSourceTiles=0,a.hitDetectionImageData={},a.replayState_={},a.sourceTiles=[],a.errorTileKeys={},a.wantedResolution,a.getSourceTiles=n.bind(void 0,Th(a)),a.wrappedTileCoord=r,a}return e=o,(r=[{key:"getContext",value:function(t){var e=a(t);return e in this.context_||(this.context_[e]=na(1,1,Ph)),this.context_[e]}},{key:"hasContext",value:function(t){return a(t)in this.context_}},{key:"getImage",value:function(t){return this.hasContext(t)?this.getContext(t).canvas:null}},{key:"getReplayState",value:function(t){var e=a(t);return e in this.replayState_||(this.replayState_[e]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[e]}},{key:"load",value:function(){this.getSourceTiles()}},{key:"release",value:function(){for(var t in this.context_)Ph.push(this.context_[t].canvas),delete this.context_[t];xh(Ch(o.prototype),"release",this).call(this)}}])&&_h(e.prototype,r),n&&_h(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(dl),jh=!1;function Eh(t,e,r,n,i,o,a){var s=new XMLHttpRequest;s.open("GET","function"==typeof t?t(r,n,i):t,!0),e.getType()==ye&&(s.responseType="arraybuffer"),s.withCredentials=jh,s.onload=function(t){if(!s.status||s.status>=200&&s.status<300){var n,u=e.getType();u==de||u==ve?n=s.responseText:u==ge?(n=s.responseXML)||(n=(new DOMParser).parseFromString(s.responseText,"application/xml")):u==ye&&(n=s.response),n?o(e.readFeatures(n,{extent:r,featureProjection:i}),e.readProjection(n)):a()}else a()},s.onerror=a,s.send()}function Mh(t){return(Mh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Fh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Ih(){return(Ih="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=Dh(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function Dh(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Gh(t)););return t}function zh(t,e){return(zh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Ah(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Gh(t);if(e){var i=Gh(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Lh(this,r)}}function Lh(t,e){if(e&&("object"===Mh(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Gh(t){return(Gh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Bh=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&zh(t,e)}(o,t);var e,r,n,i=Ah(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=t.projection||"EPSG:3857",n=t.extent||Hf(r),a=t.tileGrid||function(t){var e=t||{},r=e.extent||$t("EPSG:3857").getExtent(),n={extent:r,minZoom:e.minZoom,tileSize:e.tileSize,resolutions:Uf(r,e.maxZoom,e.tileSize,e.maxResolution)};return new Zf(n)}({extent:n,maxResolution:t.maxResolution,maxZoom:void 0!==t.maxZoom?t.maxZoom:22,minZoom:t.minZoom,tileSize:t.tileSize||512});return(e=i.call(this,{attributions:t.attributions,attributionsCollapsible:t.attributionsCollapsible,cacheSize:t.cacheSize,interpolate:!0,opaque:!1,projection:r,state:t.state,tileGrid:a,tileLoadFunction:t.tileLoadFunction?t.tileLoadFunction:Wh,tileUrlFunction:t.tileUrlFunction,url:t.url,urls:t.urls,wrapX:void 0===t.wrapX||t.wrapX,transition:t.transition,zDirection:void 0===t.zDirection?1:t.zDirection})).format_=t.format?t.format:null,e.sourceTileCache=new Mf(e.tileCache.highWaterMark),e.overlaps_=null==t.overlaps||t.overlaps,e.tileClass=t.tileClass?t.tileClass:mf,e.tileGrids_={},e}return e=o,(r=[{key:"getFeaturesInExtent",value:function(t){var e=[],r=this.tileCache;if(0===r.getCount())return e;var n=Sf(r.peekFirstKey())[0],i=this.tileGrid;return r.forEach((function(r){if(r.tileCoord[0]===n&&r.getState()===Zi)for(var o=r.getSourceTiles(),a=0,s=o.length;a<s;++a){var u=o[a],l=u.tileCoord;if(Nt(t,i.getTileCoordExtent(l))){var c=u.getFeatures();if(c)for(var f=0,h=c.length;f<h;++f){var p=c[f],y=p.getGeometry();Nt(t,y.getExtent())&&e.push(p)}}}})),e}},{key:"getOverlaps",value:function(){return this.overlaps_}},{key:"clear",value:function(){this.tileCache.clear(),this.sourceTileCache.clear()}},{key:"expireCache",value:function(t,e){var r=this.getTileCacheForProjection(t),n=Object.keys(e).reduce((function(t,e){var n,i,o=kf((i=_f((n=e).substring(n.lastIndexOf("/")+1,n.length).split(",").map(Number),3))[0],i[1],i[2]);if(r.containsKey(o))for(var a=r.get(o).sourceTiles,s=0,u=a.length;s<u;++s)t[a[s].getKey()]=!0;return t}),{});Ih(Gh(o.prototype),"expireCache",this).call(this,t,e),this.sourceTileCache.expireCache(n)}},{key:"getSourceTiles",value:function(t,e,r){var n=this;if(r.getState()===Ni){r.setState(Vi);var i=r.wrappedTileCoord,o=this.getTileGridForProjection(e),a=o.getTileCoordExtent(i),s=i[0],u=o.getResolution(s);mt(a,-u,a);var c=this.tileGrid,f=c.getExtent();f&&Wt(a,f,a);var h=c.getZForResolution(u,1);c.forEachTileCoord(a,h,(function(i){var o=n.tileUrlFunction(i,t,e),a=n.sourceTileCache.containsKey(o)?n.sourceTileCache.get(o):new n.tileClass(i,o?Ni:Ki,o,n.format_,n.tileLoadFunction);r.sourceTiles.push(a);var s=a.getState();s<Zi&&(a.addEventListener(Ze,(function t(e){n.handleTileChange(e);var i=a.getState();if(i===Zi||i===Ui){var o=a.getKey();o in r.errorTileKeys?a.getState()===Zi&&delete r.errorTileKeys[o]:r.loadingSourceTiles--,i===Ui?r.errorTileKeys[o]=!0:a.removeEventListener(Ze,t),0===r.loadingSourceTiles&&r.setState(l(r.errorTileKeys)?Zi:Ui)}})),r.loadingSourceTiles++),s===Ni&&(a.extent=c.getTileCoordExtent(i),a.projection=e,a.resolution=c.getResolution(i[0]),n.sourceTileCache.set(o,a),a.load())})),r.loadingSourceTiles||r.setState(r.sourceTiles.some((function(t){return t.getState()===Ui}))?Ui:Zi)}return r.sourceTiles}},{key:"getTile",value:function(t,e,r,n,i){var o,a=kf(t,e,r),s=this.getKey();if(this.tileCache.containsKey(a)&&(o=this.tileCache.get(a)).key===s)return o;var u=[t,e,r],l=this.getTileCoordForTileUrlFunction(u,i),c=this.getTileGrid().getExtent(),f=this.getTileGridForProjection(i);if(l&&c){var h=f.getTileCoordExtent(l);mt(h,-f.getResolution(t),h),Nt(c,h)||(l=null)}var p=!0;if(null!==l){var y=this.tileGrid,d=f.getResolution(t),v=y.getZForResolution(d,1),g=f.getTileCoordExtent(l);mt(g,-d,g),y.forEachTileCoord(g,v,function(t){p=p&&!this.tileUrlFunction(t,n,i)}.bind(this))}var m=new Rh(u,p?Ki:Ni,l,this.getSourceTiles.bind(this,n,i));return m.key=s,o?(m.interimTile=o,m.refreshInterimChain(),this.tileCache.replace(a,m)):this.tileCache.set(a,m),m}},{key:"getTileGridForProjection",value:function(t){var e=t.getCode(),r=this.tileGrids_[e];if(!r){var n=this.tileGrid;r=Kf(t,void 0,n?n.getTileSize(n.getMinZoom()):void 0),this.tileGrids_[e]=r}return r}},{key:"getTilePixelRatio",value:function(t){return t}},{key:"getTilePixelSize",value:function(t,e,r){var n=No(this.getTileGridForProjection(r).getTileSize(t),this.tmpSize);return[Math.round(n[0]*e),Math.round(n[1]*e)]}},{key:"updateCacheSize",value:function(t,e){Ih(Gh(o.prototype),"updateCacheSize",this).call(this,2*t,e),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(e).highWaterMark}}])&&Fh(e.prototype,r),n&&Fh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(mh);function Wh(t,e){t.setLoader((function(r,n,i){Eh(e,t.getFormat(),r,n,i,t.onLoad.bind(t),t.onError.bind(t))}))}var Xh=r(20);function Yh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var qh=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t);var r=e||{};this.font_=r.font,this.rotation_=r.rotation,this.rotateWithView_=r.rotateWithView,this.scale_=r.scale,this.scaleArray_=No(void 0!==r.scale?r.scale:1),this.text_=r.text,this.textAlign_=r.textAlign,this.justify_=r.justify,this.textBaseline_=r.textBaseline,this.fill_=void 0!==r.fill?r.fill:new Wa({color:"#333"}),this.maxAngle_=void 0!==r.maxAngle?r.maxAngle:Math.PI/4,this.placement_=void 0!==r.placement?r.placement:Ks,this.overflow_=!!r.overflow,this.stroke_=void 0!==r.stroke?r.stroke:null,this.offsetX_=void 0!==r.offsetX?r.offsetX:0,this.offsetY_=void 0!==r.offsetY?r.offsetY:0,this.backgroundFill_=r.backgroundFill?r.backgroundFill:null,this.backgroundStroke_=r.backgroundStroke?r.backgroundStroke:null,this.padding_=void 0===r.padding?null:r.padding}var e,r,n;return e=t,(r=[{key:"clone",value:function(){var e=this.getScale();return new t({font:this.getFont(),placement:this.getPlacement(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(e)?e.slice():e,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}},{key:"getOverflow",value:function(){return this.overflow_}},{key:"getFont",value:function(){return this.font_}},{key:"getMaxAngle",value:function(){return this.maxAngle_}},{key:"getPlacement",value:function(){return this.placement_}},{key:"getOffsetX",value:function(){return this.offsetX_}},{key:"getOffsetY",value:function(){return this.offsetY_}},{key:"getFill",value:function(){return this.fill_}},{key:"getRotateWithView",value:function(){return this.rotateWithView_}},{key:"getRotation",value:function(){return this.rotation_}},{key:"getScale",value:function(){return this.scale_}},{key:"getScaleArray",value:function(){return this.scaleArray_}},{key:"getStroke",value:function(){return this.stroke_}},{key:"getText",value:function(){return this.text_}},{key:"getTextAlign",value:function(){return this.textAlign_}},{key:"getJustify",value:function(){return this.justify_}},{key:"getTextBaseline",value:function(){return this.textBaseline_}},{key:"getBackgroundFill",value:function(){return this.backgroundFill_}},{key:"getBackgroundStroke",value:function(){return this.backgroundStroke_}},{key:"getPadding",value:function(){return this.padding_}},{key:"setOverflow",value:function(t){this.overflow_=t}},{key:"setFont",value:function(t){this.font_=t}},{key:"setMaxAngle",value:function(t){this.maxAngle_=t}},{key:"setOffsetX",value:function(t){this.offsetX_=t}},{key:"setOffsetY",value:function(t){this.offsetY_=t}},{key:"setPlacement",value:function(t){this.placement_=t}},{key:"setRotateWithView",value:function(t){this.rotateWithView_=t}},{key:"setFill",value:function(t){this.fill_=t}},{key:"setRotation",value:function(t){this.rotation_=t}},{key:"setScale",value:function(t){this.scale_=t,this.scaleArray_=No(void 0!==t?t:1)}},{key:"setStroke",value:function(t){this.stroke_=t}},{key:"setText",value:function(t){this.text_=t}},{key:"setTextAlign",value:function(t){this.textAlign_=t}},{key:"setJustify",value:function(t){this.justify_=t}},{key:"setTextBaseline",value:function(t){this.textBaseline_=t}},{key:"setBackgroundFill",value:function(t){this.backgroundFill_=t}},{key:"setBackgroundStroke",value:function(t){this.backgroundStroke_=t}},{key:"setPadding",value:function(t){this.padding_=t}}])&&Yh(e.prototype,r),n&&Yh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),t}();function Nh(t){return(Nh="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Vh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function Zh(t,e){return(Zh=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function Uh(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=Hh(t);if(e){var i=Hh(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return Kh(this,r)}}function Kh(t,e){if(e&&("object"===Nh(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function Hh(t){return(Hh=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}var Jh=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Zh(t,e)}(o,t);var e,r,n,i=Uh(o);function o(t){var e;if(function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).on,e.once,e.un,e.id_=void 0,e.geometryName_="geometry",e.style_=null,e.styleFunction_=void 0,e.geometryChangeKey_=null,e.addChangeListener(e.geometryName_,e.handleGeometryChanged_),t)if("function"==typeof t.getSimplifiedGeometry){var r=t;e.setGeometry(r)}else{var n=t;e.setProperties(n)}return e}return e=o,(r=[{key:"clone",value:function(){var t=new o(this.hasProperties()?this.getProperties():null);t.setGeometryName(this.getGeometryName());var e=this.getGeometry();e&&t.setGeometry(e.clone());var r=this.getStyle();return r&&t.setStyle(r),t}},{key:"getGeometry",value:function(){return this.get(this.geometryName_)}},{key:"getId",value:function(){return this.id_}},{key:"getGeometryName",value:function(){return this.geometryName_}},{key:"getStyle",value:function(){return this.style_}},{key:"getStyleFunction",value:function(){return this.styleFunction_}},{key:"handleGeometryChange_",value:function(){this.changed()}},{key:"handleGeometryChanged_",value:function(){this.geometryChangeKey_&&($e(this.geometryChangeKey_),this.geometryChangeKey_=null);var t=this.getGeometry();t&&(this.geometryChangeKey_=He(t,Ze,this.handleGeometryChange_,this)),this.changed()}},{key:"setGeometry",value:function(t){this.set(this.geometryName_,t)}},{key:"setStyle",value:function(t){var e,r;this.style_=t,this.styleFunction_=t?"function"==typeof(e=t)?e:(Array.isArray(e)?r=e:(vt("function"==typeof e.getZIndex,41),r=[e]),function(){return r}):void 0,this.changed()}},{key:"setId",value:function(t){this.id_=t,this.changed()}},{key:"setGeometryName",value:function(t){this.removeChangeListener(this.geometryName_,this.handleGeometryChanged_),this.geometryName_=t,this.addChangeListener(this.geometryName_,this.handleGeometryChanged_),this.handleGeometryChanged_()}}])&&Vh(e.prototype,r),n&&Vh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(br);function $h(t){return($h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function Qh(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function tp(){return(tp="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=ep(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(arguments.length<3?t:r):i.value}}).apply(this,arguments)}function ep(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=op(t)););return t}function rp(t,e){return(rp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function np(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=op(t);if(e){var i=op(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return ip(this,r)}}function ip(t,e){if(e&&("object"===$h(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function op(t){return(op=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function ap(t){for(var e=[],r=0,n=t.length;r<n;++r)e.push(t[r].clone());return e}var sp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&rp(t,e)}(o,t);var e,r,n,i=np(o);function o(t){var e;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o),(e=i.call(this)).geometries_=t||null,e.changeEventsKeys_=[],e.listenGeometriesChange_(),e}return e=o,(r=[{key:"unlistenGeometriesChange_",value:function(){this.changeEventsKeys_.forEach($e),this.changeEventsKeys_.length=0}},{key:"listenGeometriesChange_",value:function(){if(this.geometries_)for(var t=0,e=this.geometries_.length;t<e;++t)this.changeEventsKeys_.push(He(this.geometries_[t],Ze,this.changed,this))}},{key:"clone",value:function(){var t=new o(null);return t.setGeometries(this.geometries_),t.applyProperties(this),t}},{key:"closestPointXY",value:function(t,e,r,n){if(n<bt(this.getExtent(),t,e))return n;for(var i=this.geometries_,o=0,a=i.length;o<a;++o)n=i[o].closestPointXY(t,e,r,n);return n}},{key:"containsXY",value:function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)if(r[n].containsXY(t,e))return!0;return!1}},{key:"computeExtent",value:function(t){Tt(t);for(var e=this.geometries_,r=0,n=e.length;r<n;++r)jt(t,e[r].getExtent());return t}},{key:"getGeometries",value:function(){return ap(this.geometries_)}},{key:"getGeometriesArray",value:function(){return this.geometries_}},{key:"getGeometriesArrayRecursive",value:function(){for(var t=[],e=this.geometries_,r=0,n=e.length;r<n;++r)e[r].getType()===this.getType()?t=t.concat(e[r].getGeometriesArrayRecursive()):t.push(e[r]);return t}},{key:"getSimplifiedGeometry",value:function(t){if(this.simplifiedGeometryRevision!==this.getRevision()&&(this.simplifiedGeometryMaxMinSquaredTolerance=0,this.simplifiedGeometryRevision=this.getRevision()),t<0||0!==this.simplifiedGeometryMaxMinSquaredTolerance&&t<this.simplifiedGeometryMaxMinSquaredTolerance)return this;for(var e=[],r=this.geometries_,n=!1,i=0,a=r.length;i<a;++i){var s=r[i],u=s.getSimplifiedGeometry(t);e.push(u),u!==s&&(n=!0)}if(n){var l=new o(null);return l.setGeometriesArray(e),l}return this.simplifiedGeometryMaxMinSquaredTolerance=t,this}},{key:"getType",value:function(){return Re}},{key:"intersectsExtent",value:function(t){for(var e=this.geometries_,r=0,n=e.length;r<n;++r)if(e[r].intersectsExtent(t))return!0;return!1}},{key:"isEmpty",value:function(){return 0===this.geometries_.length}},{key:"rotate",value:function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].rotate(t,e);this.changed()}},{key:"scale",value:function(t,e,r){var n=r;n||(n=Lt(this.getExtent()));for(var i=this.geometries_,o=0,a=i.length;o<a;++o)i[o].scale(t,e,n);this.changed()}},{key:"setGeometries",value:function(t){this.setGeometriesArray(ap(t))}},{key:"setGeometriesArray",value:function(t){this.unlistenGeometriesChange_(),this.geometries_=t,this.listenGeometriesChange_(),this.changed()}},{key:"applyTransform",value:function(t){for(var e=this.geometries_,r=0,n=e.length;r<n;++r)e[r].applyTransform(t);this.changed()}},{key:"translate",value:function(t,e){for(var r=this.geometries_,n=0,i=r.length;n<i;++n)r[n].translate(t,e);this.changed()}},{key:"disposeInternal",value:function(){this.unlistenGeometriesChange_(),tp(op(o.prototype),"disposeInternal",this).call(this)}}])&&Qh(e.prototype,r),n&&Qh(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(Wr);function up(t){return(up="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function lp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function cp(t,e){return(cp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function fp(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=pp(t);if(e){var i=pp(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return hp(this,r)}}function hp(t,e){if(e&&("object"===up(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function pp(t){return(pp=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function yp(t){if("string"==typeof t){var e=JSON.parse(t);return e||null}return null!==t?t:null}function dp(t){return(dp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vp(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function gp(t,e){return(gp=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function mp(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=_p(t);if(e){var i=_p(this).constructor;r=Reflect.construct(n,arguments,i)}else r=n.apply(this,arguments);return bp(this,r)}}function bp(t,e){if(e&&("object"===dp(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function _p(t){return(_p=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function xp(t,e){if(!t)return null;var r;switch(t.type){case we:r=function(t){return new Wn(t.coordinates)}(t);break;case ke:r=function(t){return new Cn(t.coordinates)}(t);break;case Oe:r=function(t){return new mi(t.coordinates)}(t);break;case Te:r=function(t){return new Un(t.coordinates)}(t);break;case Ce:r=function(t){return new In(t.coordinates)}(t);break;case Pe:r=function(t){return new Ti(t.coordinates)}(t);break;case Re:r=function(t,e){var r=t.geometries.map((function(t){return xp(t,e)}));return new sp(r)}(t);break;default:throw new Error("Unsupported GeoJSON type: "+t.type)}return pe(r,!1,e)}function wp(t,e){var r,n=(t=pe(t,!0,e)).getType();switch(n){case we:r=function(t,e){return{type:"Point",coordinates:t.getCoordinates()}}(t);break;case ke:r=function(t,e){return{type:"LineString",coordinates:t.getCoordinates()}}(t);break;case Oe:r=function(t,e){var r;e&&(r=e.rightHanded);return{type:"Polygon",coordinates:t.getCoordinates(r)}}(t,e);break;case Te:r=function(t,e){return{type:"MultiPoint",coordinates:t.getCoordinates()}}(t);break;case Ce:r=function(t,e){return{type:"MultiLineString",coordinates:t.getCoordinates()}}(t);break;case Pe:r=function(t,e){var r;e&&(r=e.rightHanded);return{type:"MultiPolygon",coordinates:t.getCoordinates(r)}}(t,e);break;case Re:r=function(t,e){return{type:"GeometryCollection",geometries:t.getGeometriesArray().map((function(t){var r=s({},e);return delete r.featureProjection,wp(t,r)}))}}(t,e);break;case je:r={type:"GeometryCollection",geometries:[]};break;default:throw new Error("Unsupported geometry type: "+n)}return r}var kp=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gp(t,e)}(o,t);var e,r,n,i=mp(o);function o(t){var e;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,o);var r=t||{};return(e=i.call(this)).dataProjection=$t(r.dataProjection?r.dataProjection:"EPSG:4326"),r.featureProjection&&(e.defaultFeatureProjection=$t(r.featureProjection)),e.geometryName_=r.geometryName,e.extractGeometryName_=r.extractGeometryName,e.supportedMediaTypes=["application/geo+json","application/vnd.geo+json"],e}return e=o,(r=[{key:"readFeatureFromObject",value:function(t,e){var r=null,n=xp((r="Feature"===t.type?t:{type:"Feature",geometry:t,properties:null}).geometry,e),i=new Jh;return this.geometryName_?i.setGeometryName(this.geometryName_):this.extractGeometryName_&&"geometry_name"in r!==void 0&&i.setGeometryName(r.geometry_name),i.setGeometry(n),"id"in r&&i.setId(r.id),r.properties&&i.setProperties(r.properties,!0),i}},{key:"readFeaturesFromObject",value:function(t,e){var r=null;if("FeatureCollection"===t.type){r=[];for(var n=t.features,i=0,o=n.length;i<o;++i)r.push(this.readFeatureFromObject(n[i],e))}else r=[this.readFeatureFromObject(t,e)];return r}},{key:"readGeometryFromObject",value:function(t,e){return xp(t,e)}},{key:"readProjectionFromObject",value:function(t){var e,r=t.crs;return r?"name"==r.type?e=$t(r.properties.name):"EPSG"===r.type?e=$t("EPSG:"+r.properties.code):vt(!1,36):e=this.dataProjection,e}},{key:"writeFeatureObject",value:function(t,e){e=this.adaptOptions(e);var r={type:"Feature",geometry:null,properties:null},n=t.getId();if(void 0!==n&&(r.id=n),!t.hasProperties())return r;var i=t.getProperties(),o=t.getGeometry();return o&&(r.geometry=wp(o,e),delete i[t.getGeometryName()]),l(i)||(r.properties=i),r}},{key:"writeFeaturesObject",value:function(t,e){e=this.adaptOptions(e);for(var r=[],n=0,i=t.length;n<i;++n)r.push(this.writeFeatureObject(t[n],e));return{type:"FeatureCollection",features:r}}},{key:"writeGeometryObject",value:function(t,e){return wp(t,this.adaptOptions(e))}}])&&vp(e.prototype,r),n&&vp(e,n),Object.defineProperty(e,"prototype",{writable:!1}),o}(function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&cp(t,e)}(a,t);var e,r,n,o=fp(a);function a(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,a),o.call(this)}return e=a,(r=[{key:"getType",value:function(){return de}},{key:"readFeature",value:function(t,e){return this.readFeatureFromObject(yp(t),this.getReadOptions(t,e))}},{key:"readFeatures",value:function(t,e){return this.readFeaturesFromObject(yp(t),this.getReadOptions(t,e))}},{key:"readFeatureFromObject",value:function(t,e){return i()}},{key:"readFeaturesFromObject",value:function(t,e){return i()}},{key:"readGeometry",value:function(t,e){return this.readGeometryFromObject(yp(t),this.getReadOptions(t,e))}},{key:"readGeometryFromObject",value:function(t,e){return i()}},{key:"readProjection",value:function(t){return this.readProjectionFromObject(yp(t))}},{key:"readProjectionFromObject",value:function(t){return i()}},{key:"writeFeature",value:function(t,e){return JSON.stringify(this.writeFeatureObject(t,e))}},{key:"writeFeatureObject",value:function(t,e){return i()}},{key:"writeFeatures",value:function(t,e){return JSON.stringify(this.writeFeaturesObject(t,e))}},{key:"writeFeaturesObject",value:function(t,e){return i()}},{key:"writeGeometry",value:function(t,e){return JSON.stringify(this.writeGeometryObject(t,e))}},{key:"writeGeometryObject",value:function(t,e){return i()}}])&&lp(e.prototype,r),n&&lp(e,n),Object.defineProperty(e,"prototype",{writable:!1}),a}(he));function Sp(t){return(Sp="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}var Op,Tp={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Cp(t){return(t=Math.round(t))<0?0:t>255?255:t}function Pp(t){return t<0?0:t>1?1:t}function Rp(t){return"%"===t[t.length-1]?Cp(parseFloat(t)/100*255):Cp(parseInt(t))}function jp(t){return"%"===t[t.length-1]?Pp(parseFloat(t)/100):Pp(parseFloat(t))}function Ep(t,e,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?t+(e-t)*r*6:2*r<1?e:3*r<2?t+(e-t)*(2/3-r)*6:t}try{Op={}.parseCSSColor=function(t){var e,r=t.replace(/ /g,"").toLowerCase();if(r in Tp)return Tp[r].slice();if("#"===r[0])return 4===r.length?(e=parseInt(r.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===r.length&&(e=parseInt(r.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var n=r.indexOf("("),i=r.indexOf(")");if(-1!==n&&i+1===r.length){var o=r.substr(0,n),a=r.substr(n+1,i-(n+1)).split(","),s=1;switch(o){case"rgba":if(4!==a.length)return null;s=jp(a.pop());case"rgb":return 3!==a.length?null:[Rp(a[0]),Rp(a[1]),Rp(a[2]),s];case"hsla":if(4!==a.length)return null;s=jp(a.pop());case"hsl":if(3!==a.length)return null;var u=(parseFloat(a[0])%360+360)%360/360,l=jp(a[1]),c=jp(a[2]),f=c<=.5?c*(l+1):c+l-c*l,h=2*c-f;return[Cp(255*Ep(h,f,u+1/3)),Cp(255*Ep(h,f,u)),Cp(255*Ep(h,f,u-1/3)),s];default:return null}}return null}}catch(t){}var Mp=function(t,e,r,n){void 0===n&&(n=1),this.r=t,this.g=e,this.b=r,this.a=n};function Fp(t){return"object"===Sp(t)?["literal",t]:t}function Ip(t,e){var r=t.stops;if(!r)return function(t,e){var r=["get",t.property];if(void 0===t.default)return"string"===e.type?["string",r]:r;if("enum"===e.type)return["match",r,Object.keys(e.values),r,t.default];var n=["color"===e.type?"to-color":e.type,r,Fp(t.default)];return"array"===e.type&&n.splice(1,0,e.value,e.length||null),n}(t,e);var n=r&&"object"===Sp(r[0][0]),i=n||void 0!==t.property,o=n||!i;return r=r.map((function(t){return!i&&e.tokens&&"string"==typeof t[1]?[t[0],Wp(t[1])]:[t[0],Fp(t[1])]})),n?function(t,e,r){for(var n={},i={},o=[],a=0;a<r.length;a++){var s=r[a],u=s[0].zoom;void 0===n[u]&&(n[u]={zoom:u,type:t.type,property:t.property,default:t.default},i[u]=[],o.push(u)),i[u].push([s[0].value,s[1]])}if("exponential"===Bp({},e)){for(var l=[Dp(t),["linear"],["zoom"]],c=0,f=o;c<f.length;c+=1){var h=f[c];Gp(l,h,Ap(n[h],e,i[h]),!1)}return l}for(var p=["step",["zoom"]],y=0,d=o;y<d.length;y+=1){var v=d[y];Gp(p,v,Ap(n[v],e,i[v]),!0)}return Lp(p),p}(t,e,r):o?function(t,e,r,n){void 0===n&&(n=["zoom"]);var i,o=Bp(t,e),a=!1;if("interval"===o)i=["step",n],a=!0;else{if("exponential"!==o)throw new Error('Unknown zoom function type "'+o+'"');var s=void 0!==t.base?t.base:1;i=[Dp(t),1===s?["linear"]:["exponential",s],n]}for(var u=0,l=r;u<l.length;u+=1){var c=l[u];Gp(i,c[0],c[1],a)}return Lp(i),i}(t,e,r):Ap(t,e,r)}function Dp(t){switch(t.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function zp(t,e){var r,n,i=Fp((r=t.default,n=e.default,void 0!==r?r:void 0!==n?n:void 0));return void 0===i&&"resolvedImage"===e.type?"":i}function Ap(t,e,r){var n=Bp(t,e),i=["get",t.property];if("categorical"===n&&"boolean"==typeof r[0][0]){for(var o=["case"],a=0,s=r;a<s.length;a+=1){var u=s[a];o.push(["==",i,u[0]],u[1])}return o.push(zp(t,e)),o}if("categorical"===n){for(var l=["match",i],c=0,f=r;c<f.length;c+=1){var h=f[c];Gp(l,h[0],h[1],!1)}return l.push(zp(t,e)),l}if("interval"===n){for(var p=["step",["number",i]],y=0,d=r;y<d.length;y+=1){var v=d[y];Gp(p,v[0],v[1],!0)}return Lp(p),void 0===t.default?p:["case",["==",["typeof",i],"number"],p,Fp(t.default)]}if("exponential"===n){for(var g=void 0!==t.base?t.base:1,m=[Dp(t),1===g?["linear"]:["exponential",g],["number",i]],b=0,_=r;b<_.length;b+=1){var x=_[b];Gp(m,x[0],x[1],!1)}return void 0===t.default?m:["case",["==",["typeof",i],"number"],m,Fp(t.default)]}throw new Error("Unknown property function type "+n)}function Lp(t){"step"===t[0]&&3===t.length&&(t.push(0),t.push(t[3]))}function Gp(t,e,r,n){t.length>3&&e===t[t.length-2]||(n&&2===t.length||t.push(e),t.push(r))}function Bp(t,e){return t.type?t.type:e.expression.interpolated?"exponential":"interval"}function Wp(t){for(var e=["concat"],r=/{([^{}]+)}/g,n=0,i=r.exec(t);null!==i;i=r.exec(t)){var o=t.slice(n,r.lastIndex-i[0].length);n=r.lastIndex,o.length>0&&e.push(o),e.push(["get",i[1]])}if(1===e.length)return t;if(n<t.length)e.push(t.slice(n));else if(2===e.length)return["to-string",e[1]];return e}Mp.parse=function(t){if(t){if(t instanceof Mp)return t;if("string"==typeof t){var e=Op(t);if(e)return new Mp(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},Mp.prototype.toString=function(){var t=this.toArray(),e=t[0],r=t[1],n=t[2],i=t[3];return"rgba("+Math.round(e)+","+Math.round(r)+","+Math.round(n)+","+i+")"},Mp.prototype.toArray=function(){var t=this,e=t.r,r=t.g,n=t.b,i=t.a;return 0===i?[0,0,0,0]:[255*e/i,255*r/i,255*n/i,i]},Mp.black=new Mp(0,0,0,1),Mp.white=new Mp(1,1,1,1),Mp.transparent=new Mp(0,0,0,0),Mp.red=new Mp(1,0,0,1),Mp.blue=new Mp(0,0,1,1);var Xp=function(t){function e(e,r){t.call(this,r),this.message=r,this.key=e}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Yp=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var r=0,n=e;r<n.length;r+=1){var i=n[r],o=i[0],a=i[1];this.bindings[o]=a}};Yp.prototype.concat=function(t){return new Yp(this,t)},Yp.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},Yp.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var qp={kind:"null"},Np={kind:"number"},Vp={kind:"string"},Zp={kind:"boolean"},Up={kind:"color"},Kp={kind:"object"},Hp={kind:"value"},Jp={kind:"collator"},$p={kind:"formatted"},Qp={kind:"resolvedImage"};function ty(t,e){return{kind:"array",itemType:t,N:e}}function ey(t){if("array"===t.kind){var e=ey(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var ry=[qp,Np,Vp,Zp,Up,$p,Kp,ty(Hp),Qp];function ny(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!ny(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var r=0,n=ry;r<n.length;r+=1){if(!ny(n[r],e))return null}}return"Expected "+ey(t)+" but found "+ey(e)+" instead."}function iy(t,e){return e.some((function(e){return e.kind===t.kind}))}function oy(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"===Sp(t):e===Sp(t)}))}var ay=function(t,e,r){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ay.prototype.compare=function(t,e){return this.collator.compare(t,e)},ay.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var sy=function(t,e,r,n,i){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=r,this.fontStack=n,this.textColor=i},uy=function(t){this.sections=t};uy.fromString=function(t){return new uy([new sy(t,null,null,null,null)])},uy.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},uy.factory=function(t){return t instanceof uy?t:uy.fromString(t)},uy.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},uy.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];if(n.image)t.push(["image",n.image.name]);else{t.push(n.text);var i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(i)}}return t};var ly=function(t){this.name=t.name,this.available=t.available};function cy(t,e,r,n){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value ["+[t,e,r,n].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof n?[t,e,r,n]:[t,e,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function fy(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Mp)return!0;if(t instanceof ay)return!0;if(t instanceof uy)return!0;if(t instanceof ly)return!0;if(Array.isArray(t)){for(var e=0,r=t;e<r.length;e+=1){if(!fy(r[e]))return!1}return!0}if("object"===Sp(t)){for(var n in t)if(!fy(t[n]))return!1;return!0}return!1}function hy(t){if(null===t)return qp;if("string"==typeof t)return Vp;if("boolean"==typeof t)return Zp;if("number"==typeof t)return Np;if(t instanceof Mp)return Up;if(t instanceof ay)return Jp;if(t instanceof uy)return $p;if(t instanceof ly)return Qp;if(Array.isArray(t)){for(var e,r=t.length,n=0,i=t;n<i.length;n+=1){var o=hy(i[n]);if(e){if(e===o)continue;e=Hp;break}e=o}return ty(e||Hp,r)}return Kp}function py(t){var e=Sp(t);return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Mp||t instanceof uy||t instanceof ly?t.toString():JSON.stringify(t)}ly.prototype.toString=function(){return this.name},ly.fromString=function(t){return t?new ly({name:t,available:!1}):null},ly.prototype.serialize=function(){return["image",this.name]};var yy=function(t,e){this.type=t,this.value=e};yy.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!fy(t[1]))return e.error("invalid value");var r=t[1],n=hy(r),i=e.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new yy(n,r)},yy.prototype.evaluate=function(){return this.value},yy.prototype.eachChild=function(){},yy.prototype.outputDefined=function(){return!0},yy.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Mp?["rgba"].concat(this.value.toArray()):this.value instanceof uy?this.value.serialize():this.value};var dy=function(t){this.name="ExpressionEvaluationError",this.message=t};dy.prototype.toJSON=function(){return this.message};var vy={string:Vp,number:Np,boolean:Zp,object:Kp},gy=function(t,e){this.type=t,this.args=e};gy.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r,n=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in vy)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=vy[s],n++}else o=Hp;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],n++}r=ty(o,a)}else r=vy[i];for(var u=[];n<t.length;n++){var l=e.parse(t[n],n,Hp);if(!l)return null;u.push(l)}return new gy(r,u)},gy.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var r=this.args[e].evaluate(t);if(!ny(this.type,hy(r)))return r;if(e===this.args.length-1)throw new dy("Expected value to be of type "+ey(this.type)+", but found "+ey(hy(r))+" instead.")}return null},gy.prototype.eachChild=function(t){this.args.forEach(t)},gy.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},gy.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var r=t.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){e.push(r.kind);var n=t.N;("number"==typeof n||this.args.length>1)&&e.push(n)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var my=function(t){this.type=$p,this.sections=t};my.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[1];if(!Array.isArray(r)&&"object"===Sp(r))return e.error("First argument must be an image or text section.");for(var n=[],i=!1,o=1;o<=t.length-1;++o){var a=t[o];if(i&&"object"===Sp(a)&&!Array.isArray(a)){i=!1;var s=null;if(a["font-scale"]&&!(s=e.parse(a["font-scale"],1,Np)))return null;var u=null;if(a["text-font"]&&!(u=e.parse(a["text-font"],1,ty(Vp))))return null;var l=null;if(a["text-color"]&&!(l=e.parse(a["text-color"],1,Up)))return null;var c=n[n.length-1];c.scale=s,c.font=u,c.textColor=l}else{var f=e.parse(t[o],1,Hp);if(!f)return null;var h=f.type.kind;if("string"!==h&&"value"!==h&&"null"!==h&&"resolvedImage"!==h)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:f,scale:null,font:null,textColor:null})}}return new my(n)},my.prototype.evaluate=function(t){return new uy(this.sections.map((function(e){var r=e.content.evaluate(t);return hy(r)===Qp?new sy("",r,null,null,null):new sy(py(r),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},my.prototype.eachChild=function(t){for(var e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}},my.prototype.outputDefined=function(){return!1},my.prototype.serialize=function(){for(var t=["format"],e=0,r=this.sections;e<r.length;e+=1){var n=r[e];t.push(n.content.serialize());var i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),t.push(i)}return t};var by=function(t){this.type=Qp,this.input=t};by.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Vp);return r?new by(r):e.error("No image name provided.")},by.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=ly.fromString(e);return r&&t.availableImages&&(r.available=t.availableImages.indexOf(e)>-1),r},by.prototype.eachChild=function(t){t(this.input)},by.prototype.outputDefined=function(){return!1},by.prototype.serialize=function(){return["image",this.input.serialize()]};var _y={"to-boolean":Zp,"to-color":Up,"to-number":Np,"to-string":Vp},xy=function(t,e){this.type=t,this.args=e};xy.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var r=t[0];if(("to-boolean"===r||"to-string"===r)&&2!==t.length)return e.error("Expected one argument.");for(var n=_y[r],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Hp);if(!a)return null;i.push(a)}return new xy(n,i)},xy.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,r,n=0,i=this.args;n<i.length;n+=1){if(r=null,(e=i[n].evaluate(t))instanceof Mp)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(r=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":cy(e[0],e[1],e[2],e[3])))return new Mp(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new dy(r||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var l=Number(a);if(!isNaN(l))return l}throw new dy("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?uy.fromString(py(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?ly.fromString(py(this.args[0].evaluate(t))):py(this.args[0].evaluate(t))},xy.prototype.eachChild=function(t){this.args.forEach(t)},xy.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},xy.prototype.serialize=function(){if("formatted"===this.type.kind)return new my([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new by(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var wy=["Unknown","Point","LineString","Polygon"],ky=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null};ky.prototype.id=function(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null},ky.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?wy[this.feature.type]:this.feature.type:null},ky.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ky.prototype.canonicalID=function(){return this.canonical},ky.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ky.prototype.distanceFromCenter=function(){if(this.featureTileCoord&&this.featureDistanceData){var t=this.featureDistanceData.center,e=this.featureDistanceData.scale,r=this.featureTileCoord,n=r.x,i=r.y,o=n*e-t[0],a=i*e-t[1];return this.featureDistanceData.bearing[0]*o+this.featureDistanceData.bearing[1]*a}return 0},ky.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Mp.parse(t)),e};var Sy=function(t,e,r,n){this.name=t,this.type=e,this._evaluate=r,this.args=n};Sy.prototype.evaluate=function(t){return this._evaluate(t,this.args)},Sy.prototype.eachChild=function(t){this.args.forEach(t)},Sy.prototype.outputDefined=function(){return!1},Sy.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},Sy.parse=function(t,e){var r,n=t[0],i=Sy.definitions[n];if(!i)return e.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var r=e[0];return!Array.isArray(r)||r.length===t.length-1})),u=null,l=0,c=s;l<c.length;l+=1){var f=c[l],h=f[0],p=f[1];u=new Uy(e.registry,e.path,null,e.scope);for(var y=[],d=!1,v=1;v<t.length;v++){var g=t[v],m=Array.isArray(h)?h[v-1]:h.type,b=u.parse(g,1+y.length,m);if(!b){d=!0;break}y.push(b)}if(!d)if(Array.isArray(h)&&h.length!==y.length)u.error("Expected "+h.length+" arguments, but found "+y.length+" instead.");else{for(var _=0;_<y.length;_++){var x=Array.isArray(h)?h[_]:h.type,w=y[_];u.concat(_+1).checkSubtype(x,w.type)}if(0===u.errors.length)return new Sy(n,o,p,y)}}if(1===s.length)(r=e.errors).push.apply(r,u.errors);else{for(var k=(s.length?s:a).map((function(t){var e,r=t[0];return e=r,Array.isArray(e)?"("+e.map(ey).join(", ")+")":"("+ey(e.type)+"...)"})).join(" | "),S=[],O=1;O<t.length;O++){var T=e.parse(t[O],1+S.length);if(!T)return null;S.push(ey(T.type))}e.error("Expected arguments of type "+k+", but found ("+S.join(", ")+") instead.")}return null},Sy.register=function(t,e){for(var r in Sy.definitions=e,e)t[r]=Sy};var Oy=function(t,e,r){this.type=Jp,this.locale=r,this.caseSensitive=t,this.diacriticSensitive=e};Oy.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var r=t[1];if("object"!==Sp(r)||Array.isArray(r))return e.error("Collator options argument must be an object.");var n=e.parse(void 0!==r["case-sensitive"]&&r["case-sensitive"],1,Zp);if(!n)return null;var i=e.parse(void 0!==r["diacritic-sensitive"]&&r["diacritic-sensitive"],1,Zp);if(!i)return null;var o=null;return r.locale&&!(o=e.parse(r.locale,1,Vp))?null:new Oy(n,i,o)},Oy.prototype.evaluate=function(t){return new ay(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},Oy.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},Oy.prototype.outputDefined=function(){return!1},Oy.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var Ty=8192;function Cy(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Py(t,e){return!(t[0]<=e[0])&&(!(t[2]>=e[2])&&(!(t[1]<=e[1])&&!(t[3]>=e[3])))}function Ry(t,e){var r,n=(180+t[0])/360,i=(r=t[1],(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360),o=Math.pow(2,e.z);return[Math.round(n*o*Ty),Math.round(i*o*Ty)]}function jy(t,e,r){var n=t[0]-e[0],i=t[1]-e[1],o=t[0]-r[0],a=t[1]-r[1];return n*a-o*i==0&&n*o<=0&&i*a<=0}function Ey(t,e,r){return e[1]>t[1]!=r[1]>t[1]&&t[0]<(r[0]-e[0])*(t[1]-e[1])/(r[1]-e[1])+e[0]}function My(t,e){for(var r=!1,n=0,i=e.length;n<i;n++)for(var o=e[n],a=0,s=o.length;a<s-1;a++){if(jy(t,o[a],o[a+1]))return!1;Ey(t,o[a],o[a+1])&&(r=!r)}return r}function Fy(t,e){for(var r=0;r<e.length;r++)if(My(t,e[r]))return!0;return!1}function Iy(t,e,r,n){var i=t[0]-r[0],o=t[1]-r[1],a=e[0]-r[0],s=e[1]-r[1],u=n[0]-r[0],l=n[1]-r[1],c=i*l-u*o,f=a*l-u*s;return c>0&&f<0||c<0&&f>0}function Dy(t,e,r){for(var n=0,i=r;n<i.length;n+=1)for(var o=i[n],a=0;a<o.length-1;++a)if(s=t,u=e,l=o[a],c=o[a+1],f=void 0,h=void 0,p=void 0,y=void 0,p=[u[0]-s[0],u[1]-s[1]],y=[c[0]-l[0],c[1]-l[1]],0!=(f=y)[0]*(h=p)[1]-f[1]*h[0]&&Iy(s,u,l,c)&&Iy(l,c,s,u))return!0;var s,u,l,c,f,h,p,y;return!1}function zy(t,e){for(var r=0;r<t.length;++r)if(!My(t[r],e))return!1;for(var n=0;n<t.length-1;++n)if(Dy(t[n],t[n+1],e))return!1;return!0}function Ay(t,e){for(var r=0;r<e.length;r++)if(zy(t,e[r]))return!0;return!1}function Ly(t,e,r){for(var n=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=Ry(t[i][a],r);Cy(e,s),o.push(s)}n.push(o)}return n}function Gy(t,e,r){for(var n=[],i=0;i<t.length;i++){var o=Ly(t[i],e,r);n.push(o)}return n}function By(t,e,r,n){if(t[0]<r[0]||t[0]>r[2]){var i=.5*n,o=t[0]-r[0]>i?-n:r[0]-t[0]>i?n:0;0===o&&(o=t[0]-r[2]>i?-n:r[2]-t[0]>i?n:0),t[0]+=o}Cy(e,t)}function Wy(t,e,r,n){var i=Math.pow(2,n.z)*Ty,o=[n.x*Ty,n.y*Ty],a=[];if(!t)return a;for(var s=0,u=t;s<u.length;s+=1)for(var l=0,c=u[s];l<c.length;l+=1){var f=c[l],h=[f.x+o[0],f.y+o[1]];By(h,e,r,i),a.push(h)}return a}function Xy(t,e,r,n){var i,o=Math.pow(2,n.z)*Ty,a=[n.x*Ty,n.y*Ty],s=[];if(!t)return s;for(var u=0,l=t;u<l.length;u+=1){for(var c=[],f=0,h=l[u];f<h.length;f+=1){var p=h[f],y=[p.x+a[0],p.y+a[1]];Cy(e,y),c.push(y)}s.push(c)}if(e[2]-e[0]<=o/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var d=0,v=s;d<v.length;d+=1)for(var g=0,m=v[d];g<m.length;g+=1){By(m[g],e,r,o)}}return s}var Yy=function(t,e){this.type=Zp,this.geojson=t,this.geometries=e};function qy(t){if(t instanceof Sy){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Yy)return!1;var e=!0;return t.eachChild((function(t){e&&!qy(t)&&(e=!1)})),e}function Ny(t){if(t instanceof Sy&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Ny(t)&&(e=!1)})),e}function Vy(t,e){if(t instanceof Sy&&e.indexOf(t.name)>=0)return!1;var r=!0;return t.eachChild((function(t){r&&!Vy(t,e)&&(r=!1)})),r}Yy.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(fy(t[1])){var r=t[1];if("FeatureCollection"===r.type)for(var n=0;n<r.features.length;++n){var i=r.features[n].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new Yy(r,r.features[n].geometry)}else if("Feature"===r.type){var o=r.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new Yy(r,r.geometry)}else if("Polygon"===r.type||"MultiPolygon"===r.type)return new Yy(r,r)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Yy.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===e.type){var o=Ly(e.coordinates,n,i),a=Wy(t.geometry(),r,n,i);if(!Py(r,n))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!My(u[s],o))return!1}if("MultiPolygon"===e.type){var l=Gy(e.coordinates,n,i),c=Wy(t.geometry(),r,n,i);if(!Py(r,n))return!1;for(var f=0,h=c;f<h.length;f+=1)if(!Fy(h[f],l))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===e.type){var o=Ly(e.coordinates,n,i),a=Xy(t.geometry(),r,n,i);if(!Py(r,n))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!zy(u[s],o))return!1}if("MultiPolygon"===e.type){var l=Gy(e.coordinates,n,i),c=Xy(t.geometry(),r,n,i);if(!Py(r,n))return!1;for(var f=0,h=c;f<h.length;f+=1)if(!Ay(h[f],l))return!1}return!0}(t,this.geometries)}return!1},Yy.prototype.eachChild=function(){},Yy.prototype.outputDefined=function(){return!0},Yy.prototype.serialize=function(){return["within",this.geojson]};var Zy=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};Zy.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var r=t[1];return e.scope.has(r)?new Zy(r,e.scope.get(r)):e.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Zy.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},Zy.prototype.eachChild=function(){},Zy.prototype.outputDefined=function(){return!1},Zy.prototype.serialize=function(){return["var",this.name]};var Uy=function(t,e,r,n,i){void 0===e&&(e=[]),void 0===n&&(n=new Yp),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=n,this.errors=i,this.expectedType=r};function Ky(t){if(t instanceof Zy)return Ky(t.boundExpression);if(t instanceof Sy&&"error"===t.name)return!1;if(t instanceof Oy)return!1;if(t instanceof Yy)return!1;var e=t instanceof xy||t instanceof gy,r=!0;return t.eachChild((function(t){r=e?r&&Ky(t):r&&t instanceof yy})),!!r&&(qy(t)&&Vy(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function Hy(t,e){for(var r,n,i=t.length-1,o=0,a=i,s=0;o<=a;)if(r=t[s=Math.floor((o+a)/2)],n=t[s+1],r<=e){if(s===i||e<n)return s;o=s+1}else{if(!(r>e))throw new dy("Input is not a number.");a=s-1}return 0}Uy.prototype.parse=function(t,e,r,n,i){return void 0===i&&(i={}),e?this.concat(e,r,n)._parse(t,i):this._parse(t,i)},Uy.prototype._parse=function(t,e){function r(t,e,r){return"assert"===r?new gy(e,[t]):"coerce"===r?new xy(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var n=t[0];if("string"!=typeof n)return this.error("Expression name must be a string, but found "+Sp(n)+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[n];if(i){var o=i.parse(t,this);if(!o)return null;if(this.expectedType){var a=this.expectedType,s=o.type;if("string"!==a.kind&&"number"!==a.kind&&"boolean"!==a.kind&&"object"!==a.kind&&"array"!==a.kind||"value"!==s.kind)if("color"!==a.kind&&"formatted"!==a.kind&&"resolvedImage"!==a.kind||"value"!==s.kind&&"string"!==s.kind){if(this.checkSubtype(a,s))return null}else o=r(o,a,e.typeAnnotation||"coerce");else o=r(o,a,e.typeAnnotation||"assert")}if(!(o instanceof yy)&&"resolvedImage"!==o.type.kind&&Ky(o)){var u=new ky;try{o=new yy(o.type,o.evaluate(u))}catch(t){return this.error(t.message),null}}return o}return this.error('Unknown expression "'+n+'". If you wanted a literal array, use ["literal", [...]].',0)}return void 0===t?this.error("'undefined' value invalid. Use null instead."):"object"===Sp(t)?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error("Expected an array, but found "+Sp(t)+" instead.")},Uy.prototype.concat=function(t,e,r){var n="number"==typeof t?this.path.concat(t):this.path,i=r?this.scope.concat(r):this.scope;return new Uy(this.registry,n,e||null,i,this.errors)},Uy.prototype.error=function(t){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var n=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Xp(n,t))},Uy.prototype.checkSubtype=function(t,e){var r=ny(t,e);return r&&this.error(r),r};var Jy=function(t,e,r){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var n=0,i=r;n<i.length;n+=1){var o=i[n],a=o[0],s=o[1];this.labels.push(a),this.outputs.push(s)}};Jy.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var r=e.parse(t[1],1,Np);if(!r)return null;var n=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,l=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(n.length&&n[n.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var c=e.parse(s,l,i);if(!c)return null;i=i||c.type,n.push([a,c])}return new Jy(i,r,n)},Jy.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;return n>=e[i-1]?r[i-1].evaluate(t):r[Hy(e,n)].evaluate(t)},Jy.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1){t(r[e])}},Jy.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Jy.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var $y=Qy;function Qy(t,e,r,n){this.cx=3*t,this.bx=3*(r-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(n-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=r,this.p2y=n}function td(t,e,r){return t*(1-r)+e*r}Qy.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},Qy.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},Qy.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},Qy.prototype.solveCurveX=function(t,e){var r,n,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(r=0))return r;if(i>(n=1))return n;for(;r<n;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?r=i:n=i,i=.5*(n-r)+r}return i},Qy.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var ed=Object.freeze({__proto__:null,number:td,color:function(t,e,r){return new Mp(td(t.r,e.r,r),td(t.g,e.g,r),td(t.b,e.b,r),td(t.a,e.a,r))},array:function(t,e,r){return t.map((function(t,n){return td(t,e[n],r)}))}}),rd=.95047,nd=1.08883,id=4/29,od=6/29,ad=3*od*od,sd=Math.PI/180,ud=180/Math.PI;function ld(t){return t>.008856451679035631?Math.pow(t,1/3):t/ad+id}function cd(t){return t>od?t*t*t:ad*(t-id)}function fd(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function hd(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function pd(t){var e=hd(t.r),r=hd(t.g),n=hd(t.b),i=ld((.4124564*e+.3575761*r+.1804375*n)/rd),o=ld((.2126729*e+.7151522*r+.072175*n)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-ld((.0193339*e+.119192*r+.9503041*n)/nd)),alpha:t.a}}function yd(t){var e=(t.l+16)/116,r=isNaN(t.a)?e:e+t.a/500,n=isNaN(t.b)?e:e-t.b/200;return e=1*cd(e),r=rd*cd(r),n=nd*cd(n),new Mp(fd(3.2404542*r-1.5371385*e-.4985314*n),fd(-.969266*r+1.8760108*e+.041556*n),fd(.0556434*r-.2040259*e+1.0572252*n),t.alpha)}function dd(t,e,r){var n=e-t;return t+r*(n>180||n<-180?n-360*Math.round(n/360):n)}var vd={forward:pd,reverse:yd,interpolate:function(t,e,r){return{l:td(t.l,e.l,r),a:td(t.a,e.a,r),b:td(t.b,e.b,r),alpha:td(t.alpha,e.alpha,r)}}},gd={forward:function(t){var e=pd(t),r=e.l,n=e.a,i=e.b,o=Math.atan2(i,n)*ud;return{h:o<0?o+360:o,c:Math.sqrt(n*n+i*i),l:r,alpha:t.a}},reverse:function(t){var e=t.h*sd,r=t.c;return yd({l:t.l,a:Math.cos(e)*r,b:Math.sin(e)*r,alpha:t.alpha})},interpolate:function(t,e,r){return{h:dd(t.h,e.h,r),c:td(t.c,e.c,r),l:td(t.l,e.l,r),alpha:td(t.alpha,e.alpha,r)}}},md=function(t,e,r,n,i){this.type=t,this.operator=e,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[0],l=s[1];this.labels.push(u),this.outputs.push(l)}};function bd(t,e,r,n){var i=n-r,o=t-r;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}md.interpolationFactor=function(t,e,r,n){var i=0;if("exponential"===t.name)i=bd(e,t.base,r,n);else if("linear"===t.name)i=bd(e,1,r,n);else if("cubic-bezier"===t.name){var o=t.controlPoints;i=new $y(o[0],o[1],o[2],o[3]).solve(bd(e,1,r,n))}return i},md.parse=function(t,e){var r=t[0],n=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(n)||0===n.length)return e.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){var a=n[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:a}}else{if("cubic-bezier"!==n[0])return e.error("Unknown interpolation type "+String(n[0]),1,0);var s=n.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Np)))return null;var u=[],l=null;"interpolate-hcl"===r||"interpolate-lab"===r?l=Up:e.expectedType&&"value"!==e.expectedType.kind&&(l=e.expectedType);for(var c=0;c<o.length;c+=2){var f=o[c],h=o[c+1],p=c+3,y=c+4;if("number"!=typeof f)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(u.length&&u[u.length-1][0]>=f)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);var d=e.parse(h,y,l);if(!d)return null;l=l||d.type,u.push([f,d])}return"number"===l.kind||"color"===l.kind||"array"===l.kind&&"number"===l.itemType.kind&&"number"==typeof l.N?new md(l,r,n,i,u):e.error("Type "+ey(l)+" is not interpolatable.")},md.prototype.evaluate=function(t){var e=this.labels,r=this.outputs;if(1===e.length)return r[0].evaluate(t);var n=this.input.evaluate(t);if(n<=e[0])return r[0].evaluate(t);var i=e.length;if(n>=e[i-1])return r[i-1].evaluate(t);var o=Hy(e,n),a=e[o],s=e[o+1],u=md.interpolationFactor(this.interpolation,n,a,s),l=r[o].evaluate(t),c=r[o+1].evaluate(t);return"interpolate"===this.operator?ed[this.type.kind.toLowerCase()](l,c,u):"interpolate-hcl"===this.operator?gd.reverse(gd.interpolate(gd.forward(l),gd.forward(c),u)):vd.reverse(vd.interpolate(vd.forward(l),vd.forward(c),u))},md.prototype.eachChild=function(t){t(this.input);for(var e=0,r=this.outputs;e<r.length;e+=1){t(r[e])}},md.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},md.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],r=0;r<this.labels.length;r++)e.push(this.labels[r],this.outputs[r].serialize());return e};var _d=function(t,e){this.type=t,this.args=e};_d.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var r=null,n=e.expectedType;n&&"value"!==n.kind&&(r=n);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=a[o],u=e.parse(s,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!u)return null;r=r||u.type,i.push(u)}var l=n&&i.some((function(t){return ny(n,t.type)}));return new _d(l?Hp:r,i)},_d.prototype.evaluate=function(t){for(var e,r=null,n=0,i=0,o=this.args;i<o.length;i+=1){if(n++,(r=o[i].evaluate(t))&&r instanceof ly&&!r.available&&(e||(e=r),r=null,n===this.args.length))return e;if(null!==r)break}return r},_d.prototype.eachChild=function(t){this.args.forEach(t)},_d.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},_d.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var xd=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};xd.prototype.evaluate=function(t){return this.result.evaluate(t)},xd.prototype.eachChild=function(t){for(var e=0,r=this.bindings;e<r.length;e+=1){t(r[e][1])}t(this.result)},xd.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var r=[],n=1;n<t.length-1;n+=2){var i=t[n];if("string"!=typeof i)return e.error("Expected string, but found "+Sp(i)+" instead.",n);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",n);var o=e.parse(t[n+1],n+1);if(!o)return null;r.push([i,o])}var a=e.parse(t[t.length-1],t.length-1,e.expectedType,r);return a?new xd(r,a):null},xd.prototype.outputDefined=function(){return this.result.outputDefined()},xd.prototype.serialize=function(){for(var t=["let"],e=0,r=this.bindings;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];t.push(i,o.serialize())}return t.push(this.result.serialize()),t};var wd=function(t,e,r){this.type=t,this.index=e,this.input=r};wd.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Np),n=e.parse(t[2],2,ty(e.expectedType||Hp));if(!r||!n)return null;var i=n.type;return new wd(i.itemType,r,n)},wd.prototype.evaluate=function(t){var e=this.index.evaluate(t),r=this.input.evaluate(t);if(e<0)throw new dy("Array index out of bounds: "+e+" < 0.");if(e>=r.length)throw new dy("Array index out of bounds: "+e+" > "+(r.length-1)+".");if(e!==Math.floor(e))throw new dy("Array index must be an integer, but found "+e+" instead.");return r[e]},wd.prototype.eachChild=function(t){t(this.index),t(this.input)},wd.prototype.outputDefined=function(){return!1},wd.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var kd=function(t,e){this.type=Zp,this.needle=t,this.haystack=e};kd.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Hp),n=e.parse(t[2],2,Hp);return r&&n?iy(r.type,[Zp,Vp,Np,qp,Hp])?new kd(r,n):e.error("Expected first argument to be of type boolean, string, number or null, but found "+ey(r.type)+" instead"):null},kd.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(null==r)return!1;if(!oy(e,["boolean","string","number","null"]))throw new dy("Expected first argument to be of type boolean, string, number or null, but found "+ey(hy(e))+" instead.");if(!oy(r,["string","array"]))throw new dy("Expected second argument to be of type array or string, but found "+ey(hy(r))+" instead.");return r.indexOf(e)>=0},kd.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},kd.prototype.outputDefined=function(){return!0},kd.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var Sd=function(t,e,r){this.type=Np,this.needle=t,this.haystack=e,this.fromIndex=r};Sd.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Hp),n=e.parse(t[2],2,Hp);if(!r||!n)return null;if(!iy(r.type,[Zp,Vp,Np,qp,Hp]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+ey(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Np);return i?new Sd(r,n,i):null}return new Sd(r,n)},Sd.prototype.evaluate=function(t){var e=this.needle.evaluate(t),r=this.haystack.evaluate(t);if(!oy(e,["boolean","string","number","null"]))throw new dy("Expected first argument to be of type boolean, string, number or null, but found "+ey(hy(e))+" instead.");if(!oy(r,["string","array"]))throw new dy("Expected second argument to be of type array or string, but found "+ey(hy(r))+" instead.");if(this.fromIndex){var n=this.fromIndex.evaluate(t);return r.indexOf(e,n)}return r.indexOf(e)},Sd.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},Sd.prototype.outputDefined=function(){return!1},Sd.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Od=function(t,e,r,n,i,o){this.inputType=t,this.type=e,this.input=r,this.cases=n,this.outputs=i,this.otherwise=o};Od.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var r,n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var l=e.concat(a);if(0===s.length)return l.error("Expected at least one branch label.");for(var c=0,f=s;c<f.length;c+=1){var h=f[c];if("number"!=typeof h&&"string"!=typeof h)return l.error("Branch labels must be numbers or strings.");if("number"==typeof h&&Math.abs(h)>Number.MAX_SAFE_INTEGER)return l.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof h&&Math.floor(h)!==h)return l.error("Numeric branch labels must be integer values.");if(r){if(l.checkSubtype(r,hy(h)))return null}else r=hy(h);if(void 0!==i[String(h)])return l.error("Branch labels must be unique.");i[String(h)]=o.length}var p=e.parse(u,a,n);if(!p)return null;n=n||p.type,o.push(p)}var y=e.parse(t[1],1,Hp);if(!y)return null;var d=e.parse(t[t.length-1],t.length-1,n);return d?"value"!==y.type.kind&&e.concat(1).checkSubtype(r,y.type)?null:new Od(r,n,y,i,o,d):null},Od.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(hy(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},Od.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},Od.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},Od.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],r=[],n={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(f=n[this.cases[a]])?(n[this.cases[a]]=r.length,r.push([this.cases[a],[a]])):r[f][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,l=r;u<l.length;u+=1){var c=l[u],f=c[0],h=c[1];1===h.length?e.push(s(h[0])):e.push(h.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var Td=function(t,e,r){this.type=t,this.branches=e,this.otherwise=r};Td.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var n=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,Zp);if(!o)return null;var a=e.parse(t[i+1],i+1,r);if(!a)return null;n.push([o,a]),r=r||a.type}var s=e.parse(t[t.length-1],t.length-1,r);return s?new Td(r,n,s):null},Td.prototype.evaluate=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];if(i.evaluate(t))return o.evaluate(t)}return this.otherwise.evaluate(t)},Td.prototype.eachChild=function(t){for(var e=0,r=this.branches;e<r.length;e+=1){var n=r[e],i=n[0],o=n[1];t(i),t(o)}t(this.otherwise)},Td.prototype.outputDefined=function(){return this.branches.every((function(t){return t[0],t[1].outputDefined()}))&&this.otherwise.outputDefined()},Td.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Cd=function(t,e,r,n){this.type=t,this.input=e,this.beginIndex=r,this.endIndex=n};function Pd(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Rd(t,e,r,n){return 0===n.compare(e,r)}function jd(t,e,r){var n="=="!==t&&"!="!==t;return function(){function i(t,e,r){this.type=Zp,this.lhs=t,this.rhs=e,this.collator=r,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var r=t[0],o=e.parse(t[1],1,Hp);if(!o)return null;if(!Pd(r,o.type))return e.concat(1).error('"'+r+"\" comparisons are not supported for type '"+ey(o.type)+"'.");var a=e.parse(t[2],2,Hp);if(!a)return null;if(!Pd(r,a.type))return e.concat(2).error('"'+r+"\" comparisons are not supported for type '"+ey(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+ey(o.type)+"' and '"+ey(a.type)+"'.");n&&("value"===o.type.kind&&"value"!==a.type.kind?o=new gy(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new gy(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Jp)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){var s=hy(o),u=hy(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new dy('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!n&&this.hasUntypedArgument){var l=hy(o),c=hy(a);if("string"!==l.kind||"string"!==c.kind)return e(i,o,a)}return this.collator?r(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}Cd.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1,Hp),n=e.parse(t[2],2,Np);if(!r||!n)return null;if(!iy(r.type,[ty(Hp),Vp,Hp]))return e.error("Expected first argument to be of type array or string, but found "+ey(r.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Np);return i?new Cd(r.type,r,n,i):null}return new Cd(r.type,r,n)},Cd.prototype.evaluate=function(t){var e=this.input.evaluate(t),r=this.beginIndex.evaluate(t);if(!oy(e,["string","array"]))throw new dy("Expected first argument to be of type array or string, but found "+ey(hy(e))+" instead.");if(this.endIndex){var n=this.endIndex.evaluate(t);return e.slice(r,n)}return e.slice(r)},Cd.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},Cd.prototype.outputDefined=function(){return!1},Cd.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var Ed=jd("==",(function(t,e,r){return e===r}),Rd),Md=jd("!=",(function(t,e,r){return e!==r}),(function(t,e,r,n){return!Rd(0,e,r,n)})),Fd=jd("<",(function(t,e,r){return e<r}),(function(t,e,r,n){return n.compare(e,r)<0})),Id=jd(">",(function(t,e,r){return e>r}),(function(t,e,r,n){return n.compare(e,r)>0})),Dd=jd("<=",(function(t,e,r){return e<=r}),(function(t,e,r,n){return n.compare(e,r)<=0})),zd=jd(">=",(function(t,e,r){return e>=r}),(function(t,e,r,n){return n.compare(e,r)>=0})),Ad=function(t,e,r,n,i){this.type=Vp,this.number=t,this.locale=e,this.currency=r,this.minFractionDigits=n,this.maxFractionDigits=i};Ad.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var r=e.parse(t[1],1,Np);if(!r)return null;var n=t[2];if("object"!==Sp(n)||Array.isArray(n))return e.error("NumberFormat options argument must be an object.");var i=null;if(n.locale&&!(i=e.parse(n.locale,1,Vp)))return null;var o=null;if(n.currency&&!(o=e.parse(n.currency,1,Vp)))return null;var a=null;if(n["min-fraction-digits"]&&!(a=e.parse(n["min-fraction-digits"],1,Np)))return null;var s=null;return n["max-fraction-digits"]&&!(s=e.parse(n["max-fraction-digits"],1,Np))?null:new Ad(r,i,o,a,s)},Ad.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Ad.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Ad.prototype.outputDefined=function(){return!1},Ad.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Ld=function(t){this.type=Np,this.input=t};Ld.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var r=e.parse(t[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?e.error("Expected argument of type string or array, but found "+ey(r.type)+" instead."):new Ld(r):null},Ld.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new dy("Expected value to be of type string or array, but found "+ey(hy(e))+" instead.")},Ld.prototype.eachChild=function(t){t(this.input)},Ld.prototype.outputDefined=function(){return!1},Ld.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var Gd={"==":Ed,"!=":Md,">":Id,"<":Fd,">=":zd,"<=":Dd,array:gy,at:wd,boolean:gy,case:Td,coalesce:_d,collator:Oy,format:my,image:by,in:kd,"index-of":Sd,interpolate:md,"interpolate-hcl":md,"interpolate-lab":md,length:Ld,let:xd,literal:yy,match:Od,number:gy,"number-format":Ad,object:gy,slice:Cd,step:Jy,string:gy,"to-boolean":xy,"to-color":xy,"to-number":xy,"to-string":xy,var:Zy,within:Yy};function Bd(t,e){var r=e[0],n=e[1],i=e[2],o=e[3];r=r.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=cy(r,n,i,a);if(s)throw new dy(s);return new Mp(r/255*a,n/255*a,i/255*a,a)}function Wd(t,e){return t in e}function Xd(t,e){var r=e[t];return void 0===r?null:r}function Yd(t){return{type:t}}function qd(t){return{result:"success",value:t}}function Nd(t){return{result:"error",value:t}}function Vd(t){return"object"===Sp(t)&&null!==t&&!Array.isArray(t)}Sy.register(Gd,{error:[{kind:"error"},[Vp],function(t,e){var r=e[0];throw new dy(r.evaluate(t))}],typeof:[Vp,[Hp],function(t,e){return ey(hy(e[0].evaluate(t)))}],"to-rgba":[ty(Np,4),[Up],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Up,[Np,Np,Np],Bd],rgba:[Up,[Np,Np,Np,Np],Bd],has:{type:Zp,overloads:[[[Vp],function(t,e){return Wd(e[0].evaluate(t),t.properties())}],[[Vp,Kp],function(t,e){var r=e[0],n=e[1];return Wd(r.evaluate(t),n.evaluate(t))}]]},get:{type:Hp,overloads:[[[Vp],function(t,e){return Xd(e[0].evaluate(t),t.properties())}],[[Vp,Kp],function(t,e){var r=e[0],n=e[1];return Xd(r.evaluate(t),n.evaluate(t))}]]},"feature-state":[Hp,[Vp],function(t,e){return Xd(e[0].evaluate(t),t.featureState||{})}],properties:[Kp,[],function(t){return t.properties()}],"geometry-type":[Vp,[],function(t){return t.geometryType()}],id:[Hp,[],function(t){return t.id()}],zoom:[Np,[],function(t){return t.globals.zoom}],pitch:[Np,[],function(t){return t.globals.pitch||0}],"distance-from-center":[Np,[],function(t){return t.distanceFromCenter()}],"heatmap-density":[Np,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Np,[],function(t){return t.globals.lineProgress||0}],"sky-radial-progress":[Np,[],function(t){return t.globals.skyRadialProgress||0}],accumulated:[Hp,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Np,Yd(Np),function(t,e){for(var r=0,n=0,i=e;n<i.length;n+=1){r+=i[n].evaluate(t)}return r}],"*":[Np,Yd(Np),function(t,e){for(var r=1,n=0,i=e;n<i.length;n+=1){r*=i[n].evaluate(t)}return r}],"-":{type:Np,overloads:[[[Np,Np],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)-n.evaluate(t)}],[[Np],function(t,e){return-e[0].evaluate(t)}]]},"/":[Np,[Np,Np],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)/n.evaluate(t)}],"%":[Np,[Np,Np],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)%n.evaluate(t)}],ln2:[Np,[],function(){return Math.LN2}],pi:[Np,[],function(){return Math.PI}],e:[Np,[],function(){return Math.E}],"^":[Np,[Np,Np],function(t,e){var r=e[0],n=e[1];return Math.pow(r.evaluate(t),n.evaluate(t))}],sqrt:[Np,[Np],function(t,e){var r=e[0];return Math.sqrt(r.evaluate(t))}],log10:[Np,[Np],function(t,e){var r=e[0];return Math.log(r.evaluate(t))/Math.LN10}],ln:[Np,[Np],function(t,e){var r=e[0];return Math.log(r.evaluate(t))}],log2:[Np,[Np],function(t,e){var r=e[0];return Math.log(r.evaluate(t))/Math.LN2}],sin:[Np,[Np],function(t,e){var r=e[0];return Math.sin(r.evaluate(t))}],cos:[Np,[Np],function(t,e){var r=e[0];return Math.cos(r.evaluate(t))}],tan:[Np,[Np],function(t,e){var r=e[0];return Math.tan(r.evaluate(t))}],asin:[Np,[Np],function(t,e){var r=e[0];return Math.asin(r.evaluate(t))}],acos:[Np,[Np],function(t,e){var r=e[0];return Math.acos(r.evaluate(t))}],atan:[Np,[Np],function(t,e){var r=e[0];return Math.atan(r.evaluate(t))}],min:[Np,Yd(Np),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Np,Yd(Np),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Np,[Np],function(t,e){var r=e[0];return Math.abs(r.evaluate(t))}],round:[Np,[Np],function(t,e){var r=e[0].evaluate(t);return r<0?-Math.round(-r):Math.round(r)}],floor:[Np,[Np],function(t,e){var r=e[0];return Math.floor(r.evaluate(t))}],ceil:[Np,[Np],function(t,e){var r=e[0];return Math.ceil(r.evaluate(t))}],"filter-==":[Zp,[Vp,Hp],function(t,e){var r=e[0],n=e[1];return t.properties()[r.value]===n.value}],"filter-id-==":[Zp,[Hp],function(t,e){var r=e[0];return t.id()===r.value}],"filter-type-==":[Zp,[Vp],function(t,e){var r=e[0];return t.geometryType()===r.value}],"filter-<":[Zp,[Vp,Hp],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return Sp(i)===Sp(o)&&i<o}],"filter-id-<":[Zp,[Hp],function(t,e){var r=e[0],n=t.id(),i=r.value;return Sp(n)===Sp(i)&&n<i}],"filter->":[Zp,[Vp,Hp],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return Sp(i)===Sp(o)&&i>o}],"filter-id->":[Zp,[Hp],function(t,e){var r=e[0],n=t.id(),i=r.value;return Sp(n)===Sp(i)&&n>i}],"filter-<=":[Zp,[Vp,Hp],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return Sp(i)===Sp(o)&&i<=o}],"filter-id-<=":[Zp,[Hp],function(t,e){var r=e[0],n=t.id(),i=r.value;return Sp(n)===Sp(i)&&n<=i}],"filter->=":[Zp,[Vp,Hp],function(t,e){var r=e[0],n=e[1],i=t.properties()[r.value],o=n.value;return Sp(i)===Sp(o)&&i>=o}],"filter-id->=":[Zp,[Hp],function(t,e){var r=e[0],n=t.id(),i=r.value;return Sp(n)===Sp(i)&&n>=i}],"filter-has":[Zp,[Hp],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[Zp,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[Zp,[ty(Vp)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[Zp,[ty(Hp)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[Zp,[Vp,ty(Hp)],function(t,e){var r=e[0];return e[1].value.indexOf(t.properties()[r.value])>=0}],"filter-in-large":[Zp,[Vp,ty(Hp)],function(t,e){var r=e[0],n=e[1];return function(t,e,r,n){for(;r<=n;){var i=r+n>>1;if(e[i]===t)return!0;e[i]>t?n=i-1:r=i+1}return!1}(t.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:Zp,overloads:[[[Zp,Zp],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)&&n.evaluate(t)}],[Yd(Zp),function(t,e){for(var r=0,n=e;r<n.length;r+=1){if(!n[r].evaluate(t))return!1}return!0}]]},any:{type:Zp,overloads:[[[Zp,Zp],function(t,e){var r=e[0],n=e[1];return r.evaluate(t)||n.evaluate(t)}],[Yd(Zp),function(t,e){for(var r=0,n=e;r<n.length;r+=1){if(n[r].evaluate(t))return!0}return!1}]]},"!":[Zp,[Zp],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[Zp,[Vp],function(t,e){var r=e[0],n=t.globals&&t.globals.isSupportedScript;return!n||n(r.evaluate(t))}],upcase:[Vp,[Vp],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Vp,[Vp],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Vp,Yd(Hp),function(t,e){return e.map((function(e){return py(e.evaluate(t))})).join("")}],"resolved-locale":[Vp,[Jp],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Zd=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ky,this._defaultValue=e?function(t){return"color"===t.type&&Vd(t.default)?new Mp(0,0,0,0):"color"===t.type?Mp.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function Ud(t,e){var r=new Uy(Gd,[],e?function(t){var e={color:Up,string:Vp,number:Np,enum:Vp,boolean:Zp,formatted:$p,resolvedImage:Qp};if("array"===t.type)return ty(e[t.value]||Hp,t.length);return e[t.type]}(e):void 0),n=r.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return n?qd(new Zd(n,e)):Nd(r.errors)}Zd.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o,a,s){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null,this.expression.evaluate(this._evaluator)},Zd.prototype.evaluate=function(t,e,r,n,i,o,a,s){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=s||null;try{var u=this.expression.evaluate(this._evaluator);if(null==u||"number"==typeof u&&u!=u)return this._defaultValue;if(this._enumValues&&!(u in this._enumValues))throw new dy("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(u)+" instead.");return u}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}};var Kd=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Ny(e.expression)};Kd.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},Kd.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)};var Hd=function(t,e,r,n){this.kind=t,this.zoomStops=r,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Ny(e.expression),this.interpolationType=n};function Jd(t,e){if("error"===(t=Ud(t,e)).result)return t;var r=t.value.expression,n=qy(r);if(!n&&!function(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}(e))return Nd([new Xp("","data expressions not supported")]);var i=Vy(r,["zoom","pitch","distance-from-center"]);if(!i&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(e))return Nd([new Xp("","zoom expressions not supported")]);var o=$d(r);if(!o&&!i)return Nd([new Xp("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(o instanceof Xp)return Nd([o]);if(o instanceof md&&!function(t){return!!t.expression&&t.expression.interpolated}(e))return Nd([new Xp("",'"interpolate" expressions cannot be used with this property')]);if(!o)return qd(new Kd(n?"constant":"source",t.value));var a=o instanceof md?o.interpolation:void 0;return qd(new Hd(n?"camera":"composite",t.value,o.labels,a))}function $d(t){var e=null;if(t instanceof xd)e=$d(t.result);else if(t instanceof _d)for(var r=0,n=t.args;r<n.length;r+=1){var i=n[r];if(e=$d(i))break}else(t instanceof Jy||t instanceof md)&&t.input instanceof Sy&&"zoom"===t.input.name&&(e=t);return e instanceof Xp||t.eachChild((function(t){var r=$d(t);r instanceof Xp?e=r:!e&&r?e=new Xp("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&r&&e!==r&&(e=new Xp("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),e}function Qd(t){if(Array.isArray(t))return t.map(Qd);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var r in t)e[r]=Qd(t[r]);return e}return function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}(t)}Hd.prototype.evaluateWithoutErrorHandling=function(t,e,r,n,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,r,n,i,o)},Hd.prototype.evaluate=function(t,e,r,n,i,o){return this._styleExpression.evaluate(t,e,r,n,i,o)},Hd.prototype.interpolationFactor=function(t,e,r){return this.interpolationType?md.interpolationFactor(this.interpolationType,t,e,r):0};var tv={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},projection:{type:"projection"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_symbol:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Camera"},pitch:{group:"Camera"},"distance-from-center":{group:"Camera"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},"sky-radial-progress":{group:"sky"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:.1,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},projection:{name:{type:"enum",values:{albers:{},equalEarth:{},equirectangular:{},lambertConformalConic:{},mercator:{},naturalEarth:{},winkelTripel:{}},default:"mercator",required:!0},center:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,requires:[{name:["albers","lambertConformalConic"]}]},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",transition:!1,requires:[{name:["albers","lambertConformalConic"]}]}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};function ev(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,r=t.slice(1);e<r.length;e+=1){var n=r[e];if(!ev(n)&&"boolean"!=typeof n)return!1}return!0;default:return!0}}function rv(t,e){if(void 0===e&&(e="fill"),null==t)return{filter:function(){return!0},needGeometry:!1,needFeature:!1};ev(t)||(t=lv(t));var r=t,n=!0;try{n=function(t){if(!ov(t))return t;var e=Qd(t);return iv(e),e=nv(e)}(r)}catch(t){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n"+JSON.stringify(r,null,2)+"\n        ")}var i=tv["filter_"+e],o=Ud(n,i),a=null;if("error"===o.result)throw new Error(o.value.map((function(t){return t.key+": "+t.message})).join(", "));a=function(t,e,r){return o.value.evaluate(t,e,{},r)};var s=null,u=null;if(n!==r){var l=Ud(r,i);if("error"===l.result)throw new Error(l.value.map((function(t){return t.key+": "+t.message})).join(", "));s=function(t,e,r,n,i){return l.value.evaluate(t,e,{},r,void 0,void 0,n,i)},u=!qy(l.value.expression)}return{filter:a=a,dynamicFilter:s||void 0,needGeometry:uv(n),needFeature:!!u}}function nv(t){if(!Array.isArray(t))return t;var e=function(t){if(av.has(t[0]))for(var e=1;e<t.length;e++){if(ov(t[e]))return!0}return t}(t);return!0===e?e:e.map((function(t){return nv(t)}))}function iv(t){var e=!1,r=[];if("case"===t[0]){for(var n=1;n<t.length-1;n+=2)e=e||ov(t[n]),r.push(t[n+1]);r.push(t[t.length-1])}else if("match"===t[0]){e=e||ov(t[1]);for(var i=2;i<t.length-1;i+=2)r.push(t[i+1]);r.push(t[t.length-1])}else if("step"===t[0]){e=e||ov(t[1]);for(var o=1;o<t.length-1;o+=2)r.push(t[o+1])}e&&(t.length=0,t.push.apply(t,["any"].concat(r)));for(var a=1;a<t.length;a++)iv(t[a])}function ov(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;for(var e,r=1;r<t.length;r++){if(ov(t[r]))return!0}return!1}var av=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function sv(t,e){return t<e?-1:t>e?1:0}function uv(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(var e=1;e<t.length;e++)if(uv(t[e]))return!0;return!1}function lv(t){if(!t)return!0;var e,r=t[0];return t.length<=1?"any"!==r:"=="===r?cv(t[1],t[2],"=="):"!="===r?pv(cv(t[1],t[2],"==")):"<"===r||">"===r||"<="===r||">="===r?cv(t[1],t[2],r):"any"===r?(e=t.slice(1),["any"].concat(e.map(lv))):"all"===r?["all"].concat(t.slice(1).map(lv)):"none"===r?["all"].concat(t.slice(1).map(lv).map(pv)):"in"===r?fv(t[1],t.slice(2)):"!in"===r?pv(fv(t[1],t.slice(2))):"has"===r?hv(t[1]):"!has"===r?pv(hv(t[1])):"within"!==r||t}function cv(t,e,r){switch(t){case"$type":return["filter-type-"+r,e];case"$id":return["filter-id-"+r,e];default:return["filter-"+r,t,e]}}function fv(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return Sp(t)!==Sp(e[0])}))?["filter-in-large",t,["literal",e.sort(sv)]]:["filter-in-small",t,["literal",e]]}}function hv(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function pv(t){return["!",t]}var yv=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function dv(t,e){var r={};for(var n in t)"ref"!==n&&(r[n]=t[n]);return yv.forEach((function(t){t in e&&(r[t]=e[t])})),r}var vv={thin:100,hairline:100,"ultra-light":100,"extra-light":100,light:200,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,heavy:800,black:800,"extra-bold":800,"ultra-black":900,"extra-black":900,"ultra-bold":900,"heavy-black":900,fat:900,poster:900},gv=" ",mv=/(italic|oblique)$/i,bv={},_v=function(t,e,r){var n=bv[t];if(!n){Array.isArray(t)||(t=[t]);for(var i=400,o="normal",a=[],s=0,u=t.length;s<u;++s){var l=t[s].split(" "),c=l[l.length-1].toLowerCase();for(var f in"normal"==c||"italic"==c||"oblique"==c?(o=c,l.pop(),c=l[l.length-1].toLowerCase()):mv.test(c)&&(c=c.replace(mv,""),o=l[l.length-1].replace(c,"")),vv){var h=l.length>1?l[l.length-2].toLowerCase():"";if(c==f||c==f.replace("-","")||h+"-"+c==f){i=vv[f],l.pop(),h&&f.startsWith(h)&&l.pop();break}}"number"==typeof c&&(i=c);var p=l.join(gv).replace("Klokantech Noto Sans","Noto Sans");-1!==p.indexOf(gv)&&(p='"'+p+'"'),a.push(p)}n=bv[t]=[o,i,a]}return n[0]+gv+n[1]+gv+e+"px"+(r?"/"+r:"")+gv+n[2]};function xv(t){return t*Math.PI/180}var wv=function(){for(var t=[],e=78271.51696402048;t.length<=24;e/=2)t.push(e);return t}();function kv(t,e){if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(t,e);var r=document.createElement("canvas");return r.width=t,r.height=e,r}var Sv,Ov=Array(256).join(" ");function Tv(t,e){if(e>=.05){for(var r="",n=t.split("\n"),i=Ov.slice(0,Math.round(e/.1)),o=0,a=n.length;o<a;++o)o>0&&(r+="\n"),r+=n[o].split("").join(i);return r}return t}function Cv(){return Sv||(Sv=kv(1,1).getContext("2d")),Sv}function Pv(t,e){return Cv().measureText(t).width+(t.length-1)*e}var Rv={};function jv(t,e,r,n){if(-1!==t.indexOf("\n")){for(var i=t.split("\n"),o=[],a=0,s=i.length;a<s;++a)o.push(jv(i[a],e,r,n));return o.join("\n")}var u=r+","+e+","+t+","+n,l=Rv[u];if(!l){var c=t.split(" ");if(c.length>1){var f=Cv();f.font=e;for(var h=f.measureText("M").width*r,p="",y=[],d=0,v=c.length;d<v;++d){var g=c[d],m=p+(p?" ":"")+g;Pv(m,n)<=h?p=m:(p&&y.push(p),p=g)}p&&y.push(p);for(var b=0,_=y.length;b<_&&_>1;++b){var x=y[b];if(Pv(x,n)<.35*h){var w=b>0?Pv(y[b-1],n):1/0,k=b<_-1?Pv(y[b+1],n):1/0;y.splice(b,1),_-=1,w<k?(y[b-1]+=" "+x,b-=1):y[b]=x+" "+y[b]}}for(var S=0,O=y.length-1;S<O;++S){var T=y[S],C=y[S+1];if(Pv(T,n)>.7*h&&Pv(C,n)<.6*h){var P=T.split(" "),R=P.pop();Pv(R,n)<.2*h&&(y[S]=P.join(" "),y[S+1]=R+" "+C),O-=1}}l=y.join("\n")}else l=t;l=Tv(l,n),Rv[u]=l}return l}var Ev,Mv,Fv={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},Iv={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},Dv={},zv={zoom:0};function Av(t,e,r,n,i,o,a){var s=t.id;o||(o={},console.warn("No functionCache provided to getValue()")),o[s]||(o[s]={});var u,l=o[s];if(!l[r]){var c=(t[e]||Dv)[r],f=tv[e+"_"+t.type][r];void 0===c&&(c=f.default);var h=(u=c,Array.isArray(u)&&u.length>0&&"string"==typeof u[0]&&u[0]in Gd);if(!h&&Vd(c)&&(c=Ip(c,f),h=!0),h){var p=function(t,e){var r=Jd(t,e);if("error"===r.result)throw new Error(r.value.map((function(t){return t.key+": "+t.message})).join(", "));return r.value}(c,f);l[r]=p.evaluate.bind(p)}else"color"==f.type&&(c=Mp.parse(c)),l[r]=function(){return c}}return zv.zoom=n,l[r](zv,i,a)}function Lv(t,e,r,n){return Av(t,"layout","icon-allow-overlap",e,r,n)?Av(t,"layout","icon-ignore-placement",e,r,n)?"none":"obstacle":"declutter"}function Gv(t,e,r,n,i){return i||console.warn("No filterCache provided to evaluateFilter()"),t in i||(i[t]=rv(e).filter),zv.zoom=n,i[t](zv,r)}var Bv=!1;function Wv(t,e){if(t){if(!Bv&&(0===t.a||0===e))return;var r=t.a;return e=void 0===e?1:e,0===r?"transparent":"rgba("+Math.round(255*t.r/r)+","+Math.round(255*t.g/r)+","+Math.round(255*t.b/r)+","+r*e+")"}return t}var Xv=/^([^]*)\{(.*)\}([^]*)$/;function Yv(t,e){var r;do{if(r=t.match(Xv)){var n=e[r[2]]||"";t=r[1]+n+r[3]}}while(r);return t}var qv=!1;function Nv(t,e,r,n,i,o,a){if(void 0===n&&(n=wv),void 0===i&&(i=void 0),void 0===o&&(o=void 0),void 0===a&&(a=void 0),"string"==typeof e&&(e=JSON.parse(e)),8!=e.version)throw new Error("glStyle version 8 required.");var s,u;if(o)if("undefined"!=typeof Image){var l=new Image;l.crossOrigin="anonymous",l.onload=function(){s=l,u=[l.width,l.height],t.changed(),l.onload=null},l.src=o}else if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){var c=self;c.postMessage({action:"loadImage",src:o}),c.addEventListener("message",(function(t){"imageLoaded"===t.data.action&&t.data.src===o&&(s=t.data.image,u=[s.width,s.height])}))}for(var f,h=function(t){t=t.slice();for(var e=Object.create(null),r=0;r<t.length;r++)e[t[r].id]=t[r];for(var n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=dv(t[n],e[t[n].ref]));return t}(e.layers),p={},y=[],d={},v={},g={},m={},b=0,_=h.length;b<_;++b){var x=h[b],w=x.id;if("string"==typeof r&&x.source==r||-1!==r.indexOf(w)){var k=x["source-layer"];if(f){if(x.source!==f)throw new Error('Layer "'+w+'" does not use source "'+f)}else{f=x.source;var S=e.sources[f];if(!S)throw new Error('Source "'+f+'" is not defined');var O=S.type;if("vector"!==O&&"geojson"!==O)throw new Error('Source "'+f+'" is not of type "vector" or "geojson", but "'+O+'"')}var T=p[k];T||(T=[],p[k]=T),T.push({layer:x,index:b}),y.push(w)}}var C=new Ya,P=new Wa,R=[],j=function(e,r){var o=e.getProperties(),l=p[o.layer];if(l){var c=n.indexOf(r);-1==c&&(c=function(t,e){for(var r=0,n=e.length;r<n;++r)if(e[r]<t&&r+1<n){var i=e[r]/e[r+1];return r+Math.log(e[r]/t)/Math.log(i)}return n-1}(r,n));for(var f,h=Fv[e.getGeometry().getType()],y={properties:o,type:h},b=t.get("mapbox-featurestate")[e.getId()],_=-1,x=0,w=l.length;x<w;++x){var k=l[x],S=k.layer,O=S.id,T=S.layout||Dv,j=S.paint||Dv;if(!("none"===T.visibility||"minzoom"in S&&c<S.minzoom||"maxzoom"in S&&c>=S.maxzoom)){var E=S.filter;if(!E||Gv(O,E,y,c,m)){f=S;var M=void 0,F=void 0,I=void 0,D=void 0,z=void 0,A=void 0,L=k.index;if(3==h&&("fill"==S.type||"fill-extrusion"==S.type))if(F=Av(S,"paint",S.type+"-opacity",c,y,g,b),S.type+"-pattern"in j){var G=Av(S,"paint",S.type+"-pattern",c,y,g,b);if(G){var B="string"==typeof G?Yv(G,o):G.toString();if(s&&i&&i[B]){++_,(A=R[_])&&A.getFill()&&!A.getStroke()&&!A.getText()||(A=new Ha({fill:new Wa}),R[_]=A),I=A.getFill(),A.setZIndex(L);var W=B+"."+F,X=v[W];if(!X){var Y=i[B],q=kv(Y.width,Y.height),N=q.getContext("2d");N.globalAlpha=F,N.drawImage(s,Y.x,Y.y,Y.width,Y.height,0,0,Y.width,Y.height),X=N.createPattern(q,"repeat"),v[W]=X}I.setColor(X)}}}else M=Wv(Av(S,"paint",S.type+"-color",c,y,g,b),F),S.type+"-outline-color"in j&&(z=Wv(Av(S,"paint",S.type+"-outline-color",c,y,g,b),F)),z||(z=M),(M||z)&&(++_,(!(A=R[_])||M&&!A.getFill()||!M&&A.getFill()||z&&!A.getStroke()||!z&&A.getStroke()||A.getText())&&(A=new Ha({fill:M?new Wa:void 0,stroke:z?new Ya:void 0}),R[_]=A),M&&(I=A.getFill()).setColor(M),z&&((D=A.getStroke()).setColor(z),D.setWidth(.5)),A.setZIndex(L));if(1!=h&&"line"==S.type){M=!("line-pattern"in j)&&"line-color"in j?Wv(Av(S,"paint","line-color",c,y,g,b),Av(S,"paint","line-opacity",c,y,g,b)):void 0;var V=Av(S,"paint","line-width",c,y,g,b);M&&V>0&&(++_,(A=R[_])&&A.getStroke()&&!A.getFill()&&!A.getText()||(A=new Ha({stroke:new Ya}),R[_]=A),(D=A.getStroke()).setLineCap(Av(S,"layout","line-cap",c,y,g,b)),D.setLineJoin(Av(S,"layout","line-join",c,y,g,b)),D.setMiterLimit(Av(S,"layout","line-miter-limit",c,y,g,b)),D.setColor(M),D.setWidth(V),D.setLineDash(j["line-dasharray"]?Av(S,"paint","line-dasharray",c,y,g,b).map((function(t){return t*V})):null),A.setZIndex(L))}var Z=!1,U=null,K=0,H=void 0,J=void 0,$=void 0;if((1==h||2==h)&&"icon-image"in T){var Q=Av(S,"layout","icon-image",c,y,g,b);if(Q){H="string"==typeof Q?Yv(Q,o):Q.toString();var tt=void 0;if(s&&i&&i[H]){var et=Av(S,"layout","icon-rotation-alignment",c,y,g,b);if(2==h){var rt=e.getGeometry();if(rt.getFlatMidpoint||rt.getFlatMidpoints){var nt=rt.getExtent();if(Math.sqrt(Math.max(Math.pow((nt[2]-nt[0])/r,2),Math.pow((nt[3]-nt[1])/r,2)))>150){var it="MultiLineString"===rt.getType()?rt.getFlatMidpoints():rt.getFlatMidpoint();if(Mv||(Mv=new Ei("Point",Ev=[NaN,NaN],[],{},null)),tt=Mv,Ev[0]=it[0],Ev[1]=it[1],"line"===Av(S,"layout","symbol-placement",c,y,g,b)&&"map"===et)for(var ot=rt.getStride(),at=rt.getFlatCoordinates(),st=0,ut=at.length-ot;st<ut;st+=ot){var lt=at[st],ct=at[st+1],ft=at[st+ot],ht=at[st+ot+1],pt=Math.min(lt,ft),yt=Math.min(ct,ht),dt=Math.max(lt,ft),vt=Math.max(ct,ht);if(it[0]>=pt&&it[0]<=dt&&it[1]>=yt&&it[1]<=vt){K=Math.atan2(ct-ht,ft-lt);break}}}}}if(2!==h||tt){var gt=Av(S,"layout","icon-size",c,y,g,b),mt=void 0!==j["icon-color"]?Av(S,"paint","icon-color",c,y,g,b):null;if(!mt||0!==mt.a){var bt=H+"."+gt;if(null!==mt&&(bt+="."+mt),!(J=d[bt])){var _t=i[H],xt=Lv(S,c,y,g);J=new Dc({color:mt?[255*mt.r,255*mt.g,255*mt.b,mt.a]:void 0,img:s,imgSize:u,size:[_t.width,_t.height],offset:[_t.x,_t.y],rotateWithView:"map"===et,scale:gt/_t.pixelRatio,displacement:"icon-offset"in T?Av(S,"layout","icon-offset",c,y,g,b).map((function(t){return-t*_t.pixelRatio})):void 0,declutterMode:xt}),d[bt]=J}}J&&(++_,(A=R[_])&&A.getImage()&&!A.getFill()&&!A.getStroke()||(A=new Ha,R[_]=A),A.setGeometry(tt),J.setRotation(K+xv(Av(S,"layout","icon-rotate",c,y,g,b))),J.setOpacity(Av(S,"paint","icon-opacity",c,y,g,b)),J.setAnchor(Iv[Av(S,"layout","icon-anchor",c,y,g,b)]),A.setImage(J),U=A.getText(),A.setText(void 0),A.setZIndex(L),Z=!0,$=!1)}else $=!0}}}if(1==h&&"circle"===S.type){++_,(A=R[_])&&A.getImage()&&!A.getFill()&&!A.getStroke()||(A=new Ha,R[_]=A);var wt="circle-radius"in j?Av(S,"paint","circle-radius",c,y,g,b):5,kt=Wv(Av(S,"paint","circle-stroke-color",c,y,g,b),Av(S,"paint","circle-stroke-opacity",c,y,g,b)),St=Wv(Av(S,"paint","circle-color",c,y,g,b),Av(S,"paint","circle-opacity",c,y,g,b)),Ot=Av(S,"paint","circle-stroke-width",c,y,g,b),Tt=wt+"."+kt+"."+St+"."+Ot;(J=d[Tt])||(J=new Ga({radius:wt,stroke:kt&&Ot>0?new Ya({width:Ot,color:kt}):void 0,fill:St?new Wa({color:St}):void 0,declutterMode:"none"}),d[Tt]=J),A.setImage(J),U=A.getText(),A.setText(void 0),A.setGeometry(void 0),A.setZIndex(L),Z=!0}var Ct=void 0,Pt=void 0,Rt=void 0,jt=void 0,Et=void 0,Mt=void 0;if("text-field"in T){jt=Math.round(Av(S,"layout","text-size",c,y,g,b));var Ft=Av(S,"layout","text-font",c,y,g,b);Rt=Av(S,"layout","text-line-height",c,y,g,b),(Pt=_v(a?a(Ft):Ft,jt,Rt)).includes("sans-serif")||(Pt+=",sans-serif"),Et=Av(S,"layout","text-letter-spacing",c,y,g,b),Mt=Av(S,"layout","text-max-width",c,y,g,b);var It=Av(S,"layout","text-field",c,y,g,b);Ct="object"===Sp(It)&&It.sections?1===It.sections.length?It.toString():It.sections.reduce((function(t,e,r){var n=e.fontStack?e.fontStack.split(","):Ft,i=_v(a?a(n):n,jt*(e.scale||1),Rt),o=e.text;if("\n"===o)return t.push("\n",""),t;if(2!=h){for(var s=0,u=(o=jv(o,i,Mt,Et).split("\n")).length;s<u;++s)s>0&&t.push("\n",""),t.push(o[s],i);return t}t.push(Tv(o,Et),i)}),[]):Yv(It,o).trim(),F=Av(S,"paint","text-opacity",c,y,g,b)}if(Ct&&F&&!$){Z||(++_,(A=R[_])&&A.getText()&&!A.getFill()&&!A.getStroke()||(A=new Ha,R[_]=A),A.setImage(void 0),A.setGeometry(void 0)),A.getText()||A.setText(U||new qh({padding:[2,2,2,2]})),U=A.getText();var Dt=T["text-transform"];"uppercase"==Dt?Ct=Array.isArray(Ct)?Ct.map((function(t,e){return e%2?t:t.toUpperCase()})):Ct.toUpperCase():"lowercase"==Dt&&(Ct=Array.isArray(Ct)?Ct.map((function(t,e){return e%2?t:t.toLowerCase()})):Ct.toLowerCase());var zt=Array.isArray(Ct)?Ct:2==h?Tv(Ct,Et):jv(Ct,Pt,Mt,Et);U.setText(zt),U.setFont(Pt),U.setRotation(xv(Av(S,"layout","text-rotate",c,y,g,b)));var At=Av(S,"layout","text-anchor",c,y,g,b),Lt=Z||1==h?"point":Av(S,"layout","symbol-placement",c,y,g,b);U.setPlacement(Lt),U.setOverflow("point"===Lt);var Gt=Av(S,"paint","text-halo-width",c,y,g,b),Bt=Av(S,"layout","text-offset",c,y,g,b),Wt=Av(S,"paint","text-translate",c,y,g,b),Xt=0,Yt=0;if("point"==Lt){var qt="center";-1!==At.indexOf("left")?(qt="left",Yt=Gt):-1!==At.indexOf("right")&&(qt="right",Yt=-Gt),U.setTextAlign(qt);var Nt=Av(S,"layout","text-rotation-alignment",c,y,g,b);U.setRotateWithView("map"==Nt)}else U.setMaxAngle(xv(Av(S,"layout","text-max-angle",c,y,g,b))*Ct.length/zt.length),U.setTextAlign(),U.setRotateWithView(!1);var Vt="middle";0==At.indexOf("bottom")?(Vt="bottom",Xt=-Gt-.5*(Rt-1)*jt):0==At.indexOf("top")&&(Vt="top",Xt=Gt+.5*(Rt-1)*jt),U.setTextBaseline(Vt),U.setOffsetX(Bt[0]*jt+Yt+Wt[0]),U.setOffsetY(Bt[1]*jt+Xt+Wt[1]),P.setColor(Wv(Av(S,"paint","text-color",c,y,g,b),F)),U.setFill(P);var Zt=Wv(Av(S,"paint","text-halo-color",c,y,g,b),F);if(Zt){C.setColor(Zt),Gt*=2;var Ut=.5*jt;C.setWidth(Gt<=Ut?Gt:Ut),U.setStroke(C)}else U.setStroke(void 0);var Kt=Av(S,"layout","text-padding",c,y,g,b),Ht=U.getPadding();Kt!==Ht[0]&&(Ht[0]=Kt,Ht[1]=Kt,Ht[2]=Kt,Ht[3]=Kt),A.setZIndex(L)}}}}return _>-1?(R.length=_+1,qv&&("function"==typeof e.set?e.set("mapbox-layer",f):e.getProperties()["mapbox-layer"]=f),R):void 0}};return t.setStyle(j),t.set("mapbox-source",f),t.set("mapbox-layers",y),t.set("mapbox-featurestate",{}),j}new kp;var Vv,Zv,Uv,Kv=self,Hv=new OffscreenCanvas(1,1);Hv.style={};var Jv=Hv.getContext("2d"),$v={landcover:new Bh({maxZoom:9,format:new Xi,url:"https://api.maptiler.com/tiles/landcover/{z}/{x}/{y}.pbf?key=get_your_own_D6rA4zTHduk6KOKTXzGB"}),contours:new Bh({minZoom:9,maxZoom:14,format:new Xi,url:"https://api.maptiler.com/tiles/contours/{z}/{x}/{y}.pbf?key=get_your_own_D6rA4zTHduk6KOKTXzGB"}),openmaptiles:new Bh({format:new Xi,maxZoom:14,url:"https://api.maptiler.com/tiles/v3/{z}/{x}/{y}.pbf?key=get_your_own_D6rA4zTHduk6KOKTXzGB"})},Qv=[];function tg(t){return t[0].replace("Noto Sans","serif").replace("Roboto","sans-serif")}var eg=new oo((function(t,e,r,n){return function(t,e,r,n,i){if(!t||!(r in t.wantedTiles))return qi;if(!t.wantedTiles[r][e.getKey()])return qi;var o=t.viewState.center,a=n[0]-o[0],s=n[1]-o[1];return 65536*Math.log(i)+Math.sqrt(a*a+s*s)/i}(Vv,t,e,r,n)}),(function(){return Kv.postMessage({action:"requestRender"})}));Kv.addEventListener("message",(function(t){if("requestFeatures"!==t.data.action){if("render"===t.data.action){Vv=t.data.frameState,Zv||(Zv=Vv.pixelRatio,fetch("https://api.maptiler.com/maps/topo/style.json?key=get_your_own_D6rA4zTHduk6KOKTXzGB").then((function(t){return t.json()})).then((function(t){var e,r=[];t.layers.forEach((function(t){t.source&&(e!==t.source&&(e=t.source,r.push({source:t.source,layers:[]})),r[r.length-1].layers.push(t.id))}));var n=t.sprite+(Zv>1?"@2x":"")+".json",i=t.sprite+(Zv>1?"@2x":"")+".png";fetch(n).then((function(t){return t.json()})).then((function(e){r.forEach((function(r){var n=$v[r.source];if(n){var o=new ff({declutter:!0,source:n,minZoom:n.getTileGrid().getMinZoom()});o.getRenderer().useContainer=function(t,e){this.containerReused=this.getLayer()!==Qv[0],this.canvas=Hv,this.context=Jv,this.container={firstElementChild:Hv,style:{opacity:o.getOpacity()}},Uv=e},Nv(o,t,r.layers,void 0,e,i,tg),Qv.push(o)}})),Kv.postMessage({action:"requestRender"})}))}))),Vv.tileQueue=eg,Vv.viewState.projection=$t("EPSG:3857"),Qv.forEach((function(t){Lo(t.getLayerState(),Vv.viewState)&&t.getRenderer().renderFrame(Vv,Hv)})),Qv.forEach((function(t){return t.getRenderer().context&&t.renderDeclutter(Vv)})),eg.getTilesLoading()<8&&(eg.reprioritize(),eg.loadMoreTiles(8,2));var e=Hv.transferToImageBitmap();Kv.postMessage({action:"rendered",imageData:e,transform:Uv,frameState:JSON.parse(Xh(Vv))},[e])}}else{var r=Qv.filter((function(t){return Lo(t.getLayerState(),Vv.viewState)})).map((function(e){return e.getFeatures(t.data.pixel)}));Promise.all(r).then((function(t){var e=t.flat();Kv.postMessage({action:"getFeatures",features:JSON.parse(Xh(e.map((function(t){return t.getProperties()}))))})}))}}))}()}();
//# sourceMappingURL=offscreen-canvas.worker.worker.js.map